{"version":3,"sources":["webpack:///./jacdac-ts/jacdac-spec/spectool/jdutils.ts","webpack:///./jacdac-ts/jacdac-spec/spectool/jdspec.ts"],"names":["isRegister","pkt","kind","packetsToRegisters","packets","filter","derived","lookupRegister","spec","id","find","name","lookupField","field","fields","member","getRegister","w","ret","test","Error","shortName","exec","reg","fld","parseIntFloat","allowFloat","v","parseInt","replace","isNaN","parseFloat","ww","split","length","en","enums","members","hasOwnProperty","exprVisitor","parent","current","structVisit","Array","isArray","forEach","c","Object","keys","key","getExpressionsOfType","expr","type","returnParent","results","p","push","DEVICE_IMAGE_WIDTH","DEVICE_IMAGE_HEIGHT","unitDescription","m","kg","s","A","K","cd","mol","Hz","rad","sr","N","Pa","J","W","C","V","F","Ohm","S","Wb","T","H","lm","lx","Bq","Gy","Sv","kat","m2","m3","bit","lat","lon","pH","dB","dBW","count","EL","B","VA","VAs","var","vars","hsv","rgb","rpm","uv","lux","bpm","mcd","px","secondaryUnitConverters","ms","unit","scale","offset","min","h","MHz","kW","kVA","kvar","Ah","Wh","kWh","varh","kvarh","kVAh","KiB","GB","mV","mA","dBm","ppm","ppb","hPa","mm","cm","km","nm","nT","frac","us","mWh","g","resolveUnit","su","undefined","units","r","k","description","scd","sort","l","localeCompare","identifierRanges","rw","ro","const","command","report","event","parseServiceSpecificationMarkdownToJSON","filecontent","includes","filename","info","status","shortId","camelName","extends","notes","classIdentifier","tags","backticksType","enumInfo","packetInfo","pipePacket","errors","lineNo","noteId","lastCmd","packetsToDescribe","nextModifier","systemInfo","usedIds","values","prev","processInclude","line","processLine","e","error","message","normalizeMD","camelize","f","toUpperCase","packFormat","trim","interpret","slice","hd","cont","newNoteId","toLowerCase","iface","expanded","words","pop","cmd","startEnum","startPacket","finishPacket","packetField","enumMember","metadataMember","packed","hasNaturalAlignment","warn","repeats","hadzero","startRepeats","storage","pid","identifier","ranges","some","range","toString","map","join","md","checkBraces","forceSection","sectionId","kindSt","shift","w2","internal","isReport","unshift","normalizeName","secondary","hasReport","optional","pipeType","atat","indexOf","isSet","systemPacket","identifierName","isUser","isSystem","isHigh","toHex","highCommands","splice","last","rangeCheck","tp","normalizeStorageType","typeShift","Math","floor","bits","max","abs","parseVal","eq","val","parseIntCheck","defaultValue","isOptional","op","isFloat","tok","normalizeUnit","isSimpleType","canonicalType","multiSegmented","segmented","typicalMin","typicalMax","absoluteMin","absoluteMax","maxBytes","isFlags","looksRandom","n","i","hh","genRandom","random","gen","group","capitalize","concat","inner","innerEnums","clone","ie","innerPackets","ipkt","JSON","parse","stringify","msg","file","tp2","a","b","len","sz","byteOffset","memberSize","pad","o","fail","toUpper","x","toLower","cStorage","unitPref","prettyUnit","u","toH","hdDef","pref","enPref","cmt","addComment","wrapComment","comment","isMetaPipe","needsStruct","tname","unaligned","def","cst","_","upperCamel","snakify","dashify","humanify","typeInfo","f0","desc","wrapSnippet","code","TYPESCRIPT_STATIC_NAMESPACE","packFormatForField","isStatic","useBooleans","szSuff","tsType","fmt","sinfo","ff","packInfo","vartp","reptp","varname","console","log","buffers","names","types","toTypescript","staticTypeScript","indent","indent2","enumkw","toLocaleUpperCase","tsEnums","pack","text","meta","normalizeDeviceSpecification","dev","escapeDeviceIdentifier","company","escapeDeviceNameIdentifier","repo","link","services","firmwares","escaped","converters","json","j","ts","sts","isNumericType"],"mappings":"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","file":"74493c31a6571423b4de02ce9ddf127887738210-0e98c7bfd1771f70ea24.js","sourcesContent":["// eslint-disable-next-line @typescript-eslint/triple-slash-reference\n/// <reference path=\"jdspec.d.ts\" />\n\nexport function isRegister(pkt: jdspec.PacketInfo): boolean {\n    return pkt && (pkt.kind == \"const\" || pkt.kind == \"ro\" || pkt.kind == \"rw\")\n}\n\nexport function packetsToRegisters(packets: jdspec.PacketInfo[]) {\n    return packets.filter(pkt => !pkt.derived && isRegister(pkt))\n}\nexport function lookupRegister(\n    spec: jdspec.ServiceSpec,\n    id: string\n): jdspec.PacketInfo {\n    return spec.packets.find(pkt => isRegister(pkt) && pkt.name === id)\n}\n\nexport function lookupField(\n    pkt: jdspec.PacketInfo,\n    field: string\n): jdspec.PacketMember {\n    return pkt.fields.find(member => member.name === field)\n}\n\nexport interface RegField {\n    pkt: jdspec.PacketInfo\n    fld?: jdspec.PacketMember\n}\n\nexport function getRegister(spec: jdspec.ServiceSpec, w: string): RegField {\n    const ret: RegField = { pkt: null }\n    if (/^\\w+$/.test(w)) {\n        ret.pkt = lookupRegister(spec, w)\n        if (!ret.pkt) {\n            throw new Error(\n                `no register ${w} found in service ${spec.shortName}`\n            )\n        }\n    } else if (/^\\w+\\.\\w+$/.test(w)) {\n        const [reg, field] = /^(\\w+)\\.(\\w+)$/.exec(w)\n        ret.pkt = lookupRegister(spec, reg)\n        if (!ret.pkt) {\n            throw new Error(\n                `no register ${reg} found in service ${spec.shortName}`\n            )\n        } else {\n            ret.fld = lookupField(ret.pkt, field)\n            if (!ret.fld)\n                throw new Error(\n                    `no field ${field} found in register ${reg} of service ${spec.shortName}`\n                )\n        }\n    }\n    return ret\n}\n\nexport function parseIntFloat(\n    spec: jdspec.ServiceSpec,\n    w: string,\n    allowFloat = false\n): number {\n    if (/^-?0x[a-f\\d_]+$/i.test(w) || /^-?[\\d_]+$/.test(w)) {\n        const v = parseInt(w.replace(/_/g, \"\")) // allow for 0x3fff_ffff syntax\n        if (isNaN(v)) throw new Error(\"can't parse int: \" + w)\n        return v\n    }\n\n    if (allowFloat && /^-?\\d*(\\.\\d*)?(e(-?)\\d+)?$/.test(w)) {\n        const v = parseFloat(w)\n        if (isNaN(v)) throw new Error(\"can't parse float: \" + w)\n        return v\n    }\n\n    const ww = w.split(/\\./)\n    if (ww.length != 2) {\n        throw new Error(`expecting int or enum member here`)\n    }\n    const en = spec.enums[ww[0]]\n    if (!en) {\n        throw new Error(`${ww[0]} is not an enum type`)\n    }\n    // eslint-disable-next-line no-prototype-builtins\n    if (!en.members.hasOwnProperty(ww[1]))\n        throw new Error(`${ww[1]} is not a member of ${ww[0]}`)\n    return en.members[ww[1]] || 0\n}\n\nexport function exprVisitor(parent: any, current: any, structVisit: (par:any, curr:any) => void) {\n    if (Array.isArray(current)) {\n        (current as any[]).forEach(c => exprVisitor(current, c, structVisit))\n    } else if (typeof current === \"object\") {\n        if (parent && current)\n            structVisit(parent, current)\n        Object.keys(current).forEach((key: string) => {\n            exprVisitor(current, current[key], structVisit)\n        })\n    }\n}\nexport function getExpressionsOfType(expr: jsep.Expression | jsep.Expression[], type: string, returnParent = false) {\n    const results: jsep.Expression[] = []\n    exprVisitor(null, expr, (p,c) => {\n        if (p && c.type === type)\n        results.push(returnParent ? p : c)\n    })\n    return results\n}\n","// eslint-disable-next-line @typescript-eslint/triple-slash-reference\n/// <reference path=\"jdspec.d.ts\" />\nimport { parseIntFloat } from \"./jdutils\"\n\nexport const DEVICE_IMAGE_WIDTH = 600\nexport const DEVICE_IMAGE_HEIGHT = 450\n\n// modified subset of SenML\nexport const unitDescription: jdspec.SMap<string> = {\n    \"\": \"angle\",\n    \"/s\": \"rotation rate\",\n    \"/s2\": \"rotation acceleration\",\n    m: \"meter\",\n    kg: \"kilogram\",\n    s: \"second\",\n    A: \"ampere\",\n    K: \"kelvin\",\n    cd: \"candela\",\n    mol: \"mole\",\n    Hz: \"hertz\",\n    rad: \"radian\",\n    sr: \"steradian\",\n    N: \"newton\",\n    Pa: \"pascal\",\n    J: \"joule\",\n    W: \"watt\",\n    C: \"coulomb\",\n    V: \"volt\",\n    F: \"farad\",\n    Ohm: \"ohm\",\n    S: \"siemens\",\n    Wb: \"weber\",\n    T: \"tesla\",\n    H: \"henry\",\n    \"C\": \"degrees Celsius\",\n    lm: \"lumen\",\n    lx: \"lux\",\n    Bq: \"becquerel\",\n    Gy: \"gray\",\n    Sv: \"sievert\",\n    kat: \"katal\",\n    m2: \"square meter (area)\",\n    m3: \"cubic meter (volume)\",\n    \"m/s\": \"meter per second (velocity)\",\n    \"m/s2\": \"meter per square second (acceleration)\",\n    \"m3/s\": \"cubic meter per second (flow rate)\",\n    \"W/m2\": \"watt per square meter (irradiance)\",\n    \"cd/m2\": \"candela per square meter (luminance)\",\n    bit: \"bit (information content)\",\n    \"bit/s\": \"bit per second (data rate)\",\n    lat: \"degrees latitude\",\n    lon: \"degrees longitude\",\n    pH: \"pH value (acidity; logarithmic quantity)\",\n    dB: \"decibel (logarithmic quantity)\",\n    dBW: \"decibel relative to 1 W (power level)\",\n    count: \"1 (counter value)\",\n    \"/\": \"1 (ratio e.g., value of a switch)\",\n    \"%RH\": \"Percentage (Relative Humidity)\",\n    \"%EL\": \"Percentage (remaining battery energy level)\",\n    EL: \"seconds (remaining battery energy level)\",\n    \"1/s\": \"1 per second (event rate)\",\n    \"S/m\": \"Siemens per meter (conductivity)\",\n    B: \"Byte (information content)\",\n    VA: \"volt-ampere (Apparent Power)\",\n    VAs: \"volt-ampere second (Apparent Energy)\",\n    var: \"volt-ampere reactive (Reactive Power)\",\n    vars: \"volt-ampere-reactive second (Reactive Energy)\",\n    \"J/m\": \"joule per meter (Energy per distance)\",\n    \"kg/m3\": \"kilogram per cubic meter (mass density, mass concentration)\",\n    \"s/60\": \"servo speed (time to travel 60)\",\n    \"kg/cm\": \"torque\",\n    hsv: \"bit HSV color\",\n    rgb: \"RGB color\",\n    rpm: \"revolutions per minute\",\n    uv: \"UV index\",\n    lux: \"illuminance\",\n    bpm: \"beats per minute\",\n    mcd: \"micro candella\",\n    px: \"pixel\",\n}\n\nexport const secondaryUnitConverters: jdspec.SMap<{\n    name: string\n    unit: senml.Unit | \"#\"\n    scale: number\n    offset: number\n}> = {\n    ms: { name: \"millisecond\", unit: \"s\", scale: 1 / 1000, offset: 0 },\n    min: { name: \"minute\", unit: \"s\", scale: 60, offset: 0 },\n    h: { name: \"hour\", unit: \"s\", scale: 3600, offset: 0 },\n    MHz: { name: \"megahertz\", unit: \"Hz\", scale: 1000000, offset: 0 },\n    kW: { name: \"kilowatt\", unit: \"W\", scale: 1000, offset: 0 },\n    kVA: { name: \"kilovolt-ampere\", unit: \"VA\", scale: 1000, offset: 0 },\n    kvar: { name: \"kilovar\", unit: \"var\", scale: 1000, offset: 0 },\n    Ah: { name: \"ampere-hour\", unit: \"C\", scale: 3600, offset: 0 },\n    Wh: { name: \"watt-hour\", unit: \"J\", scale: 3600, offset: 0 },\n    kWh: { name: \"kilowatt-hour\", unit: \"J\", scale: 3600000, offset: 0 },\n    varh: { name: \"var-hour\", unit: \"vars\", scale: 3600, offset: 0 },\n    kvarh: { name: \"kilovar-hour\", unit: \"vars\", scale: 3600000, offset: 0 },\n    kVAh: {\n        name: \"kilovolt-ampere-hour\",\n        unit: \"VAs\",\n        scale: 3600000,\n        offset: 0,\n    },\n    \"Wh/km\": {\n        name: \"watt-hour per kilometer\",\n        unit: \"J/m\",\n        scale: 3.6,\n        offset: 0,\n    },\n    KiB: { name: \"kibibyte\", unit: \"B\", scale: 1024, offset: 0 },\n    GB: { name: \"gigabyte\", unit: \"B\", scale: 1.0e9, offset: 0 },\n    \"Mbit/s\": {\n        name: \"megabit per second\",\n        unit: \"bit/s\",\n        scale: 1000000,\n        offset: 0,\n    },\n    \"B/s\": { name: \"byte per second\", unit: \"bit/s\", scale: 8, offset: 0 },\n    \"MB/s\": {\n        name: \"megabyte per second\",\n        unit: \"bit/s\",\n        scale: 8000000,\n        offset: 0,\n    },\n    mV: { name: \"millivolt\", unit: \"V\", scale: 1 / 1000, offset: 0 },\n    mA: { name: \"milliampere\", unit: \"A\", scale: 1 / 1000, offset: 0 },\n    dBm: { name: \"decibel (milliwatt)\", unit: \"dBW\", scale: 1, offset: -30 },\n    \"ug/m3\": {\n        name: \"microgram per cubic meter\",\n        unit: \"kg/m3\",\n        scale: 1.0e-9,\n        offset: 0,\n    },\n    \"mm/h\": {\n        name: \"millimeter per hour\",\n        unit: \"m/s\",\n        scale: 1 / 3600000,\n        offset: 0,\n    },\n    \"m/h\": { name: \"meter per hour\", unit: \"m/s\", scale: 1 / 3600, offset: 0 },\n    \"cm/s\": {\n        name: \"centimeter per seconds\",\n        unit: \"m/s\",\n        scale: 1 / 100,\n        offset: 0,\n    },\n    ppm: { name: \"parts per million\", unit: \"/\", scale: 1.0e-6, offset: 0 },\n    ppb: { name: \"parts per billion\", unit: \"/\", scale: 1.0e-9, offset: 0 },\n    \"/100\": { name: \"percent\", unit: \"/\", scale: 1 / 100, offset: 0 },\n    \"%\": { name: \"percent\", unit: \"/\", scale: 1 / 100, offset: 0 },\n    \"/1000\": { name: \"permille\", unit: \"/\", scale: 1 / 1000, offset: 0 },\n    hPa: { name: \"hectopascal\", unit: \"Pa\", scale: 100, offset: 0 },\n    mm: { name: \"millimeter\", unit: \"m\", scale: 1 / 1000, offset: 0 },\n    cm: { name: \"centimeter\", unit: \"m\", scale: 1 / 100, offset: 0 },\n    km: { name: \"kilometer\", unit: \"m\", scale: 1000, offset: 0 },\n    \"km/h\": {\n        name: \"kilometer per hour\",\n        unit: \"m/s\",\n        scale: 1 / 3.6,\n        offset: 0,\n    },\n    \"8ms\": { name: \"8 milliseconds\", unit: \"s\", scale: 8 / 1000, offset: 0 },\n    nm: { name: \"nanometer\", unit: \"m\", scale: 1e-9, offset: 0 },\n    nT: { name: \"nano Tesla\", unit: \"T\", scale: 1e9, offset: 0 },\n\n    // compat with previous Jacdac versions\n    frac: { name: \"ratio\", unit: \"/\", scale: 1, offset: 0 },\n    us: { name: \"micro seconds\", unit: \"s\", scale: 1e-6, offset: 0 },\n    mWh: { name: \"micro watt-hour\", unit: \"J\", scale: 3.6e-3, offset: 0 },\n    g: { name: \"earth gravity\", unit: \"m/s2\", scale: 9.80665, offset: 0 },\n    \"#\": { name: \"count\", unit: \"#\", scale: 1, offset: 0 },\n}\n\nexport function resolveUnit(unit: string) {\n    if (unit === \"\") return { name: \"\", unit: \"\", scale: 1, offset: 1 } // indentifier\n\n    // seconary unit?\n    const su = secondaryUnitConverters[unit]\n    if (su) return su\n\n    const name = unitDescription[unit]\n    if (name) return { name, unit, scale: 1, offset: 0 }\n\n    return undefined\n}\n\nexport function units(): { name: string; description: string }[] {\n    const r: { name: string; description: string }[] = []\n    Object.keys(unitDescription).forEach(k => {\n        r.push({ name: k, description: unitDescription[k] })\n        Object.keys(secondaryUnitConverters)\n            .filter(scd => secondaryUnitConverters[scd].unit === k)\n            .forEach(scd =>\n                r.push({\n                    name: scd,\n                    description: secondaryUnitConverters[scd].name,\n                })\n            )\n    })\n    r.sort((l, r) => l.name.localeCompare(r.name))\n    return r\n}\n\n/* check ranges, see system.md\nRegisters `0x001-0x07f` - r/w common to all services\nRegisters `0x080-0x0ff` - r/w defined per-service\nRegisters `0x100-0x17f` - r/o common to all services\nRegisters `0x180-0x1ff` - r/o defined per-service\nRegisters `0x200-0xeff` - custom, defined per-service\nRegisters `0xf00-0xfff` - reserved for implementation, should not be seen on the wire\n*/\nconst identifierRanges: { [index: string]: [number, number][] } = {\n    rw: [\n        [0x001, 0x07f],\n        [0x080, 0x0ff],\n        [0x200, 0xeff], // custom\n        [0xf00, 0xfff], // impl\n    ],\n    ro: [\n        [0x100, 0x17f],\n        [0x180, 0x1ff],\n        [0x200, 0xeff], // custom\n        [0xf00, 0xfff], // impl\n    ],\n    const: [\n        [0x100, 0x17f],\n        [0x180, 0x1ff],\n        [0x200, 0xeff], // custom\n        [0xf00, 0xfff], // impl\n    ],\n    command: [\n        [0x000, 0x07f],\n        [0x080, 0xeff],\n        [0xf00, 0xfff],\n    ],\n    report: [\n        [0x000, 0x07f],\n        [0x080, 0xeff],\n        [0xf00, 0xfff],\n    ],\n    event: [\n        [0x00, 0x7f], // system\n        [0x80, 0xff],\n    ],\n}\n\nexport function parseServiceSpecificationMarkdownToJSON(\n    filecontent: string,\n    includes?: jdspec.SMap<jdspec.ServiceSpec>,\n    filename = \"\"\n): jdspec.ServiceSpec {\n    filecontent = (filecontent || \"\").replace(/\\r/g, \"\")\n    const info: jdspec.ServiceSpec = {\n        name: \"\",\n        status: \"experimental\",\n        shortId: filename.replace(/\\.md$/, \"\").replace(/.*\\//, \"\"),\n        camelName: \"\",\n        shortName: \"\",\n        extends: [],\n        notes: {},\n        classIdentifier: 0,\n        enums: {},\n        packets: [],\n        tags: [],\n    }\n\n    let backticksType = \"\"\n    let enumInfo: jdspec.EnumInfo = null\n    let packetInfo: jdspec.PacketInfo = null\n    let pipePacket: jdspec.PacketInfo = null\n    let errors: jdspec.Diagnostic[] = []\n    let lineNo = 0\n    let noteId = \"short\"\n    let lastCmd: jdspec.PacketInfo\n    let packetsToDescribe: jdspec.PacketInfo[]\n    let nextModifier: \"\" | \"segmented\" | \"multi-segmented\" | \"repeats\" = \"\"\n\n    const systemInfo = includes?.[\"_system\"]\n    const usedIds: jdspec.SMap<string> = {}\n    for (const prev of values(includes || {})) {\n        if (prev.classIdentifier) usedIds[prev.classIdentifier + \"\"] = prev.name\n    }\n\n    try {\n        if (includes[\"_system\"] && includes[\"_base\"]) processInclude(\"_base\")\n        for (const line of filecontent.split(/\\n/)) {\n            lineNo++\n            processLine(line)\n        }\n    } catch (e) {\n        error(\"exception: \" + e.message)\n    }\n\n    if (errors.length) info.errors = errors\n\n    for (const k of Object.keys(info.notes))\n        info.notes[k] = normalizeMD(info.notes[k])\n    for (const v of info.packets) v.description = normalizeMD(v.description)\n\n    if (!info.camelName)\n        info.camelName = camelize(\n            info.name\n                .replace(/\\s+/g, \" \")\n                .replace(/[ -](.)/g, (f, l) => l.toUpperCase())\n                .replace(/[^\\w]+/g, \"_\")\n        )\n    if (!info.shortName) info.shortName = info.camelName\n\n    if (info.camelName == \"system\") info.classIdentifier = 0x1fff_fff1\n    else if (info.camelName == \"base\") info.classIdentifier = 0x1fff_fff3\n    else if (info.camelName == \"sensor\") info.classIdentifier = 0x1fff_fff2\n\n    if (info.shortName != \"control\" && !info.classIdentifier)\n        error(\"identifier: not specified\")\n\n    info.packets.forEach(pkt => (pkt.packFormat = packFormat(info, pkt)))\n\n    return info\n\n    function processLine(line: string) {\n        if (backticksType) {\n            if (line.trim() == \"```\") {\n                backticksType = null\n                if (backticksType == \"default\") return\n            }\n        } else {\n            const m = /^```(.*)/.exec(line)\n            if (m) {\n                backticksType = m[1] || \"default\"\n                if (backticksType == \"default\") return\n            }\n        }\n\n        const interpret =\n            backticksType == \"default\" || line.slice(0, 4) == \"    \"\n\n        if (!interpret) {\n            const m = /^(#+)\\s*(.*)/.exec(line)\n            if (m) {\n                const [, hd, cont] = m\n                packetsToDescribe = null\n                const newNoteId = cont.trim().toLowerCase()\n                if (hd == \"#\" && !info.name) {\n                    info.name = cont.trim()\n                    line = \"\"\n                } else if (\n                    newNoteId == \"registers\" ||\n                    newNoteId == \"commands\" ||\n                    newNoteId == \"events\" ||\n                    newNoteId == \"examples\"\n                ) {\n                    noteId = newNoteId\n                    line = \"\"\n                } else {\n                    if (noteId == \"short\") noteId = \"long\"\n                    // keep line\n                }\n            }\n\n            if (packetsToDescribe) {\n                for (const iface of packetsToDescribe)\n                    iface.description += line + \"\\n\"\n            } else {\n                if (line || info.notes[noteId]) {\n                    if (!info.notes[noteId]) info.notes[noteId] = \"\"\n                    info.notes[noteId] += line + \"\\n\"\n                }\n            }\n        } else {\n            if (packetsToDescribe && packetsToDescribe[0].description)\n                packetsToDescribe = null\n            const expanded = line\n                .replace(/\\/\\/.*/, \"\")\n                .replace(/[?@:=,{};]/g, s => \" \" + s + \" \")\n                .trim()\n            if (!expanded) return\n            const words = expanded.split(/\\s+/)\n            if (/^[;,]/.test(words[words.length - 1])) words.pop()\n            let cmd = words[0]\n            // allow for `command = Foo.Bar` etc (ie. command is not a keyword there)\n            if (words[1] == \":\" || words[1] == \"=\") cmd = \":\"\n            switch (cmd) {\n                case \"enum\":\n                case \"flags\":\n                    startEnum(words)\n                    break\n                case \"meta\":\n                case \"pipe\":\n                case \"report\":\n                case \"command\":\n                case \"const\":\n                case \"ro\":\n                case \"rw\":\n                case \"event\":\n                    startPacket(words)\n                    break\n                case \"}\":\n                    if (packetInfo) {\n                        finishPacket()\n                    } else if (enumInfo) {\n                        enumInfo = null\n                    } else {\n                        error(\"nothing to end here\")\n                    }\n                    break\n                default:\n                    if (packetInfo) packetField(words)\n                    else if (enumInfo) enumMember(words)\n                    else metadataMember(words)\n            }\n        }\n    }\n\n    function finishPacket() {\n        packetInfo.packed = hasNaturalAlignment(packetInfo) ? undefined : true\n        if (packetInfo.packed)\n            warn(`you may want to use explicit padding in ${packetInfo.name}`)\n\n        let repeats = false\n        let hadzero = false\n        for (const p of packetInfo.fields) {\n            if (hadzero) {\n                error(\n                    `field ${p.name} in ${packetInfo.kind} ${packetInfo.name} follows a variable-sized field`\n                )\n                break\n            }\n            if (p.startRepeats) {\n                if (repeats)\n                    error(\n                        `repeats: can only be specified once; in ${packetInfo.kind} ${packetInfo.name}`\n                    )\n                repeats = true\n            }\n            if (p.storage == 0 && p.type != \"string0\") {\n                if (repeats) {\n                    error(\n                        `variable-sized field ${p.name} in ${packetInfo.kind} ${packetInfo.name} cannot repeat`\n                    )\n                    break\n                }\n                hadzero = true\n            }\n        }\n\n        const pid = packetInfo.identifier\n        const ranges = identifierRanges[packetInfo.kind]\n        if (\n            packetInfo.name != \"set_register\" &&\n            packetInfo.name != \"get_register\" &&\n            ranges &&\n            !ranges.some(range => range[0] <= pid && pid <= range[1])\n        )\n            error(\n                `${packetInfo.name} identifier 0x${pid.toString(\n                    16\n                )} out of range, expected in ${ranges\n                    .map(\n                        range =>\n                            `[${range\n                                .map(r => `0x${r.toString(16)}`)\n                                .join(\", \")}]`\n                    )\n                    .join(\", \")}`\n            )\n\n        packetInfo = null\n    }\n\n    function normalizeMD(md: string) {\n        return md.replace(/^\\s+/, \"\").replace(/\\s+$/, \"\")\n    }\n\n    function checkBraces(words: string[]) {\n        if (enumInfo || packetInfo) error(\"already in braces\")\n        if (words) {\n            if (words[2] != \"{\") error(`expecting: ${words[0]} NAME {`)\n        }\n\n        enumInfo = null\n        packetInfo = null\n    }\n\n    function forceSection(sectionId: string) {\n        if (noteId != sectionId) {\n            error(`this is only allowed in ## ${sectionId} not in ## ${noteId}`)\n        }\n    }\n\n    function startPacket(words: string[]) {\n        checkBraces(null)\n        const kindSt = words.shift()\n        let kind: jdspec.PacketKind = \"command\"\n        if (kindSt == \"meta\") {\n            forceSection(\"commands\")\n            let w2 = words.shift()\n            if (w2 == \"pipe\") w2 = words.shift()\n            if (w2 == \"report\" || w2 == \"command\")\n                kind = (\"meta_pipe_\" + w2) as any\n            else error(\"invalid token after meta\")\n        } else if (kindSt == \"pipe\") {\n            forceSection(\"commands\")\n            const w2 = words.shift()\n            if (w2 == \"report\" || w2 == \"command\") kind = (\"pipe_\" + w2) as any\n            else error(\"invalid token after pipe\")\n        } else {\n            kind = kindSt as any\n        }\n\n        let internal: boolean = undefined\n        if (words[0] === \"internal\") {\n            internal = true\n            words.shift()\n        }\n\n        let name = words.shift()\n        const isReport = kind == \"report\"\n        if (isReport && lastCmd && !/^\\w+$/.test(name)) {\n            words.unshift(name)\n            name = lastCmd.name\n        }\n        packetInfo = {\n            kind,\n            name: normalizeName(name),\n            identifier: undefined,\n            description: \"\",\n            fields: [],\n            internal,\n        }\n        if (isReport && lastCmd && name == lastCmd.name) {\n            packetInfo.secondary = true\n            lastCmd.hasReport = true\n        }\n        if (!packetsToDescribe) packetsToDescribe = []\n        packetsToDescribe.push(packetInfo)\n        if (words[0] == \"?\") {\n            words.shift()\n            packetInfo.optional = true\n        }\n\n        const prev = info.packets.filter(p => p.name == packetInfo.name)\n        if (prev.length == 0) {\n            // OK\n        } else if (\n            prev.length == 1 &&\n            prev[0].kind == \"command\" &&\n            packetInfo.kind == \"report\"\n        ) {\n            // OK\n        } else {\n            error(`packet redefinition ${prev.map(p => p.name).join(\", \")} `)\n        }\n\n        if (/pipe/.test(kind)) {\n            if (!pipePacket)\n                error(\n                    \"pipe definitions can only occur after the pipe-open packet\"\n                )\n            else packetInfo.pipeType = pipePacket.pipeType\n        }\n\n        const atat = words.indexOf(\"@\")\n        if (kind == \"pipe_command\" || kind == \"pipe_report\") {\n            // no identifier\n            packetInfo.identifier = 0\n        } else if (atat >= 0) {\n            const w = words[atat + 1]\n            let v = parseInt(w)\n            let isSet = true\n            if (isNaN(v)) {\n                v = 0\n                isSet = false\n                if (systemInfo) {\n                    const systemPacket = systemInfo.packets.find(\n                        p => p.name == w\n                    )\n                    if (systemPacket) {\n                        v = systemPacket.identifier\n                        packetInfo.identifierName = w\n                        if (systemPacket.kind != kind)\n                            error(\n                                `kind mismatch on ${w}: ${systemPacket.kind} vs ${kind}`\n                            )\n                        else isSet = true\n                    } else error(`${w} not found in _system`)\n                } else {\n                    error(`${w} cannot be resolved, since _system is missing`)\n                }\n            }\n\n            let isUser = false\n            let isSystem = false\n            let isHigh = 0x200 <= v && v <= 0xeff\n            switch (kind) {\n                case \"const\":\n                case \"ro\":\n                    forceSection(\"registers\")\n                    isSystem = 0x100 <= v && v <= 0x17f\n                    isUser = 0x180 <= v && v <= 0x1ff\n                    break\n                case \"rw\":\n                    forceSection(\"registers\")\n                    isSystem = 0x00 <= v && v <= 0x7f\n                    isUser = 0x80 <= v && v <= 0xff\n                    break\n                case \"report\":\n                case \"command\":\n                    forceSection(\"commands\")\n                    isSystem = 0x00 <= v && v <= 0x7f\n                    isUser = 0x80 <= v && v <= 0xff\n                    isHigh = 0x100 <= v && v <= 0xeff\n                    break\n                case \"event\":\n                    forceSection(\"events\")\n                    isSystem = 0x00 <= v && v <= 0x7f\n                    isUser = 0x80 <= v && v <= 0xff\n                    break\n            }\n\n            if (isUser) {\n                // ok\n            } else if (isSystem) {\n                if (!packetInfo.identifierName)\n                    warn(\n                        `${kind} @ ${toHex(\n                            v\n                        )} should be expressed with a name from _system.md`\n                    )\n            } else if (isHigh) {\n                if (!info.highCommands)\n                    warn(\n                        `${kind} @ ${toHex(\n                            v\n                        )} is from the extended range but 'high: 1' missing`\n                    )\n            }\n\n            packetInfo.identifier = v\n            words.splice(atat, 2)\n        } else {\n            if (isReport && lastCmd) packetInfo.identifier = lastCmd.identifier\n            else error(`@ not found at ${packetInfo.name}`)\n        }\n\n        if (\n            info.packets.some(\n                p =>\n                    p.kind == packetInfo.kind &&\n                    (!/pipe/.test(p.kind) ||\n                        p.pipeType == packetInfo.pipeType) &&\n                    p.identifier == packetInfo.identifier\n            )\n        ) {\n            error(\"packet identifier already used\")\n        }\n\n        info.packets.push(packetInfo)\n\n        if (kind == \"command\") lastCmd = packetInfo\n        else lastCmd = null\n\n        if (words[0] == \"=\" || words[0] == \":\") {\n            words.unshift(\"_\")\n            packetField(words)\n            finishPacket()\n        } else {\n            const last = words.shift()\n            if (last == \"{\") {\n                if (words[0] == \"...\") words.shift()\n                if (words[0] == \"}\") {\n                    words.shift()\n                    finishPacket()\n                }\n                if (words.length) error(`excessive tokens: ${words[0]}...`)\n            } else {\n                if (last === undefined && kind == \"event\") {\n                    finishPacket()\n                } else {\n                    error(\"expecting '{'\")\n                }\n            }\n        }\n    }\n\n    function rangeCheck(tp: string, v: number) {\n        const [storage, type, typeShift] = normalizeStorageType(tp)\n\n        if (isNaN(v)) return v // error already reported\n\n        if (storage == 0) {\n            error(`numeric values like ${v} not allowed for ${tp}`)\n            return v\n        }\n\n        if (v < 0 && storage > 0) {\n            error(`negative values like ${v} not allowed for ${tp}`)\n            return v\n        }\n\n        if (Math.floor(v) != v && typeShift == 0) {\n            error(`only integer values allowed for ${tp}; got ${v}`)\n            return v\n        }\n\n        let bits = storage < 0 ? -storage * 8 - 1 : storage * 8\n        bits -= typeShift || 0\n        // don't use bitshift to allow for more than 32 bits\n        let max = 1\n        while (bits--) max *= 2\n        if (-v == max) {\n            // OK - min_int\n        } else if (max == 1 && v == 1) {\n            // we make an exception for u0.8 being set to 1\n        } else {\n            if (Math.abs(v) >= max) {\n                error(`value ${v} is out of range for ${tp}`)\n                return v\n            }\n        }\n\n        return v\n    }\n\n    function parseVal(words: string[]) {\n        const eq = words.shift()\n        if (eq != \"=\" && eq != \":\") error(\"expecting '='\")\n        const val = words.shift()\n        return parseIntCheck(val, true)\n    }\n\n    function packetField(words: string[]) {\n        if (\n            words.length == 2 &&\n            (words[0] == \"repeats\" ||\n                words[0] == \"segmented\" ||\n                words[0] == \"multi-segmented\")\n        ) {\n            nextModifier = words[0]\n            return\n        }\n        const name = normalizeName(words.shift())\n        let defaultValue: number = undefined\n        let isOptional: boolean = undefined\n        let op = words.shift()\n        if (op == \"?\") {\n            isOptional = true\n            op = words.shift()\n        }\n        if (op == \"=\") {\n            defaultValue = parseIntCheck(words.shift(), true)\n            op = words.shift()\n        }\n\n        if (op != \":\") error(\"expecting ':'\")\n\n        const tp = words.shift()\n        const [storage, type, typeShift] = normalizeStorageType(tp)\n        const isFloat = typeShift === null || undefined\n\n        let tok = words.shift()\n        let unit: jdspec.Unit = \"\"\n        if (tok != \"{\") {\n            unit = normalizeUnit(tok)\n            tok = words.shift()\n        }\n\n        if (defaultValue !== undefined) rangeCheck(tp, defaultValue)\n\n        let shift = typeShift || undefined\n        if (unit == \"/\") {\n            // / units should be used with ui0. data\n            if (!/^(u0|i1)\\.\\d+$/.test(tp))\n                error(\n                    `fraction unit must be used with u0.yyy or i1.yyy data types (got ${tp})`\n                )\n\n            shift = Math.abs(storage) * 8\n            if (storage < 0) shift -= 1\n        }\n\n        const field: jdspec.PacketMember = {\n            name,\n            unit,\n            shift,\n            isFloat,\n            type,\n            storage,\n            isSimpleType: canonicalType(storage) == type || undefined,\n            defaultValue,\n            isOptional,\n            multiSegmented: nextModifier == \"multi-segmented\" || undefined,\n            segmented:\n                nextModifier == \"segmented\" ||\n                nextModifier == \"multi-segmented\" ||\n                undefined,\n            startRepeats: nextModifier == \"repeats\" || undefined,\n        }\n\n        if (tok == \"{\") {\n            while (words.length) {\n                tok = words.shift()\n                if (tok == \"}\") break\n                tok = camelize(tok)\n                switch (tok) {\n                    case \"maxBytes\":\n                        ;(field as any)[tok] = rangeCheck(\"u8\", parseVal(words))\n                        break\n                    case \"typicalMin\":\n                    case \"typicalMax\":\n                    case \"absoluteMin\":\n                    case \"absoluteMax\":\n                        ;(field as any)[tok] = rangeCheck(tp, parseVal(words))\n                        break\n                    case \"preferredInterval\":\n                        if ((packetInfo as any)[tok] !== undefined)\n                            error(`field ${tok} already set`)\n                        ;(packetInfo as any)[tok] = rangeCheck(\n                            \"u32\",\n                            parseVal(words)\n                        )\n                        break\n                    default:\n                        error(\"unknown constraint: \" + tok)\n                        break\n                }\n                if (words[0] == \",\") words.shift()\n            }\n            if (tok == \"}\") tok = null\n        }\n\n        if (tok) error(`excessive tokens at the end of member: ${tok}...`)\n\n        if (\n            field.typicalMin === undefined &&\n            field.typicalMax !== undefined &&\n            storage > 0\n        )\n            field.typicalMin = 0\n\n        if (\n            field.absoluteMin === undefined &&\n            field.absoluteMax !== undefined &&\n            storage > 0\n        )\n            field.absoluteMin = 0\n\n        if (!field.storage && field.maxBytes) field.storage = field.maxBytes\n\n        if (/pipe/.test(type)) {\n            packetInfo.pipeType = packetInfo.name\n            if (\n                pipePacket &&\n                pipePacket.name == packetInfo.name &&\n                packetInfo.kind == \"report\"\n            ) {\n                // keep old pipePacket\n            } else {\n                pipePacket = packetInfo\n            }\n        }\n\n        if (\n            !field.isOptional &&\n            packetInfo.fields[packetInfo.fields.length - 1]?.isOptional\n        ) {\n            error(`all fields after an optional field have to optional`)\n        }\n\n        packetInfo.fields.push(field)\n        nextModifier = undefined\n    }\n\n    function startEnum(words: string[]) {\n        checkBraces(null)\n        if (words[2] != \":\" || words[4] != \"{\")\n            error(\"expecting: enum NAME : TYPE {\")\n        enumInfo = {\n            name: normalizeName(words[1]),\n            storage: normalizeStorageType(words[3])[0],\n            isFlags: words[0] == \"flags\" || undefined,\n            members: {},\n        }\n        if (info.enums[enumInfo.name]) error(\"enum redefinition\")\n        info.enums[enumInfo.name] = enumInfo\n    }\n\n    function enumMember(words: string[]) {\n        if (words[1] != \"=\" || words.length != 3)\n            error(`expecting: FIELD_NAME = INTEGER`)\n        enumInfo.members[normalizeName(words[0])] = rangeCheck(\n            canonicalType(enumInfo.storage),\n            parseIntCheck(words[2])\n        )\n    }\n\n    function parseIntCheck(w: string, allowFloat = false) {\n        try {\n            return parseIntFloat(info, w, allowFloat)\n        } catch (e) {\n            error(e.message)\n            return 0\n        }\n    }\n\n    function looksRandom(n: number) {\n        const s = n.toString(16)\n        const h = \"0123456789abcdef\"\n        for (let i = 0; i < h.length; ++i) {\n            const hh = h[i]\n            if (s.indexOf(hh + hh + hh) >= 0) return false\n        }\n        if (/f00d|dead|deaf|beef/.test(s)) return false\n        return true\n    }\n\n    function genRandom() {\n        for (;;) {\n            const m = (Math.random() * 0xfff_ffff) | 0x1000_0000\n            if (looksRandom(m)) return m\n        }\n    }\n\n    function metadataMember(words: string[]) {\n        if (\n            !(\n                (words[1] == \"=\" || words[1] == \":\") &&\n                (words[0] == \"tags\" || words.length == 3)\n            )\n        )\n            error(`expecting: FIELD_NAME = VALUE or FIELD_NAME : VALUE`)\n        switch (words[0]) {\n            case \"extends\":\n                processInclude(words[2])\n                break\n            case \"class\":\n            case \"identifier\": {\n                info.classIdentifier = parseIntCheck(words[2])\n                if (info.name != \"Control\" && info.classIdentifier == 0)\n                    info.classIdentifier = 1\n                const gen = `how about ${toHex(genRandom())}`\n                if (\n                    !(\n                        info.classIdentifier == 0 ||\n                        (0x1000_0001 <= info.classIdentifier &&\n                            info.classIdentifier <= 0x1fff_ff00)\n                    )\n                )\n                    error(`class identifier out of range; ${gen}`)\n                if (!looksRandom(info.classIdentifier))\n                    error(`class identifier doesn't look random; ${gen}`)\n                if (usedIds[info.classIdentifier + \"\"])\n                    error(\n                        `class identifier ${toHex(\n                            info.classIdentifier\n                        )} already used in ${\n                            usedIds[info.classIdentifier + \"\"]\n                        }; ${gen}`\n                    )\n                break\n            }\n            case \"camel\":\n                info.camelName = words[2]\n                break\n            case \"short\":\n                info.shortName = words[2]\n                break\n            case \"high\":\n                info.highCommands = !!parseIntCheck(words[2])\n                break\n            case \"status\":\n                if (\n                    [\"stable\", \"experimental\", \"deprecated\"].indexOf(words[2]) >\n                    -1\n                )\n                    info.status = <any>words[2]\n                else error(\"unknown status\")\n                break\n            case \"group\":\n                info.group = capitalize(words.slice(2).join(\" \"))\n                break\n            case \"tags\": {\n                const tags = words.slice(2).filter(w => w != \",\" && w != \";\")\n                info.tags = info.tags.concat(tags)\n                break\n            }\n            default:\n                error(\"unknown metadata field: \" + words[0])\n                break\n        }\n    }\n\n    function processInclude(name: string) {\n        if (name == \"_system\") return\n        const inner = includes[name]\n        if (!inner) return error(\"include file not found: \" + name)\n        if (\n            info.packets.some(pkt => !pkt.derived) ||\n            values(info.enums).some(e => !e.derived)\n        )\n            error(\"extends: only allowed on top of the .md file\")\n        if (inner.errors) errors = errors.concat(inner.errors)\n        const innerEnums = clone(inner.enums)\n        Object.keys(innerEnums)\n            .filter(k => !info.enums[k])\n            .forEach(k => {\n                const ie = innerEnums[k]\n                ie.derived = name\n                info.enums[k] = ie\n            })\n        const innerPackets = clone(\n            inner.packets.filter(\n                pkt =>\n                    !info.packets.find(\n                        ipkt =>\n                            ipkt.kind === pkt.kind &&\n                            ipkt.identifier === pkt.identifier\n                    )\n            )\n        )\n        innerPackets.forEach(pkt => (pkt.derived = name))\n        info.packets = [...info.packets, ...innerPackets]\n        if (inner.highCommands) info.highCommands = true\n        info.extends = inner.extends.concat([name])\n    }\n\n    function clone<T>(v: T): T {\n        return JSON.parse(JSON.stringify(v))\n    }\n\n    function error(msg: string) {\n        if (!msg) msg = \"syntax error\"\n        if (errors.some(e => e.line == lineNo && e.message == msg)) return\n        errors.push({ file: filename, line: lineNo, message: msg })\n    }\n\n    function warn(msg: string) {\n        if (info.camelName == \"system\") return // no warnings in _system\n        if (errors.some(e => e.line == lineNo && e.message == msg)) return\n        errors.push({ file: filename, line: lineNo, message: msg })\n    }\n\n    function normalizeName(n: string) {\n        if (!/^\\w+$/.test(n)) error(\"expecting name here\")\n        if (n.length > 31) error(`name '${n}' too long`)\n        return n\n    }\n\n    function normalizeStorageType(\n        tp: string\n    ): [jdspec.StorageType, string, number] {\n        if (info.enums[tp]) return [info.enums[tp].storage, tp, 0]\n        if (!tp) error(\"expecting type here\")\n        const tp2 = tp.replace(/_t$/, \"\").toLowerCase()\n        const m = /^([ui])(\\d+)\\.(\\d+)$/.exec(tp2)\n        if (m) {\n            const a = parseIntCheck(m[2])\n            const b = parseIntCheck(m[3])\n            const len = a + b\n            if (!(len == 8 || len == 16 || len == 32 || len == 64))\n                error(`fixed point ${tp} can't be ${len} bits`)\n            if (a == 0 && m[1] == \"i\")\n                error(\n                    `fixed point ${tp} can't be i0.X; has to be at least i1.X`\n                )\n            return [(m[1] == \"i\" ? -1 : 1) * (len >> 3), tp2, b]\n        }\n\n        switch (tp2) {\n            case \"bool\":\n                return [1, tp2, 0]\n            case \"i8\":\n            case \"u8\":\n            case \"i16\":\n            case \"u16\":\n            case \"i32\":\n            case \"u32\":\n            case \"i64\":\n            case \"u64\": {\n                let sz = parseIntCheck(tp2.replace(/^./, \"\")) >> 3\n                if (tp2[0] == \"i\") sz = -sz\n                return [sz, tp2, 0]\n            }\n            case \"f16\":\n                return [2, tp2, null]\n            case \"f32\":\n                return [4, tp2, null]\n            case \"f64\":\n                return [8, tp2, null]\n            case \"pipe\":\n                return [12, tp2, 0]\n            case \"pipe_port\":\n                return [2, tp2, 0]\n            case \"devid\":\n                return [8, tp2, 0]\n            case \"bytes\":\n            case \"string\":\n            case \"string0\":\n                return [0, tp2, 0]\n            default: {\n                const m = /^u8\\[(\\d+)\\]$/.exec(tp2)\n                if (m) return [parseIntCheck(m[1]), tp2, 0]\n                error(\"unknown type: \" + tp + \" \" + tp2)\n                return [4, tp2, 0]\n            }\n        }\n    }\n\n    function normalizeUnit(unit: string): jdspec.Unit {\n        if (unit === undefined || unit === null) return \"\"\n\n        if (unitDescription[unit] || secondaryUnitConverters[unit])\n            return unit as jdspec.Unit\n        error(`expecting unit, got '${unit}'`)\n        return \"\"\n    }\n\n    function hasNaturalAlignment(iface: jdspec.PacketInfo) {\n        let byteOffset = 0\n\n        for (const m of iface.fields) {\n            const sz = memberSize(m)\n            if (sz == 0) continue\n            const pad = sz > 4 ? 4 : sz\n            if (!/^u8\\[/.test(m.type) && byteOffset % pad != 0) return false\n            byteOffset += sz\n        }\n\n        return true\n    }\n}\n\nfunction values<T>(o: jdspec.SMap<T>): T[] {\n    const r: T[] = []\n    for (const k of Object.keys(o)) r.push(o[k])\n    return r\n}\n\nfunction fail(msg: string) {\n    throw new Error(msg)\n}\n\nfunction toUpper(name: string) {\n    return name\n        ?.replace(/([a-z])([A-Z])/g, (x, a, b) => a + \"_\" + b)\n        .toUpperCase()\n}\n\nfunction toLower(name: string) {\n    return name\n        ?.replace(/([a-z])([A-Z])/g, (x, a, b) => a + \"_\" + b)\n        .toLowerCase()\n}\n\nfunction packed(iface: jdspec.PacketInfo) {\n    if (!iface.packed) return \"\"\n    else return \" __attribute__((packed))\"\n}\n\nfunction cStorage(tp: jdspec.StorageType) {\n    if (tp == 0 || [1, 2, 4, 8].indexOf(Math.abs(tp)) < 0) return \"bytes\"\n    if (tp < 0) return `int${-tp * 8}_t`\n    else return `uint${tp * 8}_t`\n}\n\nfunction canonicalType(tp: jdspec.StorageType): string {\n    if (tp == 0) return \"bytes\"\n    if (tp < 0) return `i${-tp * 8}`\n    else return `u${tp * 8}`\n}\n\nfunction isRegister(k: jdspec.PacketKind) {\n    return k == \"ro\" || k == \"rw\" || k == \"const\"\n}\n\nfunction toHex(n: number): string {\n    if (n === undefined) return \"\"\n    if (n < 0) return \"-\" + toHex(n)\n    return \"0x\" + n.toString(16)\n}\n\nfunction unitPref(f: jdspec.PacketMember) {\n    if (!f.unit) return \"\"\n    else return prettyUnit(f.unit) + \" \"\n}\n\nfunction prettyUnit(u: jdspec.Unit): string {\n    switch (u) {\n        case \"us\":\n            return \"s\"\n        case \"C\":\n            return \"C\"\n        case \"/\":\n            return \"ratio\"\n        default:\n            return u\n    }\n}\n\nfunction toH(info: jdspec.ServiceSpec) {\n    let r = \"// Autogenerated C header file for \" + info.name + \"\\n\"\n    const hdDef = `_JACDAC_SPEC_${toUpper(info.camelName)}_H`\n    r += `#ifndef ${hdDef}\\n`\n    r += `#define ${hdDef} 1\\n`\n\n    let pref = \"JD_\" + toUpper(info.shortName) + \"_\"\n\n    if (info.shortId[0] == \"_\") pref = \"JD_\"\n\n    if (info.shortId[0] != \"_\")\n        r += `\\n#define JD_SERVICE_CLASS_${toUpper(info.shortName)}  ${toHex(\n            info.classIdentifier\n        )}\\n`\n\n    for (const en of values(info.enums).filter(en => !en.derived)) {\n        const enPref = pref + toUpper(en.name)\n        r += `\\n// enum ${en.name} (${cStorage(en.storage)})\\n`\n        for (const k of Object.keys(en.members))\n            r +=\n                \"#define \" +\n                enPref +\n                \"_\" +\n                toUpper(k) +\n                \" \" +\n                toHex(en.members[k]) +\n                \"\\n\"\n    }\n    for (const pkt of info.packets) {\n        if (pkt.derived) continue\n\n        const cmt = addComment(pkt)\n        r += wrapComment(cmt.comment)\n\n        if (\n            !pkt.secondary &&\n            pkt.kind != \"pipe_command\" &&\n            pkt.kind != \"pipe_report\"\n        ) {\n            let inner = \"CMD\"\n            if (isRegister(pkt.kind)) inner = \"REG\"\n            else if (pkt.kind == \"event\") inner = \"EV\"\n            else if (\n                pkt.kind == \"meta_pipe_command\" ||\n                pkt.kind == \"meta_pipe_report\"\n            )\n                inner = \"PIPE\"\n            let val = toHex(pkt.identifier)\n            if (pkt.identifierName)\n                val = \"JD_\" + inner + \"_\" + toUpper(pkt.identifierName)\n            const name = pref + inner + \"_\" + toUpper(pkt.name)\n            if (name != val) r += `#define ${name} ${val}\\n`\n        }\n\n        const isMetaPipe =\n            pkt.kind == \"meta_pipe_report\" || pkt.kind == \"meta_pipe_command\"\n\n        if (cmt.needsStruct || isMetaPipe) {\n            let tname =\n                \"jd_\" + toLower(info.camelName) + \"_\" + toLower(pkt.name)\n            if (pkt.kind == \"report\") tname += \"_report\"\n            r += `typedef struct ${tname} {\\n`\n            if (isMetaPipe) {\n                r += `    uint32_t identifier; // ${toHex(pkt.identifier)}\\n`\n            }\n            let unaligned = \"\"\n            for (let i = 0; i < pkt.fields.length; ++i) {\n                const f = pkt.fields[i]\n                let def = \"\"\n                const cst = cStorage(f.storage)\n                const sz = memberSize(f)\n                if (f.type == \"string\" || f.type == \"string0\")\n                    def = `char ${f.name}[${sz}]`\n                else if (cst == \"bytes\") def = `uint8_t ${f.name}[${sz}]`\n                else def = `${cst} ${f.name}`\n                // if it's the last field and it start repeats, treat it as an array\n                if (f.startRepeats && i == pkt.fields.length - 1) def += \"[0]\"\n                def += \";\"\n                if (!f.isSimpleType && f.type != \"devid\")\n                    def += \"  // \" + unitPref(f) + f.type\n                else if (f.unit) def += \" // \" + prettyUnit(f.unit)\n                r += \"    \" + unaligned + def + \"\\n\"\n                if (f.type == \"string0\") unaligned = \"// \"\n            }\n            r += `}${packed(pkt)} ${tname}_t;\\n\\n`\n        }\n    }\n    r += \"\\n#endif\\n\"\n    return r\n}\n\nexport function camelize(name: string) {\n    if (!name) return name\n    return (\n        name[0].toLowerCase() +\n        name.slice(1).replace(/_([a-z0-9])/gi, (_, l) => l.toUpperCase())\n    )\n}\n\nexport function capitalize(name: string) {\n    if (!name) return name\n    return name[0].toUpperCase() + name.slice(1)\n}\n\nfunction upperCamel(name: string) {\n    name = camelize(name)\n    if (!name?.length) return name\n    return name[0].toUpperCase() + name.slice(1)\n}\n\nexport function snakify(name: string) {\n    return name?.replace(/([a-z])([A-Z])/g, (_, a, b) => a + \"_\" + b)\n}\n\nexport function dashify(name: string) {\n    if (!name) return name\n    return snakify(name.replace(/^_+/, \"\")).replace(/_/g, \"-\").toLowerCase()\n}\n\nexport function humanify(name: string) {\n    return name\n        ?.replace(/([a-z])([A-Z])/g, (_, a, b) => a + \" \" + b)\n        .replace(/(-|_)/g, \" \")\n}\n\nfunction addComment(pkt: jdspec.PacketInfo) {\n    let comment = \"\"\n\n    let typeInfo = \"\"\n    let needsStruct = false\n    if (pkt.fields.length == 0) {\n        if (pkt.kind != \"event\") typeInfo = \"No args\"\n    } else if (pkt.fields.length == 1 && !pkt.fields[0].startRepeats) {\n        const f0 = pkt.fields[0]\n        typeInfo = cStorage(f0.storage)\n        if (!f0.isSimpleType) typeInfo = f0.type + \" (\" + typeInfo + \")\"\n        typeInfo = unitPref(f0) + typeInfo\n        if (f0.name != \"_\") typeInfo = f0.name + \" \" + typeInfo\n    } else {\n        needsStruct = true\n    }\n\n    if (pkt.fields.length == 1) {\n        if (isRegister(pkt.kind)) {\n            let info = \"\"\n            if (pkt.kind == \"ro\") info = \"Read-only\"\n            else if (pkt.kind == \"const\") info = \"Constant\"\n            else info = \"Read-write\"\n            if (typeInfo) typeInfo = info + \" \" + typeInfo\n            else typeInfo = info\n        } else if (typeInfo) {\n            typeInfo = \"Argument: \" + typeInfo\n        }\n    }\n\n    if (pkt.kind == \"report\" && pkt.secondary) {\n        comment += \"Report: \" + typeInfo + \"\\n\"\n    } else {\n        if (pkt.description) {\n            let desc = pkt.description.replace(/\\n\\n[^]*/, \"\")\n            if (typeInfo) desc = typeInfo + \". \" + desc\n            comment = desc + \"\\n\" + comment\n        }\n    }\n\n    return {\n        comment,\n        needsStruct,\n    }\n}\n\nfunction wrapComment(comment: string) {\n    return (\n        \"\\n/**\\n * \" +\n        comment.replace(/\\n+$/, \"\").replace(/\\n/g, \"\\n * \") +\n        \"\\n */\\n\"\n    )\n}\n\nfunction wrapSnippet(code: string) {\n    if (!code) return code\n    return `\n\\`\\`\\`\n${code.replace(/^\\n+/, \"\").replace(/\\n+$/, \"\")}\n\\`\\`\\`\n`\n}\n\nexport const TYPESCRIPT_STATIC_NAMESPACE = \"jacdac\"\nfunction packFormatForField(\n    info: jdspec.ServiceSpec,\n    fld: jdspec.PacketMember,\n    isStatic?: boolean,\n    useBooleans?: boolean\n) {\n    const sz = memberSize(fld)\n    const szSuff = sz ? `[${sz}]` : ``\n    let tsType = \"number\"\n    let fmt = \"\"\n    if (/^[fiu]\\d+(\\.\\d+)?$/.test(fld.type) && 1 <= sz && sz <= 8) {\n        fmt = fld.type\n    } else if (/^u8\\[\\d*\\]$/.exec(fld.type)) {\n        fmt = \"b\" + szSuff\n    } else if (info.enums[fld.type]) {\n        fmt = canonicalType(info.enums[fld.type].storage)\n        tsType = upperCamel(info.camelName) + upperCamel(fld.type)\n        if (isStatic) tsType = TYPESCRIPT_STATIC_NAMESPACE + \".\" + tsType\n    } else {\n        switch (fld.type) {\n            case \"string\":\n                fmt = \"s\" + szSuff\n                tsType = \"string\"\n                break\n            case \"bytes\":\n                fmt = \"b\" + szSuff\n                break\n            case \"string0\":\n                fmt = \"z\"\n                tsType = \"string\"\n                break\n            case \"devid\":\n                fmt = \"b[8]\"\n                break\n            case \"pipe_port\":\n                fmt = \"u16\"\n                break\n            case \"pipe\":\n                fmt = \"b[12]\"\n                break\n            case \"bool\":\n                // TODO native bool support\n                fmt = \"u8\"\n                if (useBooleans) tsType = \"boolean\"\n                break\n            default:\n                return null\n        }\n    }\n\n    if (tsType == \"number\" && fmt && fmt[0] == \"b\") tsType = \"Buffer\"\n    return { fmt, tsType }\n}\n\n/**\n * Generates the format to pack/unpack a data payload for this packet\n * @param pkt\n * TODO fix this\n */\nexport function packFormat(\n    sinfo: jdspec.ServiceSpec,\n    pkt: jdspec.PacketInfo,\n    useBooleans?: boolean\n): string {\n    if (pkt.packed || !pkt.fields?.length) return undefined\n\n    const fmt: string[] = []\n    for (const fld of pkt.fields) {\n        if (fld.startRepeats) fmt.push(\"r:\")\n        const ff = packFormatForField(sinfo, fld, false, useBooleans)\n        if (!ff) return undefined\n        fmt.push(ff.fmt)\n    }\n\n    return fmt.join(\" \")\n}\n\nexport function packInfo(\n    info: jdspec.ServiceSpec,\n    pkt: jdspec.PacketInfo,\n    isStatic: boolean,\n    useBooleans?: boolean\n) {\n    const vars: string[] = []\n    const vartp: string[] = []\n    let fmt = \"\"\n    let repeats: string[]\n    let reptp: string[]\n\n    for (let i = 0; i < pkt.fields.length; ++i) {\n        const fld = pkt.fields[i]\n        let isArray = \"\"\n        if (fld.startRepeats) {\n            if (i == pkt.fields.length - 1) {\n                isArray = \"[]\"\n            } else {\n                fmt += \"r: \"\n                repeats = []\n                reptp = []\n                vars.push(\"rest\")\n            }\n        }\n        const varname = camelize(fld.name == \"_\" ? pkt.name : fld.name)\n        const f0 = packFormatForField(info, fld, isStatic, useBooleans)\n        if (!f0 || /(reserved|padding)/.test(fld.name)) {\n            if (!f0)\n                console.log(\n                    `${pkt.name}/${fld.name} - can't get format for '${fld.type}'`\n                )\n            fmt += `x[${memberSize(fld)}] `\n        } else {\n            fmt += f0.fmt + isArray + \" \"\n            let tp = f0.tsType\n            if (tp == \"Buffer\" && !isStatic) tp = \"Uint8Array\"\n            tp += isArray\n            if (repeats) {\n                repeats.push(varname)\n                reptp.push(tp)\n            } else {\n                vars.push(varname)\n                vartp.push(tp)\n            }\n        }\n    }\n\n    fmt = fmt.replace(/ *$/, \"\")\n\n    if (reptp) vartp.push(\"([\" + reptp.join(\", \") + \"])[]\")\n\n    let buffers = \"\"\n    buffers += `const [${vars.join(\", \")}] = jdunpack<[${vartp.join(\n        \", \"\n    )}]>(buf, \"${fmt}\")\\n`\n    if (repeats) buffers += `const [${repeats.join(\", \")}] = rest[0]\\n`\n\n    buffers = buffers.replace(/\\n*$/, \"\")\n\n    return {\n        buffers,\n        names: vars,\n        types: vartp,\n    }\n}\n\nfunction memberSize(fld: jdspec.PacketMember) {\n    return Math.abs(fld.storage)\n}\n\nfunction toTypescript(info: jdspec.ServiceSpec, staticTypeScript: boolean) {\n    const indent = staticTypeScript ? \"    \" : \"\"\n    const indent2 = indent + \"    \"\n    const enumkw = staticTypeScript\n        ? indent + \"export const enum\"\n        : \"export enum\"\n    let r = staticTypeScript\n        ? `namespace ${TYPESCRIPT_STATIC_NAMESPACE} {\\n`\n        : \"\"\n    r += indent + \"// Service: \" + info.name + \"\\n\"\n    if (info.shortId[0] != \"_\") {\n        r +=\n            indent +\n            `export const SRV_${snakify(\n                info.camelName\n            ).toLocaleUpperCase()} = ${toHex(info.classIdentifier)}\\n`\n    }\n    const pref = upperCamel(info.camelName)\n    for (const en of values(info.enums)) {\n        const enPref = pref + upperCamel(en.name)\n        r += `\\n${enumkw} ${enPref} { // ${cStorage(en.storage)}\\n`\n        for (const k of Object.keys(en.members))\n            r += indent2 + k + \" = \" + toHex(en.members[k]) + \",\\n\"\n        r += indent + \"}\\n\\n\"\n    }\n    const tsEnums: jdspec.SMap<string> = {}\n\n    for (const pkt of info.packets) {\n        if (pkt.derived) continue\n\n        const cmt = addComment(pkt)\n        const pack = pkt.fields.length\n            ? packInfo(info, pkt, staticTypeScript).buffers\n            : \"\"\n\n        let inner = \"Cmd\"\n        if (isRegister(pkt.kind)) inner = \"Reg\"\n        else if (pkt.kind == \"event\") inner = \"Event\"\n        else if (\n            pkt.kind == \"meta_pipe_command\" ||\n            pkt.kind == \"meta_pipe_report\"\n        )\n            inner = \"PipeCmd\"\n        else if (pkt.kind == \"pipe_command\" || pkt.kind == \"pipe_report\")\n            inner = \"info\"\n\n        let text = \"\"\n        let meta = \"\"\n        if (pkt.secondary || inner == \"info\") {\n            if (pack)\n                text = wrapComment(\n                    `${pkt.kind} ${upperCamel(pkt.name)}${wrapSnippet(pack)}`\n                )\n        } else {\n            const val = toHex(pkt.identifier)\n            if (staticTypeScript && pkt.kind === \"event\") {\n                meta = `//% block=\"${snakify(pkt.name).replace(/_/g, \" \")}\"\\n`\n            }\n            text = `${\n                wrapComment(cmt.comment + wrapSnippet(pack)) + meta\n            }${upperCamel(pkt.name)} = ${val},\\n`\n        }\n\n        if (text) tsEnums[inner] = (tsEnums[inner] || \"\") + text\n\n        // don't line const strings in makecode,\n        // they don't get dropped efficiently\n    }\n\n    for (const k of Object.keys(tsEnums)) {\n        if (k == \"info\") r += tsEnums[k].replace(/^/gm, indent) + \"\\n\\n\"\n        else {\n            const inner = tsEnums[k]\n                .replace(/^\\n+/, \"\")\n                .replace(/\\n$/, \"\")\n                .replace(/\\n/g, \"\\n    \" + indent)\n            r += `${enumkw} ${pref}${k} {\\n    ${indent}${inner}\\n${indent}}\\n\\n`\n        }\n    }\n\n    if (staticTypeScript) r += \"}\\n\"\n\n    return r.replace(/ *$/gm, \"\")\n}\n\nexport function normalizeDeviceSpecification(dev: jdspec.DeviceSpec) {\n    // reorder fields\n    const clone: jdspec.DeviceSpec = {\n        id: (dev.id =\n            escapeDeviceIdentifier(dev.company) +\n            \"-\" +\n            escapeDeviceNameIdentifier(dev.name)),\n        name: dev.name,\n        company: dev.company,\n        description: dev.description,\n        repo: dev.repo,\n        link: dev.link,\n        services: dev.services || [],\n        firmwares: dev.firmwares || [],\n    }\n    return clone\n}\n\nexport function escapeDeviceIdentifier(text: string) {\n    if (!text) text = \"\"\n    const escaped = text\n        .trim()\n        .toLowerCase()\n        .replace(/([^a-z0-9\\_-])+/gi, \"-\")\n        .replace(/^-+/, \"\")\n        .replace(/-+$/, \"\")\n    const id = snakify(escaped)\n    return id\n}\n\nexport function escapeDeviceNameIdentifier(text: string) {\n    return escapeDeviceIdentifier(text).replace(/-/g, \"\")\n}\n\nexport function converters(): jdspec.SMap<(s: jdspec.ServiceSpec) => string> {\n    return {\n        json: (j: jdspec.ServiceSpec) => JSON.stringify(j, null, 2),\n        c: toH,\n        ts: j => toTypescript(j, false),\n        sts: j => toTypescript(j, true),\n        /*\n        \"cpp\": toHPP,\n        */\n    }\n}\n\nexport function isNumericType(field: jdspec.PacketMember) {\n    const tp = field.type\n    return (\n        !field.startRepeats &&\n        /^[uif]\\d+(\\.\\d+)?$/.test(tp) &&\n        tp != \"pipe_port\" &&\n        tp != \"bool\"\n    )\n}\n"],"sourceRoot":""}
{"version":3,"sources":["webpack:///./jacdac-ts/jacdac-spec/spectool/jdutils.ts","webpack:///./jacdac-ts/jacdac-spec/spectool/jdspec.ts"],"names":["isRegister","pkt","kind","packetsToRegisters","packets","filter","derived","lookupRegister","spec","id","find","name","lookupField","field","fields","member","getRegister","w","ret","test","Error","shortName","exec","reg","fld","parseIntFloat","allowFloat","v","parseInt","replace","isNaN","parseFloat","ww","split","length","en","enums","members","hasOwnProperty","DEVICE_IMAGE_WIDTH","DEVICE_IMAGE_HEIGHT","unitDescription","m","kg","s","A","K","cd","mol","Hz","rad","sr","N","Pa","J","W","C","V","F","Ohm","S","Wb","T","H","lm","lx","Bq","Gy","Sv","kat","m2","m3","bit","lat","lon","pH","dB","dBW","count","EL","B","VA","VAs","var","vars","hsv","rgb","rpm","uv","lux","bpm","mcd","px","secondaryUnitConverters","ms","unit","scale","offset","min","h","MHz","kW","kVA","kvar","Ah","Wh","kWh","varh","kvarh","kVAh","KiB","GB","mV","mA","dBm","ppm","ppb","hPa","mm","cm","km","nm","nT","frac","us","mWh","g","resolveUnit","su","undefined","units","r","Object","keys","forEach","k","push","description","scd","sort","l","localeCompare","identifierRanges","rw","ro","const","command","report","event","parseServiceSpecificationMarkdownToJSON","filecontent","includes","filename","info","status","shortId","camelName","extends","notes","classIdentifier","tags","backticksType","enumInfo","packetInfo","pipePacket","errors","lineNo","noteId","lastCmd","packetsToDescribe","nextModifier","systemInfo","usedIds","values","prev","processInclude","line","processLine","e","error","message","normalizeMD","camelize","f","toUpperCase","packFormat","trim","interpret","slice","hd","cont","newNoteId","toLowerCase","iface","expanded","words","pop","cmd","startEnum","startPacket","finishPacket","packetField","enumMember","metadataMember","packed","hasNaturalAlignment","warn","repeats","hadzero","p","startRepeats","storage","type","pid","identifier","ranges","some","range","toString","map","join","md","checkBraces","forceSection","sectionId","kindSt","shift","w2","internal","isReport","unshift","normalizeName","secondary","hasReport","optional","pipeType","atat","indexOf","isSet","systemPacket","identifierName","isUser","isSystem","isHigh","toHex","highCommands","splice","last","rangeCheck","tp","normalizeStorageType","typeShift","Math","floor","bits","max","abs","parseVal","eq","val","parseIntCheck","defaultValue","isOptional","op","isFloat","tok","normalizeUnit","isSimpleType","canonicalType","multiSegmented","segmented","typicalMin","typicalMax","absoluteMin","absoluteMax","maxBytes","isFlags","looksRandom","n","i","hh","genRandom","random","gen","group","capitalize","concat","inner","innerEnums","clone","ie","innerPackets","ipkt","JSON","parse","stringify","msg","file","tp2","a","b","len","sz","byteOffset","memberSize","pad","o","fail","toUpper","x","toLower","cStorage","unitPref","prettyUnit","u","toH","hdDef","pref","enPref","cmt","addComment","wrapComment","comment","isMetaPipe","needsStruct","tname","unaligned","def","cst","_","upperCamel","snakify","dashify","humanify","typeInfo","f0","desc","wrapSnippet","code","TYPESCRIPT_STATIC_NAMESPACE","packFormatForField","isStatic","useBooleans","szSuff","tsType","fmt","sinfo","ff","packInfo","vartp","reptp","isArray","varname","console","log","buffers","names","types","toTypescript","staticTypeScript","indent","indent2","enumkw","toLocaleUpperCase","tsEnums","pack","text","meta","normalizeDeviceSpecification","dev","escapeDeviceIdentifier","company","escapeDeviceNameIdentifier","repo","link","services","firmwares","escaped","converters","json","j","c","ts","sts"],"mappings":";;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEO,SAASA,UAAT,CAAoBC,GAApB,EAAqD;AACxD,SAAOA,GAAG,KAAKA,GAAG,CAACC,IAAJ,IAAY,OAAZ,IAAuBD,GAAG,CAACC,IAAJ,IAAY,IAAnC,IAA2CD,GAAG,CAACC,IAAJ,IAAY,IAA5D,CAAV;AACH;AAEM,SAASC,kBAAT,CAA4BC,OAA5B,EAA0D;AAC7D,SAAOA,OAAO,CAACC,MAAR,CAAe,UAAAJ,GAAG;AAAA,WAAI,CAACA,GAAG,CAACK,OAAL,IAAgBN,UAAU,CAACC,GAAD,CAA9B;AAAA,GAAlB,CAAP;AACH;AACM,SAASM,cAAT,CACHC,IADG,EAEHC,EAFG,EAGc;AACjB,SAAOD,IAAI,CAACJ,OAAL,CAAaM,IAAb,CAAkB,UAAAT,GAAG;AAAA,WAAID,UAAU,CAACC,GAAD,CAAV,IAAmBA,GAAG,CAACU,IAAJ,KAAaF,EAApC;AAAA,GAArB,CAAP;AACH;AAEM,SAASG,WAAT,CACHX,GADG,EAEHY,KAFG,EAGgB;AACnB,SAAOZ,GAAG,CAACa,MAAJ,CAAWJ,IAAX,CAAgB,UAAAK,MAAM;AAAA,WAAIA,MAAM,CAACJ,IAAP,KAAgBE,KAApB;AAAA,GAAtB,CAAP;AACH;AAOM,SAASG,WAAT,CAAqBR,IAArB,EAA+CS,CAA/C,EAAoE;AACvE,MAAMC,GAAa,GAAG;AAAEjB,OAAG,EAAE;AAAP,GAAtB;;AACA,MAAI,QAAQkB,IAAR,CAAaF,CAAb,CAAJ,EAAqB;AACjBC,OAAG,CAACjB,GAAJ,GAAUM,cAAc,CAACC,IAAD,EAAOS,CAAP,CAAxB;;AACA,QAAI,CAACC,GAAG,CAACjB,GAAT,EAAc;AACV,YAAM,IAAImB,KAAJ,kBACaH,CADb,0BACmCT,IAAI,CAACa,SADxC,CAAN;AAGH;AACJ,GAPD,MAOO,IAAI,aAAaF,IAAb,CAAkBF,CAAlB,CAAJ,EAA0B;AAAA,iBACR,iBAAiBK,IAAjB,CAAsBL,CAAtB,CADQ;AAAA,QACtBM,GADsB;AAAA,QACjBV,KADiB;;AAE7BK,OAAG,CAACjB,GAAJ,GAAUM,cAAc,CAACC,IAAD,EAAOe,GAAP,CAAxB;;AACA,QAAI,CAACL,GAAG,CAACjB,GAAT,EAAc;AACV,YAAM,IAAImB,KAAJ,kBACaG,GADb,0BACqCf,IAAI,CAACa,SAD1C,CAAN;AAGH,KAJD,MAIO;AACHH,SAAG,CAACM,GAAJ,GAAUZ,WAAW,CAACM,GAAG,CAACjB,GAAL,EAAUY,KAAV,CAArB;AACA,UAAI,CAACK,GAAG,CAACM,GAAT,EACI,MAAM,IAAIJ,KAAJ,eACUP,KADV,2BACqCU,GADrC,oBACuDf,IAAI,CAACa,SAD5D,CAAN;AAGP;AACJ;;AACD,SAAOH,GAAP;AACH;AAEM,SAASO,aAAT,CACHjB,IADG,EAEHS,CAFG,EAGHS,UAHG,EAIG;AAAA,MADNA,UACM;AADNA,cACM,GADO,KACP;AAAA;;AACN,MAAI,mBAAmBP,IAAnB,CAAwBF,CAAxB,KAA8B,aAAaE,IAAb,CAAkBF,CAAlB,CAAlC,EAAwD;AACpD,QAAMU,CAAC,GAAGC,QAAQ,CAACX,CAAC,CAACY,OAAF,CAAU,IAAV,EAAgB,EAAhB,CAAD,CAAlB,CADoD,CACZ;;AACxC,QAAIC,KAAK,CAACH,CAAD,CAAT,EAAc,MAAM,IAAIP,KAAJ,CAAU,sBAAsBH,CAAhC,CAAN;AACd,WAAOU,CAAP;AACH;;AAED,MAAID,UAAU,IAAI,6BAA6BP,IAA7B,CAAkCF,CAAlC,CAAlB,EAAwD;AACpD,QAAMU,EAAC,GAAGI,UAAU,CAACd,CAAD,CAApB;;AACA,QAAIa,KAAK,CAACH,EAAD,CAAT,EAAc,MAAM,IAAIP,KAAJ,CAAU,wBAAwBH,CAAlC,CAAN;AACd,WAAOU,EAAP;AACH;;AAED,MAAMK,EAAE,GAAGf,CAAC,CAACgB,KAAF,CAAQ,IAAR,CAAX;;AACA,MAAID,EAAE,CAACE,MAAH,IAAa,CAAjB,EAAoB;AAChB,UAAM,IAAId,KAAJ,qCAAN;AACH;;AACD,MAAMe,EAAE,GAAG3B,IAAI,CAAC4B,KAAL,CAAWJ,EAAE,CAAC,CAAD,CAAb,CAAX;;AACA,MAAI,CAACG,EAAL,EAAS;AACL,UAAM,IAAIf,KAAJ,CAAaY,EAAE,CAAC,CAAD,CAAf,0BAAN;AACH,GApBK,CAqBN;;;AACA,MAAI,CAACG,EAAE,CAACE,OAAH,CAAWC,cAAX,CAA0BN,EAAE,CAAC,CAAD,CAA5B,CAAL,EACI,MAAM,IAAIZ,KAAJ,CAAaY,EAAE,CAAC,CAAD,CAAf,4BAAyCA,EAAE,CAAC,CAAD,CAA3C,CAAN;AACJ,SAAOG,EAAE,CAACE,OAAH,CAAWL,EAAE,CAAC,CAAD,CAAb,KAAqB,CAA5B;AACH,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrFD;AACA;AACA;AAEO,IAAMO,kBAAkB,GAAG,GAA3B;AACA,IAAMC,mBAAmB,GAAG,GAA5B,C,CAEP;;AACO,IAAMC,eAAoC,GAAG;AAChD,OAAK,OAD2C;AAEhD,SAAO,eAFyC;AAGhD,UAAQ,uBAHwC;AAIhDC,GAAC,EAAE,OAJ6C;AAKhDC,IAAE,EAAE,UAL4C;AAMhDC,GAAC,EAAE,QAN6C;AAOhDC,GAAC,EAAE,QAP6C;AAQhDC,GAAC,EAAE,QAR6C;AAShDC,IAAE,EAAE,SAT4C;AAUhDC,KAAG,EAAE,MAV2C;AAWhDC,IAAE,EAAE,OAX4C;AAYhDC,KAAG,EAAE,QAZ2C;AAahDC,IAAE,EAAE,WAb4C;AAchDC,GAAC,EAAE,QAd6C;AAehDC,IAAE,EAAE,QAf4C;AAgBhDC,GAAC,EAAE,OAhB6C;AAiBhDC,GAAC,EAAE,MAjB6C;AAkBhDC,GAAC,EAAE,SAlB6C;AAmBhDC,GAAC,EAAE,MAnB6C;AAoBhDC,GAAC,EAAE,OApB6C;AAqBhDC,KAAG,EAAE,KArB2C;AAsBhDC,GAAC,EAAE,SAtB6C;AAuBhDC,IAAE,EAAE,OAvB4C;AAwBhDC,GAAC,EAAE,OAxB6C;AAyBhDC,GAAC,EAAE,OAzB6C;AA0BhD,QAAM,iBA1B0C;AA2BhDC,IAAE,EAAE,OA3B4C;AA4BhDC,IAAE,EAAE,KA5B4C;AA6BhDC,IAAE,EAAE,WA7B4C;AA8BhDC,IAAE,EAAE,MA9B4C;AA+BhDC,IAAE,EAAE,SA/B4C;AAgChDC,KAAG,EAAE,OAhC2C;AAiChDC,IAAE,EAAE,qBAjC4C;AAkChDC,IAAE,EAAE,sBAlC4C;AAmChD,SAAO,6BAnCyC;AAoChD,UAAQ,wCApCwC;AAqChD,UAAQ,oCArCwC;AAsChD,UAAQ,oCAtCwC;AAuChD,WAAS,sCAvCuC;AAwChDC,KAAG,EAAE,2BAxC2C;AAyChD,WAAS,4BAzCuC;AA0ChDC,KAAG,EAAE,kBA1C2C;AA2ChDC,KAAG,EAAE,mBA3C2C;AA4ChDC,IAAE,EAAE,0CA5C4C;AA6ChDC,IAAE,EAAE,gCA7C4C;AA8ChDC,KAAG,EAAE,uCA9C2C;AA+ChDC,OAAK,EAAE,mBA/CyC;AAgDhD,OAAK,mCAhD2C;AAiDhD,SAAO,gCAjDyC;AAkDhD,SAAO,6CAlDyC;AAmDhDC,IAAE,EAAE,0CAnD4C;AAoDhD,SAAO,2BApDyC;AAqDhD,SAAO,kCArDyC;AAsDhDC,GAAC,EAAE,4BAtD6C;AAuDhDC,IAAE,EAAE,8BAvD4C;AAwDhDC,KAAG,EAAE,sCAxD2C;AAyDhDC,KAAG,EAAE,uCAzD2C;AA0DhDC,MAAI,EAAE,+CA1D0C;AA2DhD,SAAO,uCA3DyC;AA4DhD,WAAS,6DA5DuC;AA6DhD,WAAS,kCA7DuC;AA8DhD,WAAS,QA9DuC;AA+DhDC,KAAG,EAAE,eA/D2C;AAgEhDC,KAAG,EAAE,WAhE2C;AAiEhDC,KAAG,EAAE,wBAjE2C;AAkEhDC,IAAE,EAAE,UAlE4C;AAmEhDC,KAAG,EAAE,aAnE2C;AAoEhDC,KAAG,EAAE,kBApE2C;AAqEhDC,KAAG,EAAE,gBArE2C;AAsEhDC,IAAE,EAAE;AAtE4C,CAA7C;AAyEA,IAAMC,uBAKX,GAAG;AACDC,IAAE,EAAE;AAAEnF,QAAI,EAAE,aAAR;AAAuBoF,QAAI,EAAE,GAA7B;AAAkCC,SAAK,EAAE,IAAI,IAA7C;AAAmDC,UAAM,EAAE;AAA3D,GADH;AAEDC,KAAG,EAAE;AAAEvF,QAAI,EAAE,QAAR;AAAkBoF,QAAI,EAAE,GAAxB;AAA6BC,SAAK,EAAE,EAApC;AAAwCC,UAAM,EAAE;AAAhD,GAFJ;AAGDE,GAAC,EAAE;AAAExF,QAAI,EAAE,MAAR;AAAgBoF,QAAI,EAAE,GAAtB;AAA2BC,SAAK,EAAE,IAAlC;AAAwCC,UAAM,EAAE;AAAhD,GAHF;AAIDG,KAAG,EAAE;AAAEzF,QAAI,EAAE,WAAR;AAAqBoF,QAAI,EAAE,IAA3B;AAAiCC,SAAK,EAAE,OAAxC;AAAiDC,UAAM,EAAE;AAAzD,GAJJ;AAKDI,IAAE,EAAE;AAAE1F,QAAI,EAAE,UAAR;AAAoBoF,QAAI,EAAE,GAA1B;AAA+BC,SAAK,EAAE,IAAtC;AAA4CC,UAAM,EAAE;AAApD,GALH;AAMDK,KAAG,EAAE;AAAE3F,QAAI,EAAE,iBAAR;AAA2BoF,QAAI,EAAE,IAAjC;AAAuCC,SAAK,EAAE,IAA9C;AAAoDC,UAAM,EAAE;AAA5D,GANJ;AAODM,MAAI,EAAE;AAAE5F,QAAI,EAAE,SAAR;AAAmBoF,QAAI,EAAE,KAAzB;AAAgCC,SAAK,EAAE,IAAvC;AAA6CC,UAAM,EAAE;AAArD,GAPL;AAQDO,IAAE,EAAE;AAAE7F,QAAI,EAAE,aAAR;AAAuBoF,QAAI,EAAE,GAA7B;AAAkCC,SAAK,EAAE,IAAzC;AAA+CC,UAAM,EAAE;AAAvD,GARH;AASDQ,IAAE,EAAE;AAAE9F,QAAI,EAAE,WAAR;AAAqBoF,QAAI,EAAE,GAA3B;AAAgCC,SAAK,EAAE,IAAvC;AAA6CC,UAAM,EAAE;AAArD,GATH;AAUDS,KAAG,EAAE;AAAE/F,QAAI,EAAE,eAAR;AAAyBoF,QAAI,EAAE,GAA/B;AAAoCC,SAAK,EAAE,OAA3C;AAAoDC,UAAM,EAAE;AAA5D,GAVJ;AAWDU,MAAI,EAAE;AAAEhG,QAAI,EAAE,UAAR;AAAoBoF,QAAI,EAAE,MAA1B;AAAkCC,SAAK,EAAE,IAAzC;AAA+CC,UAAM,EAAE;AAAvD,GAXL;AAYDW,OAAK,EAAE;AAAEjG,QAAI,EAAE,cAAR;AAAwBoF,QAAI,EAAE,MAA9B;AAAsCC,SAAK,EAAE,OAA7C;AAAsDC,UAAM,EAAE;AAA9D,GAZN;AAaDY,MAAI,EAAE;AACFlG,QAAI,EAAE,sBADJ;AAEFoF,QAAI,EAAE,KAFJ;AAGFC,SAAK,EAAE,OAHL;AAIFC,UAAM,EAAE;AAJN,GAbL;AAmBD,WAAS;AACLtF,QAAI,EAAE,yBADD;AAELoF,QAAI,EAAE,KAFD;AAGLC,SAAK,EAAE,GAHF;AAILC,UAAM,EAAE;AAJH,GAnBR;AAyBDa,KAAG,EAAE;AAAEnG,QAAI,EAAE,UAAR;AAAoBoF,QAAI,EAAE,GAA1B;AAA+BC,SAAK,EAAE,IAAtC;AAA4CC,UAAM,EAAE;AAApD,GAzBJ;AA0BDc,IAAE,EAAE;AAAEpG,QAAI,EAAE,UAAR;AAAoBoF,QAAI,EAAE,GAA1B;AAA+BC,SAAK,EAAE,KAAtC;AAA6CC,UAAM,EAAE;AAArD,GA1BH;AA2BD,YAAU;AACNtF,QAAI,EAAE,oBADA;AAENoF,QAAI,EAAE,OAFA;AAGNC,SAAK,EAAE,OAHD;AAINC,UAAM,EAAE;AAJF,GA3BT;AAiCD,SAAO;AAAEtF,QAAI,EAAE,iBAAR;AAA2BoF,QAAI,EAAE,OAAjC;AAA0CC,SAAK,EAAE,CAAjD;AAAoDC,UAAM,EAAE;AAA5D,GAjCN;AAkCD,UAAQ;AACJtF,QAAI,EAAE,qBADF;AAEJoF,QAAI,EAAE,OAFF;AAGJC,SAAK,EAAE,OAHH;AAIJC,UAAM,EAAE;AAJJ,GAlCP;AAwCDe,IAAE,EAAE;AAAErG,QAAI,EAAE,WAAR;AAAqBoF,QAAI,EAAE,GAA3B;AAAgCC,SAAK,EAAE,IAAI,IAA3C;AAAiDC,UAAM,EAAE;AAAzD,GAxCH;AAyCDgB,IAAE,EAAE;AAAEtG,QAAI,EAAE,aAAR;AAAuBoF,QAAI,EAAE,GAA7B;AAAkCC,SAAK,EAAE,IAAI,IAA7C;AAAmDC,UAAM,EAAE;AAA3D,GAzCH;AA0CDiB,KAAG,EAAE;AAAEvG,QAAI,EAAE,qBAAR;AAA+BoF,QAAI,EAAE,KAArC;AAA4CC,SAAK,EAAE,CAAnD;AAAsDC,UAAM,EAAE,CAAC;AAA/D,GA1CJ;AA2CD,WAAS;AACLtF,QAAI,EAAE,2BADD;AAELoF,QAAI,EAAE,OAFD;AAGLC,SAAK,EAAE,MAHF;AAILC,UAAM,EAAE;AAJH,GA3CR;AAiDD,UAAQ;AACJtF,QAAI,EAAE,qBADF;AAEJoF,QAAI,EAAE,KAFF;AAGJC,SAAK,EAAE,IAAI,OAHP;AAIJC,UAAM,EAAE;AAJJ,GAjDP;AAuDD,SAAO;AAAEtF,QAAI,EAAE,gBAAR;AAA0BoF,QAAI,EAAE,KAAhC;AAAuCC,SAAK,EAAE,IAAI,IAAlD;AAAwDC,UAAM,EAAE;AAAhE,GAvDN;AAwDDkB,KAAG,EAAE;AAAExG,QAAI,EAAE,mBAAR;AAA6BoF,QAAI,EAAE,GAAnC;AAAwCC,SAAK,EAAE,MAA/C;AAAuDC,UAAM,EAAE;AAA/D,GAxDJ;AAyDDmB,KAAG,EAAE;AAAEzG,QAAI,EAAE,mBAAR;AAA6BoF,QAAI,EAAE,GAAnC;AAAwCC,SAAK,EAAE,MAA/C;AAAuDC,UAAM,EAAE;AAA/D,GAzDJ;AA0DD,UAAQ;AAAEtF,QAAI,EAAE,SAAR;AAAmBoF,QAAI,EAAE,GAAzB;AAA8BC,SAAK,EAAE,IAAI,GAAzC;AAA8CC,UAAM,EAAE;AAAtD,GA1DP;AA2DD,OAAK;AAAEtF,QAAI,EAAE,SAAR;AAAmBoF,QAAI,EAAE,GAAzB;AAA8BC,SAAK,EAAE,IAAI,GAAzC;AAA8CC,UAAM,EAAE;AAAtD,GA3DJ;AA4DD,WAAS;AAAEtF,QAAI,EAAE,UAAR;AAAoBoF,QAAI,EAAE,GAA1B;AAA+BC,SAAK,EAAE,IAAI,IAA1C;AAAgDC,UAAM,EAAE;AAAxD,GA5DR;AA6DDoB,KAAG,EAAE;AAAE1G,QAAI,EAAE,aAAR;AAAuBoF,QAAI,EAAE,IAA7B;AAAmCC,SAAK,EAAE,GAA1C;AAA+CC,UAAM,EAAE;AAAvD,GA7DJ;AA8DDqB,IAAE,EAAE;AAAE3G,QAAI,EAAE,YAAR;AAAsBoF,QAAI,EAAE,GAA5B;AAAiCC,SAAK,EAAE,IAAI,IAA5C;AAAkDC,UAAM,EAAE;AAA1D,GA9DH;AA+DDsB,IAAE,EAAE;AAAE5G,QAAI,EAAE,YAAR;AAAsBoF,QAAI,EAAE,GAA5B;AAAiCC,SAAK,EAAE,IAAI,GAA5C;AAAiDC,UAAM,EAAE;AAAzD,GA/DH;AAgEDuB,IAAE,EAAE;AAAE7G,QAAI,EAAE,WAAR;AAAqBoF,QAAI,EAAE,GAA3B;AAAgCC,SAAK,EAAE,IAAvC;AAA6CC,UAAM,EAAE;AAArD,GAhEH;AAiED,UAAQ;AACJtF,QAAI,EAAE,oBADF;AAEJoF,QAAI,EAAE,KAFF;AAGJC,SAAK,EAAE,IAAI,GAHP;AAIJC,UAAM,EAAE;AAJJ,GAjEP;AAuED,SAAO;AAAEtF,QAAI,EAAE,gBAAR;AAA0BoF,QAAI,EAAE,GAAhC;AAAqCC,SAAK,EAAE,IAAI,IAAhD;AAAsDC,UAAM,EAAE;AAA9D,GAvEN;AAwEDwB,IAAE,EAAE;AAAE9G,QAAI,EAAE,WAAR;AAAqBoF,QAAI,EAAE,GAA3B;AAAgCC,SAAK,EAAE,IAAvC;AAA6CC,UAAM,EAAE;AAArD,GAxEH;AAyEDyB,IAAE,EAAE;AAAE/G,QAAI,EAAE,YAAR;AAAsBoF,QAAI,EAAE,GAA5B;AAAiCC,SAAK,EAAE,GAAxC;AAA6CC,UAAM,EAAE;AAArD,GAzEH;AA2ED;AACA0B,MAAI,EAAE;AAAEhH,QAAI,EAAE,OAAR;AAAiBoF,QAAI,EAAE,GAAvB;AAA4BC,SAAK,EAAE,CAAnC;AAAsCC,UAAM,EAAE;AAA9C,GA5EL;AA6ED2B,IAAE,EAAE;AAAEjH,QAAI,EAAE,eAAR;AAAyBoF,QAAI,EAAE,GAA/B;AAAoCC,SAAK,EAAE,IAA3C;AAAiDC,UAAM,EAAE;AAAzD,GA7EH;AA8ED4B,KAAG,EAAE;AAAElH,QAAI,EAAE,iBAAR;AAA2BoF,QAAI,EAAE,GAAjC;AAAsCC,SAAK,EAAE,MAA7C;AAAqDC,UAAM,EAAE;AAA7D,GA9EJ;AA+ED6B,GAAC,EAAE;AAAEnH,QAAI,EAAE,eAAR;AAAyBoF,QAAI,EAAE,MAA/B;AAAuCC,SAAK,EAAE,OAA9C;AAAuDC,UAAM,EAAE;AAA/D,GA/EF;AAgFD,OAAK;AAAEtF,QAAI,EAAE,OAAR;AAAiBoF,QAAI,EAAE,GAAvB;AAA4BC,SAAK,EAAE,CAAnC;AAAsCC,UAAM,EAAE;AAA9C;AAhFJ,CALE;AAwFA,SAAS8B,WAAT,CAAqBhC,IAArB,EAAmC;AACtC,MAAIA,IAAI,KAAK,EAAb,EAAiB,OAAO;AAAEpF,QAAI,EAAE,EAAR;AAAYoF,QAAI,EAAE,EAAlB;AAAsBC,SAAK,EAAE,CAA7B;AAAgCC,UAAM,EAAE;AAAxC,GAAP,CADqB,CAC8B;AAEpE;;AACA,MAAM+B,EAAE,GAAGnC,uBAAuB,CAACE,IAAD,CAAlC;AACA,MAAIiC,EAAJ,EAAQ,OAAOA,EAAP;AAER,MAAMrH,IAAI,GAAG8B,eAAe,CAACsD,IAAD,CAA5B;AACA,MAAIpF,IAAJ,EAAU,OAAO;AAAEA,QAAI,EAAJA,IAAF;AAAQoF,QAAI,EAAJA,IAAR;AAAcC,SAAK,EAAE,CAArB;AAAwBC,UAAM,EAAE;AAAhC,GAAP;AAEV,SAAOgC,SAAP;AACH;AAEM,SAASC,KAAT,GAA0D;AAC7D,MAAMC,CAA0C,GAAG,EAAnD;AACAC,QAAM,CAACC,IAAP,CAAY5F,eAAZ,EAA6B6F,OAA7B,CAAqC,UAAAC,CAAC,EAAI;AACtCJ,KAAC,CAACK,IAAF,CAAO;AAAE7H,UAAI,EAAE4H,CAAR;AAAWE,iBAAW,EAAEhG,eAAe,CAAC8F,CAAD;AAAvC,KAAP;AACAH,UAAM,CAACC,IAAP,CAAYxC,uBAAZ,EACKxF,MADL,CACY,UAAAqI,GAAG;AAAA,aAAI7C,uBAAuB,CAAC6C,GAAD,CAAvB,CAA6B3C,IAA7B,KAAsCwC,CAA1C;AAAA,KADf,EAEKD,OAFL,CAEa,UAAAI,GAAG;AAAA,aACRP,CAAC,CAACK,IAAF,CAAO;AACH7H,YAAI,EAAE+H,GADH;AAEHD,mBAAW,EAAE5C,uBAAuB,CAAC6C,GAAD,CAAvB,CAA6B/H;AAFvC,OAAP,CADQ;AAAA,KAFhB;AAQH,GAVD;AAWAwH,GAAC,CAACQ,IAAF,CAAO,UAACC,CAAD,EAAIT,CAAJ;AAAA,WAAUS,CAAC,CAACjI,IAAF,CAAOkI,aAAP,CAAqBV,CAAC,CAACxH,IAAvB,CAAV;AAAA,GAAP;AACA,SAAOwH,CAAP;AACH;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAMW,gBAAyD,GAAG;AAC9DC,IAAE,EAAE,CACA,CAAC,KAAD,EAAQ,KAAR,CADA,EAEA,CAAC,KAAD,EAAQ,KAAR,CAFA,EAGA,CAAC,KAAD,EAAQ,KAAR,CAHA,EAGgB;AAChB,GAAC,KAAD,EAAQ,KAAR,CAJA,CAIgB;AAJhB,GAD0D;AAO9DC,IAAE,EAAE,CACA,CAAC,KAAD,EAAQ,KAAR,CADA,EAEA,CAAC,KAAD,EAAQ,KAAR,CAFA,EAGA,CAAC,KAAD,EAAQ,KAAR,CAHA,EAGgB;AAChB,GAAC,KAAD,EAAQ,KAAR,CAJA,CAIgB;AAJhB,GAP0D;AAa9DC,OAAK,EAAE,CACH,CAAC,KAAD,EAAQ,KAAR,CADG,EAEH,CAAC,KAAD,EAAQ,KAAR,CAFG,EAGH,CAAC,KAAD,EAAQ,KAAR,CAHG,EAGa;AAChB,GAAC,KAAD,EAAQ,KAAR,CAJG,CAIa;AAJb,GAbuD;AAmB9DC,SAAO,EAAE,CACL,CAAC,KAAD,EAAQ,KAAR,CADK,EAEL,CAAC,KAAD,EAAQ,KAAR,CAFK,EAGL,CAAC,KAAD,EAAQ,KAAR,CAHK,CAnBqD;AAwB9DC,QAAM,EAAE,CACJ,CAAC,KAAD,EAAQ,KAAR,CADI,EAEJ,CAAC,KAAD,EAAQ,KAAR,CAFI,EAGJ,CAAC,KAAD,EAAQ,KAAR,CAHI,CAxBsD;AA6B9DC,OAAK,EAAE,CACH,CAAC,IAAD,EAAO,IAAP,CADG,EACW;AACd,GAAC,IAAD,EAAO,IAAP,CAFG;AA7BuD,CAAlE;AAmCO,SAASC,uCAAT,CACHC,WADG,EAEHC,QAFG,EAGHC,QAHG,EAIe;AAAA,MADlBA,QACkB;AADlBA,YACkB,GADP,EACO;AAAA;;AAClBF,aAAW,GAAG,CAACA,WAAW,IAAI,EAAhB,EAAoBzH,OAApB,CAA4B,KAA5B,EAAmC,EAAnC,CAAd;AACA,MAAM4H,IAAwB,GAAG;AAC7B9I,QAAI,EAAE,EADuB;AAE7B+I,UAAM,EAAE,cAFqB;AAG7BC,WAAO,EAAEH,QAAQ,CAAC3H,OAAT,CAAiB,OAAjB,EAA0B,EAA1B,EAA8BA,OAA9B,CAAsC,MAAtC,EAA8C,EAA9C,CAHoB;AAI7B+H,aAAS,EAAE,EAJkB;AAK7BvI,aAAS,EAAE,EALkB;AAM7BwI,WAAO,EAAE,EANoB;AAO7BC,SAAK,EAAE,EAPsB;AAQ7BC,mBAAe,EAAE,CARY;AAS7B3H,SAAK,EAAE,EATsB;AAU7BhC,WAAO,EAAE,EAVoB;AAW7B4J,QAAI,EAAE;AAXuB,GAAjC;AAcA,MAAIC,aAAa,GAAG,EAApB;AACA,MAAIC,QAAyB,GAAG,IAAhC;AACA,MAAIC,UAA6B,GAAG,IAApC;AACA,MAAIC,UAA6B,GAAG,IAApC;AACA,MAAIC,MAA2B,GAAG,EAAlC;AACA,MAAIC,MAAM,GAAG,CAAb;AACA,MAAIC,MAAM,GAAG,OAAb;AACA,MAAIC,OAAJ;AACA,MAAIC,iBAAJ;AACA,MAAIC,YAA8D,GAAG,EAArE;AAEA,MAAMC,UAAU,GAAGpB,QAAH,aAAGA,QAAH,uBAAGA,QAAQ,CAAG,SAAH,CAA3B;AACA,MAAMqB,OAA4B,GAAG,EAArC;;AACA,uDAAmBC,MAAM,CAACtB,QAAQ,IAAI,EAAb,CAAzB,wCAA2C;AAAA,QAAhCuB,IAAgC;AACvC,QAAIA,IAAI,CAACf,eAAT,EAA0Ba,OAAO,CAACE,IAAI,CAACf,eAAL,GAAuB,EAAxB,CAAP,GAAqCe,IAAI,CAACnK,IAA1C;AAC7B;;AAED,MAAI;AACA,QAAI4I,QAAQ,CAAC,SAAD,CAAR,IAAuBA,QAAQ,CAAC,OAAD,CAAnC,EAA8CwB,cAAc,CAAC,OAAD,CAAd;;AAC9C,0DAAmBzB,WAAW,CAACrH,KAAZ,CAAkB,IAAlB,CAAnB,2CAA4C;AAAA,UAAjC+I,IAAiC;AACxCV,YAAM;AACNW,iBAAW,CAACD,IAAD,CAAX;AACH;AACJ,GAND,CAME,OAAOE,CAAP,EAAU;AACRC,SAAK,CAAC,gBAAgBD,CAAC,CAACE,OAAnB,CAAL;AACH;;AAED,MAAIf,MAAM,CAACnI,MAAX,EAAmBuH,IAAI,CAACY,MAAL,GAAcA,MAAd;;AAEnB,kCAAgBjC,MAAM,CAACC,IAAP,CAAYoB,IAAI,CAACK,KAAjB,CAAhB;AAAK,QAAMvB,CAAC,mBAAP;AACDkB,QAAI,CAACK,KAAL,CAAWvB,CAAX,IAAgB8C,WAAW,CAAC5B,IAAI,CAACK,KAAL,CAAWvB,CAAX,CAAD,CAA3B;AADJ;;AAEA,wDAAgBkB,IAAI,CAACrJ,OAArB;AAAA,QAAWuB,CAAX;AAA8BA,KAAC,CAAC8G,WAAF,GAAgB4C,WAAW,CAAC1J,CAAC,CAAC8G,WAAH,CAA3B;AAA9B;;AAEA,MAAI,CAACgB,IAAI,CAACG,SAAV,EACIH,IAAI,CAACG,SAAL,GAAiB0B,QAAQ,CACrB7B,IAAI,CAAC9I,IAAL,CACKkB,OADL,CACa,MADb,EACqB,GADrB,EAEKA,OAFL,CAEa,UAFb,EAEyB,UAAC0J,CAAD,EAAI3C,CAAJ;AAAA,WAAUA,CAAC,CAAC4C,WAAF,EAAV;AAAA,GAFzB,EAGK3J,OAHL,CAGa,SAHb,EAGwB,GAHxB,CADqB,CAAzB;AAMJ,MAAI,CAAC4H,IAAI,CAACpI,SAAV,EAAqBoI,IAAI,CAACpI,SAAL,GAAiBoI,IAAI,CAACG,SAAtB;AAErB,MAAIH,IAAI,CAACG,SAAL,IAAkB,QAAtB,EAAgCH,IAAI,CAACM,eAAL,GAAuB,UAAvB,CAAhC,KACK,IAAIN,IAAI,CAACG,SAAL,IAAkB,MAAtB,EAA8BH,IAAI,CAACM,eAAL,GAAuB,UAAvB,CAA9B,KACA,IAAIN,IAAI,CAACG,SAAL,IAAkB,QAAtB,EAAgCH,IAAI,CAACM,eAAL,GAAuB,UAAvB;AAErC,MAAIN,IAAI,CAACpI,SAAL,IAAkB,SAAlB,IAA+B,CAACoI,IAAI,CAACM,eAAzC,EACIoB,KAAK,CAAC,2BAAD,CAAL;AAEJ1B,MAAI,CAACrJ,OAAL,CAAakI,OAAb,CAAqB,UAAArI,GAAG;AAAA,WAAKA,GAAG,CAACwL,UAAJ,GAAiBA,UAAU,CAAChC,IAAD,EAAOxJ,GAAP,CAAhC;AAAA,GAAxB;AAEA,SAAOwJ,IAAP;;AAEA,WAASwB,WAAT,CAAqBD,IAArB,EAAmC;AAC/B,QAAIf,aAAJ,EAAmB;AACf,UAAIe,IAAI,CAACU,IAAL,MAAe,KAAnB,EAA0B;AACtBzB,qBAAa,GAAG,IAAhB;AACA,YAAIA,aAAa,IAAI,SAArB,EAAgC;AACnC;AACJ,KALD,MAKO;AACH,UAAMvH,CAAC,GAAG,WAAWpB,IAAX,CAAgB0J,IAAhB,CAAV;;AACA,UAAItI,CAAJ,EAAO;AACHuH,qBAAa,GAAGvH,CAAC,CAAC,CAAD,CAAD,IAAQ,SAAxB;AACA,YAAIuH,aAAa,IAAI,SAArB,EAAgC;AACnC;AACJ;;AAED,QAAM0B,SAAS,GACX1B,aAAa,IAAI,SAAjB,IAA8Be,IAAI,CAACY,KAAL,CAAW,CAAX,EAAc,CAAd,KAAoB,MADtD;;AAGA,QAAI,CAACD,SAAL,EAAgB;AACZ,UAAMjJ,EAAC,GAAG,eAAepB,IAAf,CAAoB0J,IAApB,CAAV;;AACA,UAAItI,EAAJ,EAAO;AAAA,YACMmJ,EADN,GACkBnJ,EADlB;AAAA,YACUoJ,IADV,GACkBpJ,EADlB;AAEH+H,yBAAiB,GAAG,IAApB;AACA,YAAMsB,SAAS,GAAGD,IAAI,CAACJ,IAAL,GAAYM,WAAZ,EAAlB;;AACA,YAAIH,EAAE,IAAI,GAAN,IAAa,CAACpC,IAAI,CAAC9I,IAAvB,EAA6B;AACzB8I,cAAI,CAAC9I,IAAL,GAAYmL,IAAI,CAACJ,IAAL,EAAZ;AACAV,cAAI,GAAG,EAAP;AACH,SAHD,MAGO,IACHe,SAAS,IAAI,WAAb,IACAA,SAAS,IAAI,UADb,IAEAA,SAAS,IAAI,QAFb,IAGAA,SAAS,IAAI,UAJV,EAKL;AACExB,gBAAM,GAAGwB,SAAT;AACAf,cAAI,GAAG,EAAP;AACH,SARM,MAQA;AACH,cAAIT,MAAM,IAAI,OAAd,EAAuBA,MAAM,GAAG,MAAT,CADpB,CAEH;AACH;AACJ;;AAED,UAAIE,iBAAJ,EAAuB;AACnB,8DAAoBA,iBAApB;AAAA,cAAWwB,KAAX;AACIA,eAAK,CAACxD,WAAN,IAAqBuC,IAAI,GAAG,IAA5B;AADJ;AAEH,OAHD,MAGO;AACH,YAAIA,IAAI,IAAIvB,IAAI,CAACK,KAAL,CAAWS,MAAX,CAAZ,EAAgC;AAC5B,cAAI,CAACd,IAAI,CAACK,KAAL,CAAWS,MAAX,CAAL,EAAyBd,IAAI,CAACK,KAAL,CAAWS,MAAX,IAAqB,EAArB;AACzBd,cAAI,CAACK,KAAL,CAAWS,MAAX,KAAsBS,IAAI,GAAG,IAA7B;AACH;AACJ;AACJ,KAhCD,MAgCO;AACH,UAAIP,iBAAiB,IAAIA,iBAAiB,CAAC,CAAD,CAAjB,CAAqBhC,WAA9C,EACIgC,iBAAiB,GAAG,IAApB;AACJ,UAAMyB,QAAQ,GAAGlB,IAAI,CAChBnJ,OADY,CACJ,QADI,EACM,EADN,EAEZA,OAFY,CAEJ,aAFI,EAEW,UAAAe,CAAC;AAAA,eAAI,MAAMA,CAAN,GAAU,GAAd;AAAA,OAFZ,EAGZ8I,IAHY,EAAjB;AAIA,UAAI,CAACQ,QAAL,EAAe;AACf,UAAMC,KAAK,GAAGD,QAAQ,CAACjK,KAAT,CAAe,KAAf,CAAd;AACA,UAAI,QAAQd,IAAR,CAAagL,KAAK,CAACA,KAAK,CAACjK,MAAN,GAAe,CAAhB,CAAlB,CAAJ,EAA2CiK,KAAK,CAACC,GAAN;AAC3C,UAAIC,GAAG,GAAGF,KAAK,CAAC,CAAD,CAAf,CAVG,CAWH;;AACA,UAAIA,KAAK,CAAC,CAAD,CAAL,IAAY,GAAZ,IAAmBA,KAAK,CAAC,CAAD,CAAL,IAAY,GAAnC,EAAwCE,GAAG,GAAG,GAAN;;AACxC,cAAQA,GAAR;AACI,aAAK,MAAL;AACA,aAAK,OAAL;AACIC,mBAAS,CAACH,KAAD,CAAT;AACA;;AACJ,aAAK,MAAL;AACA,aAAK,MAAL;AACA,aAAK,QAAL;AACA,aAAK,SAAL;AACA,aAAK,OAAL;AACA,aAAK,IAAL;AACA,aAAK,IAAL;AACA,aAAK,OAAL;AACII,qBAAW,CAACJ,KAAD,CAAX;AACA;;AACJ,aAAK,GAAL;AACI,cAAIhC,UAAJ,EAAgB;AACZqC,wBAAY;AACf,WAFD,MAEO,IAAItC,QAAJ,EAAc;AACjBA,oBAAQ,GAAG,IAAX;AACH,WAFM,MAEA;AACHiB,iBAAK,CAAC,qBAAD,CAAL;AACH;;AACD;;AACJ;AACI,cAAIhB,UAAJ,EAAgBsC,WAAW,CAACN,KAAD,CAAX,CAAhB,KACK,IAAIjC,QAAJ,EAAcwC,UAAU,CAACP,KAAD,CAAV,CAAd,KACAQ,cAAc,CAACR,KAAD,CAAd;AA3Bb;AA6BH;AACJ;;AAED,WAASK,YAAT,GAAwB;AACpBrC,cAAU,CAACyC,MAAX,GAAoBC,mBAAmB,CAAC1C,UAAD,CAAnB,GAAkClC,SAAlC,GAA8C,IAAlE;AACA,QAAIkC,UAAU,CAACyC,MAAf,EACIE,IAAI,8CAA4C3C,UAAU,CAACxJ,IAAvD,CAAJ;AAEJ,QAAIoM,OAAO,GAAG,KAAd;AACA,QAAIC,OAAO,GAAG,KAAd;;AACA,0DAAgB7C,UAAU,CAACrJ,MAA3B,2CAAmC;AAAA,UAAxBmM,CAAwB;;AAC/B,UAAID,OAAJ,EAAa;AACT7B,aAAK,YACQ8B,CAAC,CAACtM,IADV,YACqBwJ,UAAU,CAACjK,IADhC,SACwCiK,UAAU,CAACxJ,IADnD,qCAAL;AAGA;AACH;;AACD,UAAIsM,CAAC,CAACC,YAAN,EAAoB;AAChB,YAAIH,OAAJ,EACI5B,KAAK,8CAC0ChB,UAAU,CAACjK,IADrD,SAC6DiK,UAAU,CAACxJ,IADxE,CAAL;AAGJoM,eAAO,GAAG,IAAV;AACH;;AACD,UAAIE,CAAC,CAACE,OAAF,IAAa,CAAb,IAAkBF,CAAC,CAACG,IAAF,IAAU,SAAhC,EAA2C;AACvC,YAAIL,OAAJ,EAAa;AACT5B,eAAK,2BACuB8B,CAAC,CAACtM,IADzB,YACoCwJ,UAAU,CAACjK,IAD/C,SACuDiK,UAAU,CAACxJ,IADlE,oBAAL;AAGA;AACH;;AACDqM,eAAO,GAAG,IAAV;AACH;AACJ;;AAED,QAAMK,GAAG,GAAGlD,UAAU,CAACmD,UAAvB;AACA,QAAMC,MAAM,GAAGzE,gBAAgB,CAACqB,UAAU,CAACjK,IAAZ,CAA/B;AACA,QACIiK,UAAU,CAACxJ,IAAX,IAAmB,cAAnB,IACAwJ,UAAU,CAACxJ,IAAX,IAAmB,cADnB,IAEA4M,MAFA,IAGA,CAACA,MAAM,CAACC,IAAP,CAAY,UAAAC,KAAK;AAAA,aAAIA,KAAK,CAAC,CAAD,CAAL,IAAYJ,GAAZ,IAAmBA,GAAG,IAAII,KAAK,CAAC,CAAD,CAAnC;AAAA,KAAjB,CAJL,EAMItC,KAAK,CACEhB,UAAU,CAACxJ,IADb,sBACkC0M,GAAG,CAACK,QAAJ,CAC/B,EAD+B,CADlC,mCAG8BH,MAAM,CAChCI,GAD0B,CAEvB,UAAAF,KAAK;AAAA,mBACGA,KAAK,CACJE,GADD,CACK,UAAAxF,CAAC;AAAA,sBAASA,CAAC,CAACuF,QAAF,CAAW,EAAX,CAAT;AAAA,OADN,EAECE,IAFD,CAEM,IAFN,CADH;AAAA,KAFkB,EAO1BA,IAP0B,CAOrB,IAPqB,CAH9B,CAAL;AAaJzD,cAAU,GAAG,IAAb;AACH;;AAED,WAASkB,WAAT,CAAqBwC,EAArB,EAAiC;AAC7B,WAAOA,EAAE,CAAChM,OAAH,CAAW,MAAX,EAAmB,EAAnB,EAAuBA,OAAvB,CAA+B,MAA/B,EAAuC,EAAvC,CAAP;AACH;;AAED,WAASiM,WAAT,CAAqB3B,KAArB,EAAsC;AAClC,QAAIjC,QAAQ,IAAIC,UAAhB,EAA4BgB,KAAK,CAAC,mBAAD,CAAL;;AAC5B,QAAIgB,KAAJ,EAAW;AACP,UAAIA,KAAK,CAAC,CAAD,CAAL,IAAY,GAAhB,EAAqBhB,KAAK,iBAAegB,KAAK,CAAC,CAAD,CAApB,aAAL;AACxB;;AAEDjC,YAAQ,GAAG,IAAX;AACAC,cAAU,GAAG,IAAb;AACH;;AAED,WAAS4D,YAAT,CAAsBC,SAAtB,EAAyC;AACrC,QAAIzD,MAAM,IAAIyD,SAAd,EAAyB;AACrB7C,WAAK,iCAA+B6C,SAA/B,mBAAsDzD,MAAtD,CAAL;AACH;AACJ;;AAED,WAASgC,WAAT,CAAqBJ,KAArB,EAAsC;AAClC2B,eAAW,CAAC,IAAD,CAAX;AACA,QAAMG,MAAM,GAAG9B,KAAK,CAAC+B,KAAN,EAAf;AACA,QAAIhO,IAAuB,GAAG,SAA9B;;AACA,QAAI+N,MAAM,IAAI,MAAd,EAAsB;AAClBF,kBAAY,CAAC,UAAD,CAAZ;AACA,UAAII,EAAE,GAAGhC,KAAK,CAAC+B,KAAN,EAAT;AACA,UAAIC,EAAE,IAAI,MAAV,EAAkBA,EAAE,GAAGhC,KAAK,CAAC+B,KAAN,EAAL;AAClB,UAAIC,EAAE,IAAI,QAAN,IAAkBA,EAAE,IAAI,SAA5B,EACIjO,IAAI,GAAI,eAAeiO,EAAvB,CADJ,KAEKhD,KAAK,CAAC,0BAAD,CAAL;AACR,KAPD,MAOO,IAAI8C,MAAM,IAAI,MAAd,EAAsB;AACzBF,kBAAY,CAAC,UAAD,CAAZ;;AACA,UAAMI,EAAE,GAAGhC,KAAK,CAAC+B,KAAN,EAAX;;AACA,UAAIC,EAAE,IAAI,QAAN,IAAkBA,EAAE,IAAI,SAA5B,EAAuCjO,IAAI,GAAI,UAAUiO,EAAlB,CAAvC,KACKhD,KAAK,CAAC,0BAAD,CAAL;AACR,KALM,MAKA;AACHjL,UAAI,GAAG+N,MAAP;AACH;;AAED,QAAIG,QAAiB,GAAGnG,SAAxB;;AACA,QAAIkE,KAAK,CAAC,CAAD,CAAL,KAAa,UAAjB,EAA6B;AACzBiC,cAAQ,GAAG,IAAX;AACAjC,WAAK,CAAC+B,KAAN;AACH;;AAED,QAAIvN,IAAI,GAAGwL,KAAK,CAAC+B,KAAN,EAAX;AACA,QAAMG,QAAQ,GAAGnO,IAAI,IAAI,QAAzB;;AACA,QAAImO,QAAQ,IAAI7D,OAAZ,IAAuB,CAAC,QAAQrJ,IAAR,CAAaR,IAAb,CAA5B,EAAgD;AAC5CwL,WAAK,CAACmC,OAAN,CAAc3N,IAAd;AACAA,UAAI,GAAG6J,OAAO,CAAC7J,IAAf;AACH;;AACDwJ,cAAU,GAAG;AACTjK,UAAI,EAAJA,IADS;AAETS,UAAI,EAAE4N,aAAa,CAAC5N,IAAD,CAFV;AAGT2M,gBAAU,EAAErF,SAHH;AAITQ,iBAAW,EAAE,EAJJ;AAKT3H,YAAM,EAAE,EALC;AAMTsN,cAAQ,EAARA;AANS,KAAb;;AAQA,QAAIC,QAAQ,IAAI7D,OAAZ,IAAuB7J,IAAI,IAAI6J,OAAO,CAAC7J,IAA3C,EAAiD;AAC7CwJ,gBAAU,CAACqE,SAAX,GAAuB,IAAvB;AACAhE,aAAO,CAACiE,SAAR,GAAoB,IAApB;AACH;;AACD,QAAI,CAAChE,iBAAL,EAAwBA,iBAAiB,GAAG,EAApB;AACxBA,qBAAiB,CAACjC,IAAlB,CAAuB2B,UAAvB;;AACA,QAAIgC,KAAK,CAAC,CAAD,CAAL,IAAY,GAAhB,EAAqB;AACjBA,WAAK,CAAC+B,KAAN;AACA/D,gBAAU,CAACuE,QAAX,GAAsB,IAAtB;AACH;;AAED,QAAM5D,IAAI,GAAGrB,IAAI,CAACrJ,OAAL,CAAaC,MAAb,CAAoB,UAAA4M,CAAC;AAAA,aAAIA,CAAC,CAACtM,IAAF,IAAUwJ,UAAU,CAACxJ,IAAzB;AAAA,KAArB,CAAb;;AACA,QAAImK,IAAI,CAAC5I,MAAL,IAAe,CAAnB,EAAsB,CAClB;AACH,KAFD,MAEO,IACH4I,IAAI,CAAC5I,MAAL,IAAe,CAAf,IACA4I,IAAI,CAAC,CAAD,CAAJ,CAAQ5K,IAAR,IAAgB,SADhB,IAEAiK,UAAU,CAACjK,IAAX,IAAmB,QAHhB,EAIL,CACE;AACH,KANM,MAMA;AACHiL,WAAK,0BAAwBL,IAAI,CAAC6C,GAAL,CAAS,UAAAV,CAAC;AAAA,eAAIA,CAAC,CAACtM,IAAN;AAAA,OAAV,EAAsBiN,IAAtB,CAA2B,IAA3B,CAAxB,OAAL;AACH;;AAED,QAAI,OAAOzM,IAAP,CAAYjB,IAAZ,CAAJ,EAAuB;AACnB,UAAI,CAACkK,UAAL,EACIe,KAAK,CACD,4DADC,CAAL,CADJ,KAIKhB,UAAU,CAACwE,QAAX,GAAsBvE,UAAU,CAACuE,QAAjC;AACR;;AAED,QAAMC,IAAI,GAAGzC,KAAK,CAAC0C,OAAN,CAAc,GAAd,CAAb;;AACA,QAAI3O,IAAI,IAAI,cAAR,IAA0BA,IAAI,IAAI,aAAtC,EAAqD;AACjD;AACAiK,gBAAU,CAACmD,UAAX,GAAwB,CAAxB;AACH,KAHD,MAGO,IAAIsB,IAAI,IAAI,CAAZ,EAAe;AAClB,UAAM3N,CAAC,GAAGkL,KAAK,CAACyC,IAAI,GAAG,CAAR,CAAf;AACA,UAAIjN,CAAC,GAAGC,QAAQ,CAACX,CAAD,CAAhB;AACA,UAAI6N,KAAK,GAAG,IAAZ;;AACA,UAAIhN,KAAK,CAACH,CAAD,CAAT,EAAc;AACVA,SAAC,GAAG,CAAJ;AACAmN,aAAK,GAAG,KAAR;;AACA,YAAInE,UAAJ,EAAgB;AACZ,cAAMoE,YAAY,GAAGpE,UAAU,CAACvK,OAAX,CAAmBM,IAAnB,CACjB,UAAAuM,CAAC;AAAA,mBAAIA,CAAC,CAACtM,IAAF,IAAUM,CAAd;AAAA,WADgB,CAArB;;AAGA,cAAI8N,YAAJ,EAAkB;AACdpN,aAAC,GAAGoN,YAAY,CAACzB,UAAjB;AACAnD,sBAAU,CAAC6E,cAAX,GAA4B/N,CAA5B;AACA,gBAAI8N,YAAY,CAAC7O,IAAb,IAAqBA,IAAzB,EACIiL,KAAK,uBACmBlK,CADnB,UACyB8N,YAAY,CAAC7O,IADtC,YACiDA,IADjD,CAAL,CADJ,KAIK4O,KAAK,GAAG,IAAR;AACR,WARD,MAQO3D,KAAK,CAAIlK,CAAJ,2BAAL;AACV,SAbD,MAaO;AACHkK,eAAK,CAAIlK,CAAJ,mDAAL;AACH;AACJ;;AAED,UAAIgO,MAAM,GAAG,KAAb;AACA,UAAIC,QAAQ,GAAG,KAAf;AACA,UAAIC,MAAM,GAAG,SAASxN,CAAT,IAAcA,CAAC,IAAI,KAAhC;;AACA,cAAQzB,IAAR;AACI,aAAK,OAAL;AACA,aAAK,IAAL;AACI6N,sBAAY,CAAC,WAAD,CAAZ;AACAmB,kBAAQ,GAAG,SAASvN,CAAT,IAAcA,CAAC,IAAI,KAA9B;AACAsN,gBAAM,GAAG,SAAStN,CAAT,IAAcA,CAAC,IAAI,KAA5B;AACA;;AACJ,aAAK,IAAL;AACIoM,sBAAY,CAAC,WAAD,CAAZ;AACAmB,kBAAQ,GAAG,QAAQvN,CAAR,IAAaA,CAAC,IAAI,IAA7B;AACAsN,gBAAM,GAAG,QAAQtN,CAAR,IAAaA,CAAC,IAAI,IAA3B;AACA;;AACJ,aAAK,QAAL;AACA,aAAK,SAAL;AACIoM,sBAAY,CAAC,UAAD,CAAZ;AACAmB,kBAAQ,GAAG,QAAQvN,CAAR,IAAaA,CAAC,IAAI,IAA7B;AACAsN,gBAAM,GAAG,QAAQtN,CAAR,IAAaA,CAAC,IAAI,IAA3B;AACAwN,gBAAM,GAAG,SAASxN,CAAT,IAAcA,CAAC,IAAI,KAA5B;AACA;;AACJ,aAAK,OAAL;AACIoM,sBAAY,CAAC,QAAD,CAAZ;AACAmB,kBAAQ,GAAG,QAAQvN,CAAR,IAAaA,CAAC,IAAI,IAA7B;AACAsN,gBAAM,GAAG,QAAQtN,CAAR,IAAaA,CAAC,IAAI,IAA3B;AACA;AAvBR;;AA0BA,UAAIsN,MAAJ,EAAY,CACR;AACH,OAFD,MAEO,IAAIC,QAAJ,EAAc;AACjB,YAAI,CAAC/E,UAAU,CAAC6E,cAAhB,EACIlC,IAAI,CACG5M,IADH,WACakP,KAAK,CACdzN,CADc,CADlB,sDAAJ;AAKP,OAPM,MAOA,IAAIwN,MAAJ,EAAY;AACf,YAAI,CAAC1F,IAAI,CAAC4F,YAAV,EACIvC,IAAI,CACG5M,IADH,WACakP,KAAK,CACdzN,CADc,CADlB,uDAAJ;AAKP;;AAEDwI,gBAAU,CAACmD,UAAX,GAAwB3L,CAAxB;AACAwK,WAAK,CAACmD,MAAN,CAAaV,IAAb,EAAmB,CAAnB;AACH,KA1EM,MA0EA;AACH,UAAIP,QAAQ,IAAI7D,OAAhB,EAAyBL,UAAU,CAACmD,UAAX,GAAwB9C,OAAO,CAAC8C,UAAhC,CAAzB,KACKnC,KAAK,qBAAmBhB,UAAU,CAACxJ,IAA9B,CAAL;AACR;;AAED,QACI8I,IAAI,CAACrJ,OAAL,CAAaoN,IAAb,CACI,UAAAP,CAAC;AAAA,aACGA,CAAC,CAAC/M,IAAF,IAAUiK,UAAU,CAACjK,IAArB,KACC,CAAC,OAAOiB,IAAP,CAAY8L,CAAC,CAAC/M,IAAd,CAAD,IACG+M,CAAC,CAAC0B,QAAF,IAAcxE,UAAU,CAACwE,QAF7B,KAGA1B,CAAC,CAACK,UAAF,IAAgBnD,UAAU,CAACmD,UAJ9B;AAAA,KADL,CADJ,EAQE;AACEnC,WAAK,CAAC,gCAAD,CAAL;AACH;;AAED1B,QAAI,CAACrJ,OAAL,CAAaoI,IAAb,CAAkB2B,UAAlB;AAEA,QAAIjK,IAAI,IAAI,SAAZ,EAAuBsK,OAAO,GAAGL,UAAV,CAAvB,KACKK,OAAO,GAAG,IAAV;;AAEL,QAAI2B,KAAK,CAAC,CAAD,CAAL,IAAY,GAAZ,IAAmBA,KAAK,CAAC,CAAD,CAAL,IAAY,GAAnC,EAAwC;AACpCA,WAAK,CAACmC,OAAN,CAAc,GAAd;AACA7B,iBAAW,CAACN,KAAD,CAAX;AACAK,kBAAY;AACf,KAJD,MAIO;AACH,UAAM+C,IAAI,GAAGpD,KAAK,CAAC+B,KAAN,EAAb;;AACA,UAAIqB,IAAI,IAAI,GAAZ,EAAiB;AACb,YAAIpD,KAAK,CAAC,CAAD,CAAL,IAAY,KAAhB,EAAuBA,KAAK,CAAC+B,KAAN;;AACvB,YAAI/B,KAAK,CAAC,CAAD,CAAL,IAAY,GAAhB,EAAqB;AACjBA,eAAK,CAAC+B,KAAN;AACA1B,sBAAY;AACf;;AACD,YAAIL,KAAK,CAACjK,MAAV,EAAkBiJ,KAAK,wBAAsBgB,KAAK,CAAC,CAAD,CAA3B,SAAL;AACrB,OAPD,MAOO;AACH,YAAIoD,IAAI,KAAKtH,SAAT,IAAsB/H,IAAI,IAAI,OAAlC,EAA2C;AACvCsM,sBAAY;AACf,SAFD,MAEO;AACHrB,eAAK,CAAC,eAAD,CAAL;AACH;AACJ;AACJ;AACJ;;AAED,WAASqE,UAAT,CAAoBC,EAApB,EAAgC9N,CAAhC,EAA2C;AAAA,gCACJ+N,oBAAoB,CAACD,EAAD,CADhB;AAAA,QAChCtC,OADgC;AAAA,QACvBC,IADuB;AAAA,QACjBuC,SADiB;;AAGvC,QAAI7N,KAAK,CAACH,CAAD,CAAT,EAAc,OAAOA,CAAP,CAHyB,CAGhB;;AAEvB,QAAIwL,OAAO,IAAI,CAAf,EAAkB;AACdhC,WAAK,0BAAwBxJ,CAAxB,yBAA6C8N,EAA7C,CAAL;AACA,aAAO9N,CAAP;AACH;;AAED,QAAIA,CAAC,GAAG,CAAJ,IAASwL,OAAO,GAAG,CAAvB,EAA0B;AACtBhC,WAAK,2BAAyBxJ,CAAzB,yBAA8C8N,EAA9C,CAAL;AACA,aAAO9N,CAAP;AACH;;AAED,QAAIiO,IAAI,CAACC,KAAL,CAAWlO,CAAX,KAAiBA,CAAjB,IAAsBgO,SAAS,IAAI,CAAvC,EAA0C;AACtCxE,WAAK,sCAAoCsE,EAApC,cAA+C9N,CAA/C,CAAL;AACA,aAAOA,CAAP;AACH;;AAED,QAAImO,IAAI,GAAG3C,OAAO,GAAG,CAAV,GAAc,CAACA,OAAD,GAAW,CAAX,GAAe,CAA7B,GAAiCA,OAAO,GAAG,CAAtD;AACA2C,QAAI,IAAIH,SAAS,IAAI,CAArB,CArBuC,CAsBvC;;AACA,QAAII,GAAG,GAAG,CAAV;;AACA,WAAOD,IAAI,EAAX;AAAeC,SAAG,IAAI,CAAP;AAAf;;AACA,QAAI,CAACpO,CAAD,IAAMoO,GAAV,EAAe,CACX;AACH,KAFD,MAEO,IAAIA,GAAG,IAAI,CAAP,IAAYpO,CAAC,IAAI,CAArB,EAAwB,CAC3B;AACH,KAFM,MAEA;AACH,UAAIiO,IAAI,CAACI,GAAL,CAASrO,CAAT,KAAeoO,GAAnB,EAAwB;AACpB5E,aAAK,YAAUxJ,CAAV,6BAAmC8N,EAAnC,CAAL;AACA,eAAO9N,CAAP;AACH;AACJ;;AAED,WAAOA,CAAP;AACH;;AAED,WAASsO,QAAT,CAAkB9D,KAAlB,EAAmC;AAC/B,QAAM+D,EAAE,GAAG/D,KAAK,CAAC+B,KAAN,EAAX;AACA,QAAIgC,EAAE,IAAI,GAAN,IAAaA,EAAE,IAAI,GAAvB,EAA4B/E,KAAK,CAAC,eAAD,CAAL;AAC5B,QAAMgF,GAAG,GAAGhE,KAAK,CAAC+B,KAAN,EAAZ;AACA,WAAOkC,aAAa,CAACD,GAAD,EAAM,IAAN,CAApB;AACH;;AAED,WAAS1D,WAAT,CAAqBN,KAArB,EAAsC;AAAA;;AAClC,QACIA,KAAK,CAACjK,MAAN,IAAgB,CAAhB,KACCiK,KAAK,CAAC,CAAD,CAAL,IAAY,SAAZ,IACGA,KAAK,CAAC,CAAD,CAAL,IAAY,WADf,IAEGA,KAAK,CAAC,CAAD,CAAL,IAAY,iBAHhB,CADJ,EAKE;AACEzB,kBAAY,GAAGyB,KAAK,CAAC,CAAD,CAApB;AACA;AACH;;AACD,QAAMxL,IAAI,GAAG4N,aAAa,CAACpC,KAAK,CAAC+B,KAAN,EAAD,CAA1B;AACA,QAAImC,YAAoB,GAAGpI,SAA3B;AACA,QAAIqI,UAAmB,GAAGrI,SAA1B;AACA,QAAIsI,EAAE,GAAGpE,KAAK,CAAC+B,KAAN,EAAT;;AACA,QAAIqC,EAAE,IAAI,GAAV,EAAe;AACXD,gBAAU,GAAG,IAAb;AACAC,QAAE,GAAGpE,KAAK,CAAC+B,KAAN,EAAL;AACH;;AACD,QAAIqC,EAAE,IAAI,GAAV,EAAe;AACXF,kBAAY,GAAGD,aAAa,CAACjE,KAAK,CAAC+B,KAAN,EAAD,EAAgB,IAAhB,CAA5B;AACAqC,QAAE,GAAGpE,KAAK,CAAC+B,KAAN,EAAL;AACH;;AAED,QAAIqC,EAAE,IAAI,GAAV,EAAepF,KAAK,CAAC,eAAD,CAAL;AAEf,QAAMsE,EAAE,GAAGtD,KAAK,CAAC+B,KAAN,EAAX;;AAzBkC,iCA0BCwB,oBAAoB,CAACD,EAAD,CA1BrB;AAAA,QA0B3BtC,OA1B2B;AAAA,QA0BlBC,IA1BkB;AAAA,QA0BZuC,SA1BY;;AA2BlC,QAAMa,OAAO,GAAGb,SAAS,KAAK,IAAd,IAAsB1H,SAAtC;AAEA,QAAIwI,GAAG,GAAGtE,KAAK,CAAC+B,KAAN,EAAV;AACA,QAAInI,IAAiB,GAAG,EAAxB;;AACA,QAAI0K,GAAG,IAAI,GAAX,EAAgB;AACZ1K,UAAI,GAAG2K,aAAa,CAACD,GAAD,CAApB;AACAA,SAAG,GAAGtE,KAAK,CAAC+B,KAAN,EAAN;AACH;;AAED,QAAImC,YAAY,KAAKpI,SAArB,EAAgCuH,UAAU,CAACC,EAAD,EAAKY,YAAL,CAAV;AAEhC,QAAInC,KAAK,GAAGyB,SAAS,IAAI1H,SAAzB;;AACA,QAAIlC,IAAI,IAAI,GAAZ,EAAiB;AACb;AACA,UAAI,CAAC,iBAAiB5E,IAAjB,CAAsBsO,EAAtB,CAAL,EACItE,KAAK,uEACmEsE,EADnE,OAAL;AAIJvB,WAAK,GAAG0B,IAAI,CAACI,GAAL,CAAS7C,OAAT,IAAoB,CAA5B;AACA,UAAIA,OAAO,GAAG,CAAd,EAAiBe,KAAK,IAAI,CAAT;AACpB;;AAED,QAAMrN,KAA0B,GAAG;AAC/BF,UAAI,EAAJA,IAD+B;AAE/BoF,UAAI,EAAJA,IAF+B;AAG/BmI,WAAK,EAALA,KAH+B;AAI/BsC,aAAO,EAAPA,OAJ+B;AAK/BpD,UAAI,EAAJA,IAL+B;AAM/BD,aAAO,EAAPA,OAN+B;AAO/BwD,kBAAY,EAAEC,aAAa,CAACzD,OAAD,CAAb,IAA0BC,IAA1B,IAAkCnF,SAPjB;AAQ/BoI,kBAAY,EAAZA,YAR+B;AAS/BC,gBAAU,EAAVA,UAT+B;AAU/BO,oBAAc,EAAEnG,YAAY,IAAI,iBAAhB,IAAqCzC,SAVtB;AAW/B6I,eAAS,EACLpG,YAAY,IAAI,WAAhB,IACAA,YAAY,IAAI,iBADhB,IAEAzC,SAd2B;AAe/BiF,kBAAY,EAAExC,YAAY,IAAI,SAAhB,IAA6BzC;AAfZ,KAAnC;;AAkBA,QAAIwI,GAAG,IAAI,GAAX,EAAgB;AACZ,aAAOtE,KAAK,CAACjK,MAAb,EAAqB;AACjBuO,WAAG,GAAGtE,KAAK,CAAC+B,KAAN,EAAN;AACA,YAAIuC,GAAG,IAAI,GAAX,EAAgB;AAChBA,WAAG,GAAGnF,QAAQ,CAACmF,GAAD,CAAd;;AACA,gBAAQA,GAAR;AACI,eAAK,UAAL;AACI;AAAE5P,iBAAD,CAAe4P,GAAf,IAAsBjB,UAAU,CAAC,IAAD,EAAOS,QAAQ,CAAC9D,KAAD,CAAf,CAAhC;AACD;;AACJ,eAAK,YAAL;AACA,eAAK,YAAL;AACA,eAAK,aAAL;AACA,eAAK,aAAL;AACI;AAAEtL,iBAAD,CAAe4P,GAAf,IAAsBjB,UAAU,CAACC,EAAD,EAAKQ,QAAQ,CAAC9D,KAAD,CAAb,CAAhC;AACD;;AACJ,eAAK,mBAAL;AACI,gBAAKhC,UAAD,CAAoBsG,GAApB,MAA6BxI,SAAjC,EACIkD,KAAK,YAAUsF,GAAV,kBAAL;AACFtG,sBAAD,CAAoBsG,GAApB,IAA2BjB,UAAU,CAClC,KADkC,EAElCS,QAAQ,CAAC9D,KAAD,CAF0B,CAArC;AAID;;AACJ;AACIhB,iBAAK,CAAC,yBAAyBsF,GAA1B,CAAL;AACA;AApBR;;AAsBA,YAAItE,KAAK,CAAC,CAAD,CAAL,IAAY,GAAhB,EAAqBA,KAAK,CAAC+B,KAAN;AACxB;;AACD,UAAIuC,GAAG,IAAI,GAAX,EAAgBA,GAAG,GAAG,IAAN;AACnB;;AAED,QAAIA,GAAJ,EAAStF,KAAK,6CAA2CsF,GAA3C,SAAL;AAET,QACI5P,KAAK,CAACkQ,UAAN,KAAqB9I,SAArB,IACApH,KAAK,CAACmQ,UAAN,KAAqB/I,SADrB,IAEAkF,OAAO,GAAG,CAHd,EAKItM,KAAK,CAACkQ,UAAN,GAAmB,CAAnB;AAEJ,QACIlQ,KAAK,CAACoQ,WAAN,KAAsBhJ,SAAtB,IACApH,KAAK,CAACqQ,WAAN,KAAsBjJ,SADtB,IAEAkF,OAAO,GAAG,CAHd,EAKItM,KAAK,CAACoQ,WAAN,GAAoB,CAApB;AAEJ,QAAI,CAACpQ,KAAK,CAACsM,OAAP,IAAkBtM,KAAK,CAACsQ,QAA5B,EAAsCtQ,KAAK,CAACsM,OAAN,GAAgBtM,KAAK,CAACsQ,QAAtB;;AAEtC,QAAI,OAAOhQ,IAAP,CAAYiM,IAAZ,CAAJ,EAAuB;AACnBjD,gBAAU,CAACwE,QAAX,GAAsBxE,UAAU,CAACxJ,IAAjC;;AACA,UACIyJ,UAAU,IACVA,UAAU,CAACzJ,IAAX,IAAmBwJ,UAAU,CAACxJ,IAD9B,IAEAwJ,UAAU,CAACjK,IAAX,IAAmB,QAHvB,EAIE,CACE;AACH,OAND,MAMO;AACHkK,kBAAU,GAAGD,UAAb;AACH;AACJ;;AAED,QACI,CAACtJ,KAAK,CAACyP,UAAP,0BACAnG,UAAU,CAACrJ,MAAX,CAAkBqJ,UAAU,CAACrJ,MAAX,CAAkBoB,MAAlB,GAA2B,CAA7C,CADA,+CACA,mBAAiDoO,UAFrD,EAGE;AACEnF,WAAK,uDAAL;AACH;;AAEDhB,cAAU,CAACrJ,MAAX,CAAkB0H,IAAlB,CAAuB3H,KAAvB;AACA6J,gBAAY,GAAGzC,SAAf;AACH;;AAED,WAASqE,SAAT,CAAmBH,KAAnB,EAAoC;AAChC2B,eAAW,CAAC,IAAD,CAAX;AACA,QAAI3B,KAAK,CAAC,CAAD,CAAL,IAAY,GAAZ,IAAmBA,KAAK,CAAC,CAAD,CAAL,IAAY,GAAnC,EACIhB,KAAK,CAAC,+BAAD,CAAL;AACJjB,YAAQ,GAAG;AACPvJ,UAAI,EAAE4N,aAAa,CAACpC,KAAK,CAAC,CAAD,CAAN,CADZ;AAEPgB,aAAO,EAAEuC,oBAAoB,CAACvD,KAAK,CAAC,CAAD,CAAN,CAApB,CAA+B,CAA/B,CAFF;AAGPiF,aAAO,EAAEjF,KAAK,CAAC,CAAD,CAAL,IAAY,OAAZ,IAAuBlE,SAHzB;AAIP5F,aAAO,EAAE;AAJF,KAAX;AAMA,QAAIoH,IAAI,CAACrH,KAAL,CAAW8H,QAAQ,CAACvJ,IAApB,CAAJ,EAA+BwK,KAAK,CAAC,mBAAD,CAAL;AAC/B1B,QAAI,CAACrH,KAAL,CAAW8H,QAAQ,CAACvJ,IAApB,IAA4BuJ,QAA5B;AACH;;AAED,WAASwC,UAAT,CAAoBP,KAApB,EAAqC;AACjC,QAAIA,KAAK,CAAC,CAAD,CAAL,IAAY,GAAZ,IAAmBA,KAAK,CAACjK,MAAN,IAAgB,CAAvC,EACIiJ,KAAK,mCAAL;AACJjB,YAAQ,CAAC7H,OAAT,CAAiBkM,aAAa,CAACpC,KAAK,CAAC,CAAD,CAAN,CAA9B,IAA4CqD,UAAU,CAClDoB,aAAa,CAAC1G,QAAQ,CAACiD,OAAV,CADqC,EAElDiD,aAAa,CAACjE,KAAK,CAAC,CAAD,CAAN,CAFqC,CAAtD;AAIH;;AAED,WAASiE,aAAT,CAAuBnP,CAAvB,EAAkCS,UAAlC,EAAsD;AAAA,QAApBA,UAAoB;AAApBA,gBAAoB,GAAP,KAAO;AAAA;;AAClD,QAAI;AACA,aAAOD,sEAAa,CAACgI,IAAD,EAAOxI,CAAP,EAAUS,UAAV,CAApB;AACH,KAFD,CAEE,OAAOwJ,CAAP,EAAU;AACRC,WAAK,CAACD,CAAC,CAACE,OAAH,CAAL;AACA,aAAO,CAAP;AACH;AACJ;;AAED,WAASiG,WAAT,CAAqBC,CAArB,EAAgC;AAC5B,QAAM1O,CAAC,GAAG0O,CAAC,CAAC5D,QAAF,CAAW,EAAX,CAAV;AACA,QAAMvH,CAAC,GAAG,kBAAV;;AACA,SAAK,IAAIoL,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGpL,CAAC,CAACjE,MAAtB,EAA8B,EAAEqP,CAAhC,EAAmC;AAC/B,UAAMC,EAAE,GAAGrL,CAAC,CAACoL,CAAD,CAAZ;AACA,UAAI3O,CAAC,CAACiM,OAAF,CAAU2C,EAAE,GAAGA,EAAL,GAAUA,EAApB,KAA2B,CAA/B,EAAkC,OAAO,KAAP;AACrC;;AACD,QAAI,sBAAsBrQ,IAAtB,CAA2ByB,CAA3B,CAAJ,EAAmC,OAAO,KAAP;AACnC,WAAO,IAAP;AACH;;AAED,WAAS6O,SAAT,GAAqB;AACjB,aAAS;AACL,UAAM/O,CAAC,GAAIkN,IAAI,CAAC8B,MAAL,KAAgB,SAAjB,GAA+B,UAAzC;AACA,UAAIL,WAAW,CAAC3O,CAAD,CAAf,EAAoB,OAAOA,CAAP;AACvB;AACJ;;AAED,WAASiK,cAAT,CAAwBR,KAAxB,EAAyC;AACrC,QACI,EACI,CAACA,KAAK,CAAC,CAAD,CAAL,IAAY,GAAZ,IAAmBA,KAAK,CAAC,CAAD,CAAL,IAAY,GAAhC,MACCA,KAAK,CAAC,CAAD,CAAL,IAAY,MAAZ,IAAsBA,KAAK,CAACjK,MAAN,IAAgB,CADvC,CADJ,CADJ,EAMIiJ,KAAK,uDAAL;;AACJ,YAAQgB,KAAK,CAAC,CAAD,CAAb;AACI,WAAK,SAAL;AACIpB,sBAAc,CAACoB,KAAK,CAAC,CAAD,CAAN,CAAd;AACA;;AACJ,WAAK,OAAL;AACA,WAAK,YAAL;AAAmB;AACf1C,cAAI,CAACM,eAAL,GAAuBqG,aAAa,CAACjE,KAAK,CAAC,CAAD,CAAN,CAApC;AACA,cAAI1C,IAAI,CAAC9I,IAAL,IAAa,SAAb,IAA0B8I,IAAI,CAACM,eAAL,IAAwB,CAAtD,EACIN,IAAI,CAACM,eAAL,GAAuB,CAAvB;AACJ,cAAM4H,GAAG,kBAAgBvC,KAAK,CAACqC,SAAS,EAAV,CAA9B;AACA,cACI,EACIhI,IAAI,CAACM,eAAL,IAAwB,CAAxB,IACC,cAAeN,IAAI,CAACM,eAApB,IACGN,IAAI,CAACM,eAAL,IAAwB,UAHhC,CADJ,EAOIoB,KAAK,qCAAmCwG,GAAnC,CAAL;AACJ,cAAI,CAACN,WAAW,CAAC5H,IAAI,CAACM,eAAN,CAAhB,EACIoB,KAAK,4CAA0CwG,GAA1C,CAAL;AACJ,cAAI/G,OAAO,CAACnB,IAAI,CAACM,eAAL,GAAuB,EAAxB,CAAX,EACIoB,KAAK,uBACmBiE,KAAK,CACrB3F,IAAI,CAACM,eADgB,CADxB,yBAIGa,OAAO,CAACnB,IAAI,CAACM,eAAL,GAAuB,EAAxB,CAJV,UAKI4H,GALJ,CAAL;AAOJ;AACH;;AACD,WAAK,OAAL;AACIlI,YAAI,CAACG,SAAL,GAAiBuC,KAAK,CAAC,CAAD,CAAtB;AACA;;AACJ,WAAK,OAAL;AACI1C,YAAI,CAACpI,SAAL,GAAiB8K,KAAK,CAAC,CAAD,CAAtB;AACA;;AACJ,WAAK,MAAL;AACI1C,YAAI,CAAC4F,YAAL,GAAoB,CAAC,CAACe,aAAa,CAACjE,KAAK,CAAC,CAAD,CAAN,CAAnC;AACA;;AACJ,WAAK,QAAL;AACI,YACI,CAAC,QAAD,EAAW,cAAX,EAA2B,YAA3B,EAAyC0C,OAAzC,CAAiD1C,KAAK,CAAC,CAAD,CAAtD,IACA,CAAC,CAFL,EAII1C,IAAI,CAACC,MAAL,GAAmByC,KAAK,CAAC,CAAD,CAAxB,CAJJ,KAKKhB,KAAK,CAAC,gBAAD,CAAL;AACL;;AACJ,WAAK,OAAL;AACI1B,YAAI,CAACmI,KAAL,GAAaC,UAAU,CAAC1F,KAAK,CAACP,KAAN,CAAY,CAAZ,EAAegC,IAAf,CAAoB,GAApB,CAAD,CAAvB;AACA;;AACJ,WAAK,MAAL;AAAa;AACT,cAAM5D,IAAI,GAAGmC,KAAK,CAACP,KAAN,CAAY,CAAZ,EAAevL,MAAf,CAAsB,UAAAY,CAAC;AAAA,mBAAIA,CAAC,IAAI,GAAL,IAAYA,CAAC,IAAI,GAArB;AAAA,WAAvB,CAAb;AACAwI,cAAI,CAACO,IAAL,GAAYP,IAAI,CAACO,IAAL,CAAU8H,MAAV,CAAiB9H,IAAjB,CAAZ;AACA;AACH;;AACD;AACImB,aAAK,CAAC,6BAA6BgB,KAAK,CAAC,CAAD,CAAnC,CAAL;AACA;AAzDR;AA2DH;;AAED,WAASpB,cAAT,CAAwBpK,IAAxB,EAAsC;AAClC,QAAIA,IAAI,IAAI,SAAZ,EAAuB;AACvB,QAAMoR,KAAK,GAAGxI,QAAQ,CAAC5I,IAAD,CAAtB;AACA,QAAI,CAACoR,KAAL,EAAY,OAAO5G,KAAK,CAAC,6BAA6BxK,IAA9B,CAAZ;AACZ,QACI8I,IAAI,CAACrJ,OAAL,CAAaoN,IAAb,CAAkB,UAAAvN,GAAG;AAAA,aAAI,CAACA,GAAG,CAACK,OAAT;AAAA,KAArB,KACAuK,MAAM,CAACpB,IAAI,CAACrH,KAAN,CAAN,CAAmBoL,IAAnB,CAAwB,UAAAtC,CAAC;AAAA,aAAI,CAACA,CAAC,CAAC5K,OAAP;AAAA,KAAzB,CAFJ,EAII6K,KAAK,CAAC,8CAAD,CAAL;AACJ,QAAI4G,KAAK,CAAC1H,MAAV,EAAkBA,MAAM,GAAGA,MAAM,CAACyH,MAAP,CAAcC,KAAK,CAAC1H,MAApB,CAAT;AAClB,QAAM2H,UAAU,GAAGC,KAAK,CAACF,KAAK,CAAC3P,KAAP,CAAxB;AACAgG,UAAM,CAACC,IAAP,CAAY2J,UAAZ,EACK3R,MADL,CACY,UAAAkI,CAAC;AAAA,aAAI,CAACkB,IAAI,CAACrH,KAAL,CAAWmG,CAAX,CAAL;AAAA,KADb,EAEKD,OAFL,CAEa,UAAAC,CAAC,EAAI;AACV,UAAM2J,EAAE,GAAGF,UAAU,CAACzJ,CAAD,CAArB;AACA2J,QAAE,CAAC5R,OAAH,GAAaK,IAAb;AACA8I,UAAI,CAACrH,KAAL,CAAWmG,CAAX,IAAgB2J,EAAhB;AACH,KANL;AAOA,QAAMC,YAAY,GAAGF,KAAK,CACtBF,KAAK,CAAC3R,OAAN,CAAcC,MAAd,CACI,UAAAJ,GAAG;AAAA,aACC,CAACwJ,IAAI,CAACrJ,OAAL,CAAaM,IAAb,CACG,UAAA0R,IAAI;AAAA,eACAA,IAAI,CAAClS,IAAL,KAAcD,GAAG,CAACC,IAAlB,IACAkS,IAAI,CAAC9E,UAAL,KAAoBrN,GAAG,CAACqN,UAFxB;AAAA,OADP,CADF;AAAA,KADP,CADsB,CAA1B;AAUA6E,gBAAY,CAAC7J,OAAb,CAAqB,UAAArI,GAAG;AAAA,aAAKA,GAAG,CAACK,OAAJ,GAAcK,IAAnB;AAAA,KAAxB;AACA8I,QAAI,CAACrJ,OAAL,kHAAmBqJ,IAAI,CAACrJ,OAAxB,wGAAoC+R,YAApC;AACA,QAAIJ,KAAK,CAAC1C,YAAV,EAAwB5F,IAAI,CAAC4F,YAAL,GAAoB,IAApB;AACxB5F,QAAI,CAACI,OAAL,GAAekI,KAAK,CAAClI,OAAN,CAAciI,MAAd,CAAqB,CAACnR,IAAD,CAArB,CAAf;AACH;;AAED,WAASsR,KAAT,CAAkBtQ,CAAlB,EAA2B;AACvB,WAAO0Q,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAe5Q,CAAf,CAAX,CAAP;AACH;;AAED,WAASwJ,KAAT,CAAeqH,GAAf,EAA4B;AACxB,QAAI,CAACA,GAAL,EAAUA,GAAG,GAAG,cAAN;AACV,QAAInI,MAAM,CAACmD,IAAP,CAAY,UAAAtC,CAAC;AAAA,aAAIA,CAAC,CAACF,IAAF,IAAUV,MAAV,IAAoBY,CAAC,CAACE,OAAF,IAAaoH,GAArC;AAAA,KAAb,CAAJ,EAA4D;AAC5DnI,UAAM,CAAC7B,IAAP,CAAY;AAAEiK,UAAI,EAAEjJ,QAAR;AAAkBwB,UAAI,EAAEV,MAAxB;AAAgCc,aAAO,EAAEoH;AAAzC,KAAZ;AACH;;AAED,WAAS1F,IAAT,CAAc0F,GAAd,EAA2B;AACvB,QAAI/I,IAAI,CAACG,SAAL,IAAkB,QAAtB,EAAgC,OADT,CACgB;;AACvC,QAAIS,MAAM,CAACmD,IAAP,CAAY,UAAAtC,CAAC;AAAA,aAAIA,CAAC,CAACF,IAAF,IAAUV,MAAV,IAAoBY,CAAC,CAACE,OAAF,IAAaoH,GAArC;AAAA,KAAb,CAAJ,EAA4D;AAC5DnI,UAAM,CAAC7B,IAAP,CAAY;AAAEiK,UAAI,EAAEjJ,QAAR;AAAkBwB,UAAI,EAAEV,MAAxB;AAAgCc,aAAO,EAAEoH;AAAzC,KAAZ;AACH;;AAED,WAASjE,aAAT,CAAuB+C,CAAvB,EAAkC;AAC9B,QAAI,CAAC,QAAQnQ,IAAR,CAAamQ,CAAb,CAAL,EAAsBnG,KAAK,CAAC,qBAAD,CAAL;AACtB,QAAImG,CAAC,CAACpP,MAAF,GAAW,EAAf,EAAmBiJ,KAAK,YAAUmG,CAAV,gBAAL;AACnB,WAAOA,CAAP;AACH;;AAED,WAAS5B,oBAAT,CACID,EADJ,EAEwC;AACpC,QAAIhG,IAAI,CAACrH,KAAL,CAAWqN,EAAX,CAAJ,EAAoB,OAAO,CAAChG,IAAI,CAACrH,KAAL,CAAWqN,EAAX,EAAetC,OAAhB,EAAyBsC,EAAzB,EAA6B,CAA7B,CAAP;AACpB,QAAI,CAACA,EAAL,EAAStE,KAAK,CAAC,qBAAD,CAAL;AACT,QAAMuH,GAAG,GAAGjD,EAAE,CAAC5N,OAAH,CAAW,KAAX,EAAkB,EAAlB,EAAsBmK,WAAtB,EAAZ;AACA,QAAMtJ,CAAC,GAAG,uBAAuBpB,IAAvB,CAA4BoR,GAA5B,CAAV;;AACA,QAAIhQ,CAAJ,EAAO;AACH,UAAMiQ,CAAC,GAAGvC,aAAa,CAAC1N,CAAC,CAAC,CAAD,CAAF,CAAvB;AACA,UAAMkQ,CAAC,GAAGxC,aAAa,CAAC1N,CAAC,CAAC,CAAD,CAAF,CAAvB;AACA,UAAMmQ,GAAG,GAAGF,CAAC,GAAGC,CAAhB;AACA,UAAI,EAAEC,GAAG,IAAI,CAAP,IAAYA,GAAG,IAAI,EAAnB,IAAyBA,GAAG,IAAI,EAAhC,IAAsCA,GAAG,IAAI,EAA/C,CAAJ,EACI1H,KAAK,kBAAgBsE,EAAhB,kBAA+BoD,GAA/B,WAAL;AACJ,UAAIF,CAAC,IAAI,CAAL,IAAUjQ,CAAC,CAAC,CAAD,CAAD,IAAQ,GAAtB,EACIyI,KAAK,kBACcsE,EADd,6CAAL;AAGJ,aAAO,CAAC,CAAC/M,CAAC,CAAC,CAAD,CAAD,IAAQ,GAAR,GAAc,CAAC,CAAf,GAAmB,CAApB,KAA0BmQ,GAAG,IAAI,CAAjC,CAAD,EAAsCH,GAAtC,EAA2CE,CAA3C,CAAP;AACH;;AAED,YAAQF,GAAR;AACI,WAAK,MAAL;AACI,eAAO,CAAC,CAAD,EAAIA,GAAJ,EAAS,CAAT,CAAP;;AACJ,WAAK,IAAL;AACA,WAAK,IAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AAAY;AACR,cAAII,EAAE,GAAG1C,aAAa,CAACsC,GAAG,CAAC7Q,OAAJ,CAAY,IAAZ,EAAkB,EAAlB,CAAD,CAAb,IAAwC,CAAjD;AACA,cAAI6Q,GAAG,CAAC,CAAD,CAAH,IAAU,GAAd,EAAmBI,EAAE,GAAG,CAACA,EAAN;AACnB,iBAAO,CAACA,EAAD,EAAKJ,GAAL,EAAU,CAAV,CAAP;AACH;;AACD,WAAK,KAAL;AACI,eAAO,CAAC,CAAD,EAAIA,GAAJ,EAAS,IAAT,CAAP;;AACJ,WAAK,KAAL;AACI,eAAO,CAAC,CAAD,EAAIA,GAAJ,EAAS,IAAT,CAAP;;AACJ,WAAK,KAAL;AACI,eAAO,CAAC,CAAD,EAAIA,GAAJ,EAAS,IAAT,CAAP;;AACJ,WAAK,MAAL;AACI,eAAO,CAAC,EAAD,EAAKA,GAAL,EAAU,CAAV,CAAP;;AACJ,WAAK,WAAL;AACI,eAAO,CAAC,CAAD,EAAIA,GAAJ,EAAS,CAAT,CAAP;;AACJ,WAAK,OAAL;AACI,eAAO,CAAC,CAAD,EAAIA,GAAJ,EAAS,CAAT,CAAP;;AACJ,WAAK,OAAL;AACA,WAAK,QAAL;AACA,WAAK,SAAL;AACI,eAAO,CAAC,CAAD,EAAIA,GAAJ,EAAS,CAAT,CAAP;;AACJ;AAAS;AACL,cAAMhQ,GAAC,GAAG,gBAAgBpB,IAAhB,CAAqBoR,GAArB,CAAV;;AACA,cAAIhQ,GAAJ,EAAO,OAAO,CAAC0N,aAAa,CAAC1N,GAAC,CAAC,CAAD,CAAF,CAAd,EAAsBgQ,GAAtB,EAA2B,CAA3B,CAAP;AACPvH,eAAK,CAAC,mBAAmBsE,EAAnB,GAAwB,GAAxB,GAA8BiD,GAA/B,CAAL;AACA,iBAAO,CAAC,CAAD,EAAIA,GAAJ,EAAS,CAAT,CAAP;AACH;AApCL;AAsCH;;AAED,WAAShC,aAAT,CAAuB3K,IAAvB,EAAkD;AAC9C,QAAIA,IAAI,KAAKkC,SAAT,IAAsBlC,IAAI,KAAK,IAAnC,EAAyC,OAAO,EAAP;AAEzC,QAAItD,eAAe,CAACsD,IAAD,CAAf,IAAyBF,uBAAuB,CAACE,IAAD,CAApD,EACI,OAAOA,IAAP;AACJoF,SAAK,2BAAyBpF,IAAzB,OAAL;AACA,WAAO,EAAP;AACH;;AAED,WAAS8G,mBAAT,CAA6BZ,KAA7B,EAAuD;AACnD,QAAI8G,UAAU,GAAG,CAAjB;;AAEA,0DAAgB9G,KAAK,CAACnL,MAAtB,2CAA8B;AAAA,UAAnB4B,CAAmB;AAC1B,UAAMoQ,EAAE,GAAGE,UAAU,CAACtQ,CAAD,CAArB;AACA,UAAIoQ,EAAE,IAAI,CAAV,EAAa;AACb,UAAMG,GAAG,GAAGH,EAAE,GAAG,CAAL,GAAS,CAAT,GAAaA,EAAzB;AACA,UAAI,CAAC,QAAQ3R,IAAR,CAAauB,CAAC,CAAC0K,IAAf,CAAD,IAAyB2F,UAAU,GAAGE,GAAb,IAAoB,CAAjD,EAAoD,OAAO,KAAP;AACpDF,gBAAU,IAAID,EAAd;AACH;;AAED,WAAO,IAAP;AACH;AACJ;;AAED,SAASjI,MAAT,CAAmBqI,CAAnB,EAA2C;AACvC,MAAM/K,CAAM,GAAG,EAAf;;AACA,oCAAgBC,MAAM,CAACC,IAAP,CAAY6K,CAAZ,CAAhB;AAAK,QAAM3K,CAAC,qBAAP;AAA2BJ,KAAC,CAACK,IAAF,CAAO0K,CAAC,CAAC3K,CAAD,CAAR;AAAhC;;AACA,SAAOJ,CAAP;AACH;;AAED,SAASgL,IAAT,CAAcX,GAAd,EAA2B;AACvB,QAAM,IAAIpR,KAAJ,CAAUoR,GAAV,CAAN;AACH;;AAED,SAASY,OAAT,CAAiBzS,IAAjB,EAA+B;AAC3B,SAAOA,IAAP,aAAOA,IAAP,uBAAOA,IAAI,CACLkB,OADC,CACO,iBADP,EAC0B,UAACwR,CAAD,EAAIV,CAAJ,EAAOC,CAAP;AAAA,WAAaD,CAAC,GAAG,GAAJ,GAAUC,CAAvB;AAAA,GAD1B,EAEFpH,WAFE,EAAP;AAGH;;AAED,SAAS8H,OAAT,CAAiB3S,IAAjB,EAA+B;AAC3B,SAAOA,IAAP,aAAOA,IAAP,uBAAOA,IAAI,CACLkB,OADC,CACO,iBADP,EAC0B,UAACwR,CAAD,EAAIV,CAAJ,EAAOC,CAAP;AAAA,WAAaD,CAAC,GAAG,GAAJ,GAAUC,CAAvB;AAAA,GAD1B,EAEF5G,WAFE,EAAP;AAGH;;AAED,SAASY,MAAT,CAAgBX,KAAhB,EAA0C;AACtC,MAAI,CAACA,KAAK,CAACW,MAAX,EAAmB,OAAO,EAAP,CAAnB,KACK,OAAO,0BAAP;AACR;;AAED,SAAS2G,QAAT,CAAkB9D,EAAlB,EAA0C;AACtC,MAAIA,EAAE,IAAI,CAAN,IAAW,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAaZ,OAAb,CAAqBe,IAAI,CAACI,GAAL,CAASP,EAAT,CAArB,IAAqC,CAApD,EAAuD,OAAO,OAAP;AACvD,MAAIA,EAAE,GAAG,CAAT,EAAY,eAAa,CAACA,EAAD,GAAM,CAAnB,QAAZ,KACK,gBAAcA,EAAE,GAAG,CAAnB;AACR;;AAED,SAASmB,aAAT,CAAuBnB,EAAvB,EAAuD;AACnD,MAAIA,EAAE,IAAI,CAAV,EAAa,OAAO,OAAP;AACb,MAAIA,EAAE,GAAG,CAAT,EAAY,aAAW,CAACA,EAAD,GAAM,CAAjB,CAAZ,KACK,aAAWA,EAAE,GAAG,CAAhB;AACR;;AAED,SAASzP,UAAT,CAAoBuI,CAApB,EAA0C;AACtC,SAAOA,CAAC,IAAI,IAAL,IAAaA,CAAC,IAAI,IAAlB,IAA0BA,CAAC,IAAI,OAAtC;AACH;;AAED,SAAS6G,KAAT,CAAekC,CAAf,EAAkC;AAC9B,MAAIA,CAAC,KAAKrJ,SAAV,EAAqB,OAAO,EAAP;AACrB,MAAIqJ,CAAC,GAAG,CAAR,EAAW,OAAO,MAAMlC,KAAK,CAACkC,CAAD,CAAlB;AACX,SAAO,OAAOA,CAAC,CAAC5D,QAAF,CAAW,EAAX,CAAd;AACH;;AAED,SAAS8F,QAAT,CAAkBjI,CAAlB,EAA0C;AACtC,MAAI,CAACA,CAAC,CAACxF,IAAP,EAAa,OAAO,EAAP,CAAb,KACK,OAAO0N,UAAU,CAAClI,CAAC,CAACxF,IAAH,CAAV,GAAqB,GAA5B;AACR;;AAED,SAAS0N,UAAT,CAAoBC,CAApB,EAA4C;AACxC,UAAQA,CAAR;AACI,SAAK,IAAL;AACI,aAAO,IAAP;;AACJ,SAAK,GAAL;AACI,aAAO,IAAP;;AACJ,SAAK,GAAL;AACI,aAAO,OAAP;;AACJ;AACI,aAAOA,CAAP;AARR;AAUH;;AAED,SAASC,GAAT,CAAalK,IAAb,EAAuC;AACnC,MAAItB,CAAC,GAAG,wCAAwCsB,IAAI,CAAC9I,IAA7C,GAAoD,IAA5D;AACA,MAAMiT,KAAK,qBAAmBR,OAAO,CAAC3J,IAAI,CAACG,SAAN,CAA1B,OAAX;AACAzB,GAAC,iBAAeyL,KAAf,OAAD;AACAzL,GAAC,iBAAeyL,KAAf,SAAD;AAEA,MAAIC,IAAI,GAAG,QAAQT,OAAO,CAAC3J,IAAI,CAACpI,SAAN,CAAf,GAAkC,GAA7C;AAEA,MAAIoI,IAAI,CAACE,OAAL,CAAa,CAAb,KAAmB,GAAvB,EAA4BkK,IAAI,GAAG,KAAP;AAE5B,MAAIpK,IAAI,CAACE,OAAL,CAAa,CAAb,KAAmB,GAAvB,EACIxB,CAAC,oCAAkCiL,OAAO,CAAC3J,IAAI,CAACpI,SAAN,CAAzC,UAA8D+N,KAAK,CAChE3F,IAAI,CAACM,eAD2D,CAAnE,OAAD;;AAIJ,wDAAiBc,MAAM,CAACpB,IAAI,CAACrH,KAAN,CAAN,CAAmB/B,MAAnB,CAA0B,UAAA8B,EAAE;AAAA,WAAI,CAACA,EAAE,CAAC7B,OAAR;AAAA,GAA5B,CAAjB,2CAA+D;AAAA,QAApD6B,EAAoD;AAC3D,QAAM2R,MAAM,GAAGD,IAAI,GAAGT,OAAO,CAACjR,EAAE,CAACxB,IAAJ,CAA7B;AACAwH,KAAC,mBAAiBhG,EAAE,CAACxB,IAApB,UAA6B4S,QAAQ,CAACpR,EAAE,CAACgL,OAAJ,CAArC,QAAD;;AACA,sCAAgB/E,MAAM,CAACC,IAAP,CAAYlG,EAAE,CAACE,OAAf,CAAhB;AAAK,UAAMkG,CAAC,qBAAP;AACDJ,OAAC,IACG,aACA2L,MADA,GAEA,GAFA,GAGAV,OAAO,CAAC7K,CAAD,CAHP,GAIA,GAJA,GAKA6G,KAAK,CAACjN,EAAE,CAACE,OAAH,CAAWkG,CAAX,CAAD,CALL,GAMA,IAPJ;AADJ;AASH;;AACD,wDAAkBkB,IAAI,CAACrJ,OAAvB,2CAAgC;AAAA,QAArBH,GAAqB;AAC5B,QAAIA,GAAG,CAACK,OAAR,EAAiB;AAEjB,QAAMyT,GAAG,GAAGC,UAAU,CAAC/T,GAAD,CAAtB;AACAkI,KAAC,IAAI8L,WAAW,CAACF,GAAG,CAACG,OAAL,CAAhB;;AAEA,QACI,CAACjU,GAAG,CAACuO,SAAL,IACAvO,GAAG,CAACC,IAAJ,IAAY,cADZ,IAEAD,GAAG,CAACC,IAAJ,IAAY,aAHhB,EAIE;AACE,UAAI6R,KAAK,GAAG,KAAZ;AACA,UAAI/R,UAAU,CAACC,GAAG,CAACC,IAAL,CAAd,EAA0B6R,KAAK,GAAG,KAAR,CAA1B,KACK,IAAI9R,GAAG,CAACC,IAAJ,IAAY,OAAhB,EAAyB6R,KAAK,GAAG,IAAR,CAAzB,KACA,IACD9R,GAAG,CAACC,IAAJ,IAAY,mBAAZ,IACAD,GAAG,CAACC,IAAJ,IAAY,kBAFX,EAID6R,KAAK,GAAG,MAAR;AACJ,UAAI5B,GAAG,GAAGf,KAAK,CAACnP,GAAG,CAACqN,UAAL,CAAf;AACA,UAAIrN,GAAG,CAAC+O,cAAR,EACImB,GAAG,GAAG,QAAQ4B,KAAR,GAAgB,GAAhB,GAAsBqB,OAAO,CAACnT,GAAG,CAAC+O,cAAL,CAAnC;AACJ,UAAMrO,IAAI,GAAGkT,IAAI,GAAG9B,KAAP,GAAe,GAAf,GAAqBqB,OAAO,CAACnT,GAAG,CAACU,IAAL,CAAzC;AACA,UAAIA,IAAI,IAAIwP,GAAZ,EAAiBhI,CAAC,iBAAexH,IAAf,SAAuBwP,GAAvB,OAAD;AACpB;;AAED,QAAMgE,UAAU,GACZlU,GAAG,CAACC,IAAJ,IAAY,kBAAZ,IAAkCD,GAAG,CAACC,IAAJ,IAAY,mBADlD;;AAGA,QAAI6T,GAAG,CAACK,WAAJ,IAAmBD,UAAvB,EAAmC;AAC/B,UAAIE,KAAK,GACL,QAAQf,OAAO,CAAC7J,IAAI,CAACG,SAAN,CAAf,GAAkC,GAAlC,GAAwC0J,OAAO,CAACrT,GAAG,CAACU,IAAL,CADnD;AAEA,UAAIV,GAAG,CAACC,IAAJ,IAAY,QAAhB,EAA0BmU,KAAK,IAAI,SAAT;AAC1BlM,OAAC,wBAAsBkM,KAAtB,SAAD;;AACA,UAAIF,UAAJ,EAAgB;AACZhM,SAAC,qCAAmCiH,KAAK,CAACnP,GAAG,CAACqN,UAAL,CAAxC,OAAD;AACH;;AACD,UAAIgH,SAAS,GAAG,EAAhB;;AACA,WAAK,IAAI/C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtR,GAAG,CAACa,MAAJ,CAAWoB,MAA/B,EAAuC,EAAEqP,CAAzC,EAA4C;AACxC,YAAMhG,CAAC,GAAGtL,GAAG,CAACa,MAAJ,CAAWyQ,CAAX,CAAV;AACA,YAAIgD,GAAG,GAAG,EAAV;AACA,YAAMC,GAAG,GAAGjB,QAAQ,CAAChI,CAAC,CAAC4B,OAAH,CAApB;AACA,YAAM2F,EAAE,GAAGE,UAAU,CAACzH,CAAD,CAArB;AACA,YAAIA,CAAC,CAAC6B,IAAF,IAAU,QAAV,IAAsB7B,CAAC,CAAC6B,IAAF,IAAU,SAApC,EACImH,GAAG,aAAWhJ,CAAC,CAAC5K,IAAb,SAAqBmS,EAArB,MAAH,CADJ,KAEK,IAAI0B,GAAG,IAAI,OAAX,EAAoBD,GAAG,gBAAchJ,CAAC,CAAC5K,IAAhB,SAAwBmS,EAAxB,MAAH,CAApB,KACAyB,GAAG,GAAMC,GAAN,SAAajJ,CAAC,CAAC5K,IAAlB,CARmC,CASxC;;AACA,YAAI4K,CAAC,CAAC2B,YAAF,IAAkBqE,CAAC,IAAItR,GAAG,CAACa,MAAJ,CAAWoB,MAAX,GAAoB,CAA/C,EAAkDqS,GAAG,IAAI,KAAP;AAClDA,WAAG,IAAI,GAAP;AACA,YAAI,CAAChJ,CAAC,CAACoF,YAAH,IAAmBpF,CAAC,CAAC6B,IAAF,IAAU,OAAjC,EACImH,GAAG,IAAI,UAAUf,QAAQ,CAACjI,CAAD,CAAlB,GAAwBA,CAAC,CAAC6B,IAAjC,CADJ,KAEK,IAAI7B,CAAC,CAACxF,IAAN,EAAYwO,GAAG,IAAI,SAASd,UAAU,CAAClI,CAAC,CAACxF,IAAH,CAA1B;AACjBoC,SAAC,IAAI,SAASmM,SAAT,GAAqBC,GAArB,GAA2B,IAAhC;AACA,YAAIhJ,CAAC,CAAC6B,IAAF,IAAU,SAAd,EAAyBkH,SAAS,GAAG,KAAZ;AAC5B;;AACDnM,OAAC,UAAQyE,MAAM,CAAC3M,GAAD,CAAd,SAAuBoU,KAAvB,YAAD;AACH;AACJ;;AACDlM,GAAC,IAAI,YAAL;AACA,SAAOA,CAAP;AACH;;AAEM,SAASmD,QAAT,CAAkB3K,IAAlB,EAAgC;AACnC,MAAI,CAACA,IAAL,EAAW,OAAOA,IAAP;AACX,SACIA,IAAI,CAAC,CAAD,CAAJ,CAAQqL,WAAR,KACArL,IAAI,CAACiL,KAAL,CAAW,CAAX,EAAc/J,OAAd,CAAsB,eAAtB,EAAuC,UAAC4S,CAAD,EAAI7L,CAAJ;AAAA,WAAUA,CAAC,CAAC4C,WAAF,EAAV;AAAA,GAAvC,CAFJ;AAIH;AAEM,SAASqG,UAAT,CAAoBlR,IAApB,EAAkC;AACrC,MAAI,CAACA,IAAL,EAAW,OAAOA,IAAP;AACX,SAAOA,IAAI,CAAC,CAAD,CAAJ,CAAQ6K,WAAR,KAAwB7K,IAAI,CAACiL,KAAL,CAAW,CAAX,CAA/B;AACH;;AAED,SAAS8I,UAAT,CAAoB/T,IAApB,EAAkC;AAAA;;AAC9BA,MAAI,GAAG2K,QAAQ,CAAC3K,IAAD,CAAf;AACA,MAAI,WAACA,IAAD,kCAAC,MAAMuB,MAAP,CAAJ,EAAmB,OAAOvB,IAAP;AACnB,SAAOA,IAAI,CAAC,CAAD,CAAJ,CAAQ6K,WAAR,KAAwB7K,IAAI,CAACiL,KAAL,CAAW,CAAX,CAA/B;AACH;;AAEM,SAAS+I,OAAT,CAAiBhU,IAAjB,EAA+B;AAClC,SAAOA,IAAP,aAAOA,IAAP,uBAAOA,IAAI,CAAEkB,OAAN,CAAc,iBAAd,EAAiC,UAAC4S,CAAD,EAAI9B,CAAJ,EAAOC,CAAP;AAAA,WAAaD,CAAC,GAAG,GAAJ,GAAUC,CAAvB;AAAA,GAAjC,CAAP;AACH;AAEM,SAASgC,OAAT,CAAiBjU,IAAjB,EAA+B;AAClC,MAAI,CAACA,IAAL,EAAW,OAAOA,IAAP;AACX,SAAOgU,OAAO,CAAChU,IAAI,CAACkB,OAAL,CAAa,KAAb,EAAoB,EAApB,CAAD,CAAP,CAAiCA,OAAjC,CAAyC,IAAzC,EAA+C,GAA/C,EAAoDmK,WAApD,EAAP;AACH;AAEM,SAAS6I,QAAT,CAAkBlU,IAAlB,EAAgC;AACnC,SAAOA,IAAP,aAAOA,IAAP,uBAAOA,IAAI,CACLkB,OADC,CACO,iBADP,EAC0B,UAAC4S,CAAD,EAAI9B,CAAJ,EAAOC,CAAP;AAAA,WAAaD,CAAC,GAAG,GAAJ,GAAUC,CAAvB;AAAA,GAD1B,EAEF/Q,OAFE,CAEM,QAFN,EAEgB,GAFhB,CAAP;AAGH;;AAED,SAASmS,UAAT,CAAoB/T,GAApB,EAA4C;AACxC,MAAIiU,OAAO,GAAG,EAAd;AAEA,MAAIY,QAAQ,GAAG,EAAf;AACA,MAAIV,WAAW,GAAG,KAAlB;;AACA,MAAInU,GAAG,CAACa,MAAJ,CAAWoB,MAAX,IAAqB,CAAzB,EAA4B;AACxB,QAAIjC,GAAG,CAACC,IAAJ,IAAY,OAAhB,EAAyB4U,QAAQ,GAAG,SAAX;AAC5B,GAFD,MAEO,IAAI7U,GAAG,CAACa,MAAJ,CAAWoB,MAAX,IAAqB,CAArB,IAA0B,CAACjC,GAAG,CAACa,MAAJ,CAAW,CAAX,EAAcoM,YAA7C,EAA2D;AAC9D,QAAM6H,EAAE,GAAG9U,GAAG,CAACa,MAAJ,CAAW,CAAX,CAAX;AACAgU,YAAQ,GAAGvB,QAAQ,CAACwB,EAAE,CAAC5H,OAAJ,CAAnB;AACA,QAAI,CAAC4H,EAAE,CAACpE,YAAR,EAAsBmE,QAAQ,GAAGC,EAAE,CAAC3H,IAAH,GAAU,IAAV,GAAiB0H,QAAjB,GAA4B,GAAvC;AACtBA,YAAQ,GAAGtB,QAAQ,CAACuB,EAAD,CAAR,GAAeD,QAA1B;AACA,QAAIC,EAAE,CAACpU,IAAH,IAAW,GAAf,EAAoBmU,QAAQ,GAAGC,EAAE,CAACpU,IAAH,GAAU,GAAV,GAAgBmU,QAA3B;AACvB,GANM,MAMA;AACHV,eAAW,GAAG,IAAd;AACH;;AAED,MAAInU,GAAG,CAACa,MAAJ,CAAWoB,MAAX,IAAqB,CAAzB,EAA4B;AACxB,QAAIlC,UAAU,CAACC,GAAG,CAACC,IAAL,CAAd,EAA0B;AACtB,UAAIuJ,IAAI,GAAG,EAAX;AACA,UAAIxJ,GAAG,CAACC,IAAJ,IAAY,IAAhB,EAAsBuJ,IAAI,GAAG,WAAP,CAAtB,KACK,IAAIxJ,GAAG,CAACC,IAAJ,IAAY,OAAhB,EAAyBuJ,IAAI,GAAG,UAAP,CAAzB,KACAA,IAAI,GAAG,YAAP;AACL,UAAIqL,QAAJ,EAAcA,QAAQ,GAAGrL,IAAI,GAAG,GAAP,GAAaqL,QAAxB,CAAd,KACKA,QAAQ,GAAGrL,IAAX;AACR,KAPD,MAOO,IAAIqL,QAAJ,EAAc;AACjBA,cAAQ,GAAG,eAAeA,QAA1B;AACH;AACJ;;AAED,MAAI7U,GAAG,CAACC,IAAJ,IAAY,QAAZ,IAAwBD,GAAG,CAACuO,SAAhC,EAA2C;AACvC0F,WAAO,IAAI,aAAaY,QAAb,GAAwB,IAAnC;AACH,GAFD,MAEO;AACH,QAAI7U,GAAG,CAACwI,WAAR,EAAqB;AACjB,UAAIuM,IAAI,GAAG/U,GAAG,CAACwI,WAAJ,CAAgB5G,OAAhB,CAAwB,UAAxB,EAAoC,EAApC,CAAX;AACA,UAAIiT,QAAJ,EAAcE,IAAI,GAAGF,QAAQ,GAAG,IAAX,GAAkBE,IAAzB;AACdd,aAAO,GAAGc,IAAI,GAAG,IAAP,GAAcd,OAAxB;AACH;AACJ;;AAED,SAAO;AACHA,WAAO,EAAPA,OADG;AAEHE,eAAW,EAAXA;AAFG,GAAP;AAIH;;AAED,SAASH,WAAT,CAAqBC,OAArB,EAAsC;AAClC,SACI,eACAA,OAAO,CAACrS,OAAR,CAAgB,MAAhB,EAAwB,EAAxB,EAA4BA,OAA5B,CAAoC,KAApC,EAA2C,OAA3C,CADA,GAEA,SAHJ;AAKH;;AAED,SAASoT,WAAT,CAAqBC,IAArB,EAAmC;AAC/B,MAAI,CAACA,IAAL,EAAW,OAAOA,IAAP;AACX,qBAEFA,IAAI,CAACrT,OAAL,CAAa,MAAb,EAAqB,EAArB,EAAyBA,OAAzB,CAAiC,MAAjC,EAAyC,EAAzC,CAFE;AAKH;;AAEM,IAAMsT,2BAA2B,GAAG,QAApC;;AACP,SAASC,kBAAT,CACI3L,IADJ,EAEIjI,GAFJ,EAGI6T,QAHJ,EAIIC,WAJJ,EAKE;AACE,MAAMxC,EAAE,GAAGE,UAAU,CAACxR,GAAD,CAArB;AACA,MAAM+T,MAAM,GAAGzC,EAAE,SAAOA,EAAP,WAAjB;AACA,MAAI0C,MAAM,GAAG,QAAb;AACA,MAAIC,GAAG,GAAG,EAAV;;AACA,MAAI,qBAAqBtU,IAArB,CAA0BK,GAAG,CAAC4L,IAA9B,KAAuC,KAAK0F,EAA5C,IAAkDA,EAAE,IAAI,CAA5D,EAA+D;AAC3D2C,OAAG,GAAGjU,GAAG,CAAC4L,IAAV;AACH,GAFD,MAEO,IAAI,cAAc9L,IAAd,CAAmBE,GAAG,CAAC4L,IAAvB,CAAJ,EAAkC;AACrCqI,OAAG,GAAG,MAAMF,MAAZ;AACH,GAFM,MAEA,IAAI9L,IAAI,CAACrH,KAAL,CAAWZ,GAAG,CAAC4L,IAAf,CAAJ,EAA0B;AAC7BqI,OAAG,GAAG7E,aAAa,CAACnH,IAAI,CAACrH,KAAL,CAAWZ,GAAG,CAAC4L,IAAf,EAAqBD,OAAtB,CAAnB;AACAqI,UAAM,GAAGd,UAAU,CAACjL,IAAI,CAACG,SAAN,CAAV,GAA6B8K,UAAU,CAAClT,GAAG,CAAC4L,IAAL,CAAhD;AACA,QAAIiI,QAAJ,EAAcG,MAAM,GAAGL,2BAA2B,GAAG,GAA9B,GAAoCK,MAA7C;AACjB,GAJM,MAIA;AACH,YAAQhU,GAAG,CAAC4L,IAAZ;AACI,WAAK,QAAL;AACIqI,WAAG,GAAG,MAAMF,MAAZ;AACAC,cAAM,GAAG,QAAT;AACA;;AACJ,WAAK,OAAL;AACIC,WAAG,GAAG,MAAMF,MAAZ;AACA;;AACJ,WAAK,SAAL;AACIE,WAAG,GAAG,GAAN;AACAD,cAAM,GAAG,QAAT;AACA;;AACJ,WAAK,OAAL;AACIC,WAAG,GAAG,MAAN;AACA;;AACJ,WAAK,WAAL;AACIA,WAAG,GAAG,KAAN;AACA;;AACJ,WAAK,MAAL;AACIA,WAAG,GAAG,OAAN;AACA;;AACJ,WAAK,MAAL;AACI;AACAA,WAAG,GAAG,IAAN;AACA,YAAIH,WAAJ,EAAiBE,MAAM,GAAG,SAAT;AACjB;;AACJ;AACI,eAAO,IAAP;AA3BR;AA6BH;;AAED,MAAIA,MAAM,IAAI,QAAV,IAAsBC,GAAtB,IAA6BA,GAAG,CAAC,CAAD,CAAH,IAAU,GAA3C,EAAgDD,MAAM,GAAG,QAAT;AAChD,SAAO;AAAEC,OAAG,EAAHA,GAAF;AAAOD,UAAM,EAANA;AAAP,GAAP;AACH;AAED;AACA;AACA;AACA;AACA;;;AACO,SAAS/J,UAAT,CACHiK,KADG,EAEHzV,GAFG,EAGHqV,WAHG,EAIG;AAAA;;AACN,MAAIrV,GAAG,CAAC2M,MAAJ,IAAc,iBAAC3M,GAAG,CAACa,MAAL,wCAAC,YAAYoB,MAAb,CAAlB,EAAuC,OAAO+F,SAAP;AAEvC,MAAMwN,GAAa,GAAG,EAAtB;;AACA,wDAAkBxV,GAAG,CAACa,MAAtB,2CAA8B;AAAA,QAAnBU,GAAmB;AAC1B,QAAIA,GAAG,CAAC0L,YAAR,EAAsBuI,GAAG,CAACjN,IAAJ,CAAS,IAAT;AACtB,QAAMmN,EAAE,GAAGP,kBAAkB,CAACM,KAAD,EAAQlU,GAAR,EAAa,KAAb,EAAoB8T,WAApB,CAA7B;AACA,QAAI,CAACK,EAAL,EAAS,OAAO1N,SAAP;AACTwN,OAAG,CAACjN,IAAJ,CAASmN,EAAE,CAACF,GAAZ;AACH;;AAED,SAAOA,GAAG,CAAC7H,IAAJ,CAAS,GAAT,CAAP;AACH;AAEM,SAASgI,QAAT,CACHnM,IADG,EAEHxJ,GAFG,EAGHoV,QAHG,EAIHC,WAJG,EAKL;AACE,MAAMlQ,IAAc,GAAG,EAAvB;AACA,MAAMyQ,KAAe,GAAG,EAAxB;AACA,MAAIJ,GAAG,GAAG,EAAV;AACA,MAAI1I,OAAJ;AACA,MAAI+I,KAAJ;;AAEA,OAAK,IAAIvE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtR,GAAG,CAACa,MAAJ,CAAWoB,MAA/B,EAAuC,EAAEqP,CAAzC,EAA4C;AACxC,QAAM/P,GAAG,GAAGvB,GAAG,CAACa,MAAJ,CAAWyQ,CAAX,CAAZ;AACA,QAAIwE,OAAO,GAAG,EAAd;;AACA,QAAIvU,GAAG,CAAC0L,YAAR,EAAsB;AAClB,UAAIqE,CAAC,IAAItR,GAAG,CAACa,MAAJ,CAAWoB,MAAX,GAAoB,CAA7B,EAAgC;AAC5B6T,eAAO,GAAG,IAAV;AACH,OAFD,MAEO;AACHN,WAAG,IAAI,KAAP;AACA1I,eAAO,GAAG,EAAV;AACA+I,aAAK,GAAG,EAAR;AACA1Q,YAAI,CAACoD,IAAL,CAAU,MAAV;AACH;AACJ;;AACD,QAAMwN,OAAO,GAAG1K,QAAQ,CAAC9J,GAAG,CAACb,IAAJ,IAAY,GAAZ,GAAkBV,GAAG,CAACU,IAAtB,GAA6Ba,GAAG,CAACb,IAAlC,CAAxB;AACA,QAAMoU,EAAE,GAAGK,kBAAkB,CAAC3L,IAAD,EAAOjI,GAAP,EAAY6T,QAAZ,EAAsBC,WAAtB,CAA7B;;AACA,QAAI,CAACP,EAAD,IAAO,qBAAqB5T,IAArB,CAA0BK,GAAG,CAACb,IAA9B,CAAX,EAAgD;AAC5C,UAAI,CAACoU,EAAL,EACIkB,OAAO,CAACC,GAAR,CACOjW,GAAG,CAACU,IADX,SACmBa,GAAG,CAACb,IADvB,iCACuDa,GAAG,CAAC4L,IAD3D;AAGJqI,SAAG,WAASzC,UAAU,CAACxR,GAAD,CAAnB,OAAH;AACH,KAND,MAMO;AACHiU,SAAG,IAAIV,EAAE,CAACU,GAAH,GAASM,OAAT,GAAmB,GAA1B;AACA,UAAItG,EAAE,GAAGsF,EAAE,CAACS,MAAZ;AACA,UAAI/F,EAAE,IAAI,QAAN,IAAkB,CAAC4F,QAAvB,EAAiC5F,EAAE,GAAG,YAAL;AACjCA,QAAE,IAAIsG,OAAN;;AACA,UAAIhJ,OAAJ,EAAa;AACTA,eAAO,CAACvE,IAAR,CAAawN,OAAb;AACAF,aAAK,CAACtN,IAAN,CAAWiH,EAAX;AACH,OAHD,MAGO;AACHrK,YAAI,CAACoD,IAAL,CAAUwN,OAAV;AACAH,aAAK,CAACrN,IAAN,CAAWiH,EAAX;AACH;AACJ;AACJ;;AAEDgG,KAAG,GAAGA,GAAG,CAAC5T,OAAJ,CAAY,KAAZ,EAAmB,EAAnB,CAAN;AAEA,MAAIiU,KAAJ,EAAWD,KAAK,CAACrN,IAAN,CAAW,OAAOsN,KAAK,CAAClI,IAAN,CAAW,IAAX,CAAP,GAA0B,MAArC;AAEX,MAAIuI,OAAO,GAAG,EAAd;AACAA,SAAO,gBAAc/Q,IAAI,CAACwI,IAAL,CAAU,IAAV,CAAd,sBAA8CiI,KAAK,CAACjI,IAAN,CACjD,IADiD,CAA9C,kBAEM6H,GAFN,UAAP;AAGA,MAAI1I,OAAJ,EAAaoJ,OAAO,gBAAcpJ,OAAO,CAACa,IAAR,CAAa,IAAb,CAAd,kBAAP;AAEbuI,SAAO,GAAGA,OAAO,CAACtU,OAAR,CAAgB,MAAhB,EAAwB,EAAxB,CAAV;AAEA,SAAO;AACHsU,WAAO,EAAPA,OADG;AAEHC,SAAK,EAAEhR,IAFJ;AAGHiR,SAAK,EAAER;AAHJ,GAAP;AAKH;;AAED,SAAS7C,UAAT,CAAoBxR,GAApB,EAA8C;AAC1C,SAAOoO,IAAI,CAACI,GAAL,CAASxO,GAAG,CAAC2L,OAAb,CAAP;AACH;;AAED,SAASmJ,YAAT,CAAsB7M,IAAtB,EAAgD8M,gBAAhD,EAA2E;AACvE,MAAMC,MAAM,GAAGD,gBAAgB,GAAG,MAAH,GAAY,EAA3C;AACA,MAAME,OAAO,GAAGD,MAAM,GAAG,MAAzB;AACA,MAAME,MAAM,GAAGH,gBAAgB,GACzBC,MAAM,GAAG,mBADgB,GAEzB,aAFN;AAGA,MAAIrO,CAAC,GAAGoO,gBAAgB,kBAAgBpB,2BAAhB,YAAoD,EAA5E;AACAhN,GAAC,IAAIqO,MAAM,GAAG,cAAT,GAA0B/M,IAAI,CAAC9I,IAA/B,GAAsC,IAA3C;;AACA,MAAI8I,IAAI,CAACE,OAAL,CAAa,CAAb,KAAmB,GAAvB,EAA4B;AACxBxB,KAAC,IACGqO,MAAM,0BACc7B,OAAO,CACvBlL,IAAI,CAACG,SADkB,CAAP,CAElB+M,iBAFkB,EADd,WAGqBvH,KAAK,CAAC3F,IAAI,CAACM,eAAN,CAH1B,QADV;AAKH;;AACD,MAAM8J,IAAI,GAAGa,UAAU,CAACjL,IAAI,CAACG,SAAN,CAAvB;;AACA,yDAAiBiB,MAAM,CAACpB,IAAI,CAACrH,KAAN,CAAvB,8CAAqC;AAAA,QAA1BD,EAA0B;AACjC,QAAM2R,MAAM,GAAGD,IAAI,GAAGa,UAAU,CAACvS,EAAE,CAACxB,IAAJ,CAAhC;AACAwH,KAAC,WAASuO,MAAT,SAAmB5C,MAAnB,cAAkCP,QAAQ,CAACpR,EAAE,CAACgL,OAAJ,CAA1C,OAAD;;AACA,sCAAgB/E,MAAM,CAACC,IAAP,CAAYlG,EAAE,CAACE,OAAf,CAAhB;AAAK,UAAMkG,EAAC,qBAAP;AACDJ,OAAC,IAAIsO,OAAO,GAAGlO,EAAV,GAAc,KAAd,GAAsB6G,KAAK,CAACjN,EAAE,CAACE,OAAH,CAAWkG,EAAX,CAAD,CAA3B,GAA6C,KAAlD;AADJ;;AAEAJ,KAAC,IAAIqO,MAAM,GAAG,OAAd;AACH;;AACD,MAAMI,OAA4B,GAAG,EAArC;;AAEA,yDAAkBnN,IAAI,CAACrJ,OAAvB,8CAAgC;AAAA,QAArBH,GAAqB;AAC5B,QAAIA,GAAG,CAACK,OAAR,EAAiB;AAEjB,QAAMyT,GAAG,GAAGC,UAAU,CAAC/T,GAAD,CAAtB;AACA,QAAM4W,IAAI,GAAG5W,GAAG,CAACa,MAAJ,CAAWoB,MAAX,GACP0T,QAAQ,CAACnM,IAAD,EAAOxJ,GAAP,EAAYsW,gBAAZ,CAAR,CAAsCJ,OAD/B,GAEP,EAFN;AAIA,QAAIpE,MAAK,GAAG,KAAZ;AACA,QAAI/R,UAAU,CAACC,GAAG,CAACC,IAAL,CAAd,EAA0B6R,MAAK,GAAG,KAAR,CAA1B,KACK,IAAI9R,GAAG,CAACC,IAAJ,IAAY,OAAhB,EAAyB6R,MAAK,GAAG,OAAR,CAAzB,KACA,IACD9R,GAAG,CAACC,IAAJ,IAAY,mBAAZ,IACAD,GAAG,CAACC,IAAJ,IAAY,kBAFX,EAID6R,MAAK,GAAG,SAAR,CAJC,KAKA,IAAI9R,GAAG,CAACC,IAAJ,IAAY,cAAZ,IAA8BD,GAAG,CAACC,IAAJ,IAAY,aAA9C,EACD6R,MAAK,GAAG,MAAR;AAEJ,QAAI+E,IAAI,GAAG,EAAX;AACA,QAAIC,IAAI,GAAG,EAAX;;AACA,QAAI9W,GAAG,CAACuO,SAAJ,IAAiBuD,MAAK,IAAI,MAA9B,EAAsC;AAClC,UAAI8E,IAAJ,EACIC,IAAI,GAAG7C,WAAW,CACXhU,GAAG,CAACC,IADO,SACCwU,UAAU,CAACzU,GAAG,CAACU,IAAL,CADX,GACwBsU,WAAW,CAAC4B,IAAD,CADnC,CAAlB;AAGP,KALD,MAKO;AACH,UAAM1G,GAAG,GAAGf,KAAK,CAACnP,GAAG,CAACqN,UAAL,CAAjB;;AACA,UAAIiJ,gBAAgB,IAAItW,GAAG,CAACC,IAAJ,KAAa,OAArC,EAA8C;AAC1C6W,YAAI,oBAAiBpC,OAAO,CAAC1U,GAAG,CAACU,IAAL,CAAP,CAAkBkB,OAAlB,CAA0B,IAA1B,EAAgC,GAAhC,CAAjB,SAAJ;AACH;;AACDiV,UAAI,SACA7C,WAAW,CAACF,GAAG,CAACG,OAAJ,GAAce,WAAW,CAAC4B,IAAD,CAA1B,CAAX,GAA+CE,IAD/C,IAEDrC,UAAU,CAACzU,GAAG,CAACU,IAAL,CAFT,WAEyBwP,GAFzB,QAAJ;AAGH;;AAED,QAAI2G,IAAJ,EAAUF,OAAO,CAAC7E,MAAD,CAAP,GAAiB,CAAC6E,OAAO,CAAC7E,MAAD,CAAP,IAAkB,EAAnB,IAAyB+E,IAA1C,CApCkB,CAsC5B;AACA;AACH;;AAED,oCAAgB1O,MAAM,CAACC,IAAP,CAAYuO,OAAZ,CAAhB,qCAAsC;AAAjC,QAAMrO,CAAC,qBAAP;AACD,QAAIA,CAAC,IAAI,MAAT,EAAiBJ,CAAC,IAAIyO,OAAO,CAACrO,CAAD,CAAP,CAAW1G,OAAX,CAAmB,KAAnB,EAA0B2U,MAA1B,IAAoC,MAAzC,CAAjB,KACK;AACD,UAAMzE,KAAK,GAAG6E,OAAO,CAACrO,CAAD,CAAP,CACT1G,OADS,CACD,MADC,EACO,EADP,EAETA,OAFS,CAED,KAFC,EAEM,EAFN,EAGTA,OAHS,CAGD,KAHC,EAGM,WAAW2U,MAHjB,CAAd;AAIArO,OAAC,IAAOuO,MAAP,SAAiB7C,IAAjB,GAAwBtL,CAAxB,gBAAoCiO,MAApC,GAA6CzE,KAA7C,UAAuDyE,MAAvD,UAAD;AACH;AACJ;;AAED,MAAID,gBAAJ,EAAsBpO,CAAC,IAAI,KAAL;AAEtB,SAAOA,CAAC,CAACtG,OAAF,CAAU,OAAV,EAAmB,EAAnB,CAAP;AACH;;AAEM,SAASmV,4BAAT,CAAsCC,GAAtC,EAA8D;AACjE;AACA,MAAMhF,KAAwB,GAAG;AAC7BxR,MAAE,EAAGwW,GAAG,CAACxW,EAAJ,GACDyW,sBAAsB,CAACD,GAAG,CAACE,OAAL,CAAtB,GACA,GADA,GAEAC,0BAA0B,CAACH,GAAG,CAACtW,IAAL,CAJD;AAK7BA,QAAI,EAAEsW,GAAG,CAACtW,IALmB;AAM7BwW,WAAO,EAAEF,GAAG,CAACE,OANgB;AAO7B1O,eAAW,EAAEwO,GAAG,CAACxO,WAPY;AAQ7B4O,QAAI,EAAEJ,GAAG,CAACI,IARmB;AAS7BC,QAAI,EAAEL,GAAG,CAACK,IATmB;AAU7BC,YAAQ,EAAEN,GAAG,CAACM,QAAJ,IAAgB,EAVG;AAW7BC,aAAS,EAAEP,GAAG,CAACO,SAAJ,IAAiB;AAXC,GAAjC;AAaA,SAAOvF,KAAP;AACH;AAEM,SAASiF,sBAAT,CAAgCJ,IAAhC,EAA8C;AACjD,MAAI,CAACA,IAAL,EAAWA,IAAI,GAAG,EAAP;AACX,MAAMW,OAAO,GAAGX,IAAI,CACfpL,IADW,GAEXM,WAFW,GAGXnK,OAHW,CAGH,mBAHG,EAGkB,GAHlB,EAIXA,OAJW,CAIH,KAJG,EAII,EAJJ,EAKXA,OALW,CAKH,KALG,EAKI,EALJ,CAAhB;AAMA,MAAMpB,EAAE,GAAGkU,OAAO,CAAC8C,OAAD,CAAlB;AACA,SAAOhX,EAAP;AACH;AAEM,SAAS2W,0BAAT,CAAoCN,IAApC,EAAkD;AACrD,SAAOI,sBAAsB,CAACJ,IAAD,CAAtB,CAA6BjV,OAA7B,CAAqC,IAArC,EAA2C,EAA3C,CAAP;AACH;AAEM,SAAS6V,UAAT,GAAsE;AACzE,SAAO;AACHC,QAAI,EAAE,cAACC,CAAD;AAAA,aAA2BvF,IAAI,CAACE,SAAL,CAAeqF,CAAf,EAAkB,IAAlB,EAAwB,CAAxB,CAA3B;AAAA,KADH;AAEHC,KAAC,EAAElE,GAFA;AAGHmE,MAAE,EAAE,YAAAF,CAAC;AAAA,aAAItB,YAAY,CAACsB,CAAD,EAAI,KAAJ,CAAhB;AAAA,KAHF;AAIHG,OAAG,EAAE,aAAAH,CAAC;AAAA,aAAItB,YAAY,CAACsB,CAAD,EAAI,IAAJ,CAAhB;AAAA;AACN;AACR;AACA;;AAPW,GAAP;AASH,C","file":"dd3f190e874bb9fd3d15442acb13c1c213c37505-2e2106e477f053a7d898.js","sourcesContent":["// eslint-disable-next-line @typescript-eslint/triple-slash-reference\n/// <reference path=\"jdspec.d.ts\" />\n\nexport function isRegister(pkt: jdspec.PacketInfo): boolean {\n    return pkt && (pkt.kind == \"const\" || pkt.kind == \"ro\" || pkt.kind == \"rw\")\n}\n\nexport function packetsToRegisters(packets: jdspec.PacketInfo[]) {\n    return packets.filter(pkt => !pkt.derived && isRegister(pkt))\n}\nexport function lookupRegister(\n    spec: jdspec.ServiceSpec,\n    id: string\n): jdspec.PacketInfo {\n    return spec.packets.find(pkt => isRegister(pkt) && pkt.name === id)\n}\n\nexport function lookupField(\n    pkt: jdspec.PacketInfo,\n    field: string\n): jdspec.PacketMember {\n    return pkt.fields.find(member => member.name === field)\n}\n\nexport interface RegField {\n    pkt: jdspec.PacketInfo\n    fld?: jdspec.PacketMember\n}\n\nexport function getRegister(spec: jdspec.ServiceSpec, w: string): RegField {\n    const ret: RegField = { pkt: null }\n    if (/^\\w+$/.test(w)) {\n        ret.pkt = lookupRegister(spec, w)\n        if (!ret.pkt) {\n            throw new Error(\n                `no register ${w} found in service ${spec.shortName}`\n            )\n        }\n    } else if (/^\\w+\\.\\w+$/.test(w)) {\n        const [reg, field] = /^(\\w+)\\.(\\w+)$/.exec(w)\n        ret.pkt = lookupRegister(spec, reg)\n        if (!ret.pkt) {\n            throw new Error(\n                `no register ${reg} found in service ${spec.shortName}`\n            )\n        } else {\n            ret.fld = lookupField(ret.pkt, field)\n            if (!ret.fld)\n                throw new Error(\n                    `no field ${field} found in register ${reg} of service ${spec.shortName}`\n                )\n        }\n    }\n    return ret\n}\n\nexport function parseIntFloat(\n    spec: jdspec.ServiceSpec,\n    w: string,\n    allowFloat = false\n): number {\n    if (/^-?0x[a-f\\d_]+$/i.test(w) || /^-?[\\d_]+$/.test(w)) {\n        const v = parseInt(w.replace(/_/g, \"\")) // allow for 0x3fff_ffff syntax\n        if (isNaN(v)) throw new Error(\"can't parse int: \" + w)\n        return v\n    }\n\n    if (allowFloat && /^-?\\d*(\\.\\d*)?(e(-?)\\d+)?$/.test(w)) {\n        const v = parseFloat(w)\n        if (isNaN(v)) throw new Error(\"can't parse float: \" + w)\n        return v\n    }\n\n    const ww = w.split(/\\./)\n    if (ww.length != 2) {\n        throw new Error(`expecting int or enum member here`)\n    }\n    const en = spec.enums[ww[0]]\n    if (!en) {\n        throw new Error(`${ww[0]} is not an enum type`)\n    }\n    // eslint-disable-next-line no-prototype-builtins\n    if (!en.members.hasOwnProperty(ww[1]))\n        throw new Error(`${ww[1]} is not a member of ${ww[0]}`)\n    return en.members[ww[1]] || 0\n}\n","// eslint-disable-next-line @typescript-eslint/triple-slash-reference\n/// <reference path=\"jdspec.d.ts\" />\nimport { parseIntFloat } from \"./jdutils\"\n\nexport const DEVICE_IMAGE_WIDTH = 600\nexport const DEVICE_IMAGE_HEIGHT = 450\n\n// modified subset of SenML\nexport const unitDescription: jdspec.SMap<string> = {\n    \"\": \"angle\",\n    \"/s\": \"rotation rate\",\n    \"/s2\": \"rotation acceleration\",\n    m: \"meter\",\n    kg: \"kilogram\",\n    s: \"second\",\n    A: \"ampere\",\n    K: \"kelvin\",\n    cd: \"candela\",\n    mol: \"mole\",\n    Hz: \"hertz\",\n    rad: \"radian\",\n    sr: \"steradian\",\n    N: \"newton\",\n    Pa: \"pascal\",\n    J: \"joule\",\n    W: \"watt\",\n    C: \"coulomb\",\n    V: \"volt\",\n    F: \"farad\",\n    Ohm: \"ohm\",\n    S: \"siemens\",\n    Wb: \"weber\",\n    T: \"tesla\",\n    H: \"henry\",\n    \"C\": \"degrees Celsius\",\n    lm: \"lumen\",\n    lx: \"lux\",\n    Bq: \"becquerel\",\n    Gy: \"gray\",\n    Sv: \"sievert\",\n    kat: \"katal\",\n    m2: \"square meter (area)\",\n    m3: \"cubic meter (volume)\",\n    \"m/s\": \"meter per second (velocity)\",\n    \"m/s2\": \"meter per square second (acceleration)\",\n    \"m3/s\": \"cubic meter per second (flow rate)\",\n    \"W/m2\": \"watt per square meter (irradiance)\",\n    \"cd/m2\": \"candela per square meter (luminance)\",\n    bit: \"bit (information content)\",\n    \"bit/s\": \"bit per second (data rate)\",\n    lat: \"degrees latitude\",\n    lon: \"degrees longitude\",\n    pH: \"pH value (acidity; logarithmic quantity)\",\n    dB: \"decibel (logarithmic quantity)\",\n    dBW: \"decibel relative to 1 W (power level)\",\n    count: \"1 (counter value)\",\n    \"/\": \"1 (ratio e.g., value of a switch)\",\n    \"%RH\": \"Percentage (Relative Humidity)\",\n    \"%EL\": \"Percentage (remaining battery energy level)\",\n    EL: \"seconds (remaining battery energy level)\",\n    \"1/s\": \"1 per second (event rate)\",\n    \"S/m\": \"Siemens per meter (conductivity)\",\n    B: \"Byte (information content)\",\n    VA: \"volt-ampere (Apparent Power)\",\n    VAs: \"volt-ampere second (Apparent Energy)\",\n    var: \"volt-ampere reactive (Reactive Power)\",\n    vars: \"volt-ampere-reactive second (Reactive Energy)\",\n    \"J/m\": \"joule per meter (Energy per distance)\",\n    \"kg/m3\": \"kilogram per cubic meter (mass density, mass concentration)\",\n    \"s/60\": \"servo speed (time to travel 60)\",\n    \"kg/cm\": \"torque\",\n    hsv: \"bit HSV color\",\n    rgb: \"RGB color\",\n    rpm: \"revolutions per minute\",\n    uv: \"UV index\",\n    lux: \"illuminance\",\n    bpm: \"beats per minute\",\n    mcd: \"micro candella\",\n    px: \"pixel\",\n}\n\nexport const secondaryUnitConverters: jdspec.SMap<{\n    name: string\n    unit: senml.Unit | \"#\"\n    scale: number\n    offset: number\n}> = {\n    ms: { name: \"millisecond\", unit: \"s\", scale: 1 / 1000, offset: 0 },\n    min: { name: \"minute\", unit: \"s\", scale: 60, offset: 0 },\n    h: { name: \"hour\", unit: \"s\", scale: 3600, offset: 0 },\n    MHz: { name: \"megahertz\", unit: \"Hz\", scale: 1000000, offset: 0 },\n    kW: { name: \"kilowatt\", unit: \"W\", scale: 1000, offset: 0 },\n    kVA: { name: \"kilovolt-ampere\", unit: \"VA\", scale: 1000, offset: 0 },\n    kvar: { name: \"kilovar\", unit: \"var\", scale: 1000, offset: 0 },\n    Ah: { name: \"ampere-hour\", unit: \"C\", scale: 3600, offset: 0 },\n    Wh: { name: \"watt-hour\", unit: \"J\", scale: 3600, offset: 0 },\n    kWh: { name: \"kilowatt-hour\", unit: \"J\", scale: 3600000, offset: 0 },\n    varh: { name: \"var-hour\", unit: \"vars\", scale: 3600, offset: 0 },\n    kvarh: { name: \"kilovar-hour\", unit: \"vars\", scale: 3600000, offset: 0 },\n    kVAh: {\n        name: \"kilovolt-ampere-hour\",\n        unit: \"VAs\",\n        scale: 3600000,\n        offset: 0,\n    },\n    \"Wh/km\": {\n        name: \"watt-hour per kilometer\",\n        unit: \"J/m\",\n        scale: 3.6,\n        offset: 0,\n    },\n    KiB: { name: \"kibibyte\", unit: \"B\", scale: 1024, offset: 0 },\n    GB: { name: \"gigabyte\", unit: \"B\", scale: 1.0e9, offset: 0 },\n    \"Mbit/s\": {\n        name: \"megabit per second\",\n        unit: \"bit/s\",\n        scale: 1000000,\n        offset: 0,\n    },\n    \"B/s\": { name: \"byte per second\", unit: \"bit/s\", scale: 8, offset: 0 },\n    \"MB/s\": {\n        name: \"megabyte per second\",\n        unit: \"bit/s\",\n        scale: 8000000,\n        offset: 0,\n    },\n    mV: { name: \"millivolt\", unit: \"V\", scale: 1 / 1000, offset: 0 },\n    mA: { name: \"milliampere\", unit: \"A\", scale: 1 / 1000, offset: 0 },\n    dBm: { name: \"decibel (milliwatt)\", unit: \"dBW\", scale: 1, offset: -30 },\n    \"ug/m3\": {\n        name: \"microgram per cubic meter\",\n        unit: \"kg/m3\",\n        scale: 1.0e-9,\n        offset: 0,\n    },\n    \"mm/h\": {\n        name: \"millimeter per hour\",\n        unit: \"m/s\",\n        scale: 1 / 3600000,\n        offset: 0,\n    },\n    \"m/h\": { name: \"meter per hour\", unit: \"m/s\", scale: 1 / 3600, offset: 0 },\n    ppm: { name: \"parts per million\", unit: \"/\", scale: 1.0e-6, offset: 0 },\n    ppb: { name: \"parts per billion\", unit: \"/\", scale: 1.0e-9, offset: 0 },\n    \"/100\": { name: \"percent\", unit: \"/\", scale: 1 / 100, offset: 0 },\n    \"%\": { name: \"percent\", unit: \"/\", scale: 1 / 100, offset: 0 },\n    \"/1000\": { name: \"permille\", unit: \"/\", scale: 1 / 1000, offset: 0 },\n    hPa: { name: \"hectopascal\", unit: \"Pa\", scale: 100, offset: 0 },\n    mm: { name: \"millimeter\", unit: \"m\", scale: 1 / 1000, offset: 0 },\n    cm: { name: \"centimeter\", unit: \"m\", scale: 1 / 100, offset: 0 },\n    km: { name: \"kilometer\", unit: \"m\", scale: 1000, offset: 0 },\n    \"km/h\": {\n        name: \"kilometer per hour\",\n        unit: \"m/s\",\n        scale: 1 / 3.6,\n        offset: 0,\n    },\n    \"8ms\": { name: \"8 milliseconds\", unit: \"s\", scale: 8 / 1000, offset: 0 },\n    nm: { name: \"nanometer\", unit: \"m\", scale: 1e-9, offset: 0 },\n    nT: { name: \"nano Tesla\", unit: \"T\", scale: 1e9, offset: 0 },\n\n    // compat with previous Jacdac versions\n    frac: { name: \"ratio\", unit: \"/\", scale: 1, offset: 0 },\n    us: { name: \"micro seconds\", unit: \"s\", scale: 1e-6, offset: 0 },\n    mWh: { name: \"micro watt-hour\", unit: \"J\", scale: 3.6e-3, offset: 0 },\n    g: { name: \"earth gravity\", unit: \"m/s2\", scale: 9.80665, offset: 0 },\n    \"#\": { name: \"count\", unit: \"#\", scale: 1, offset: 0 },\n}\n\nexport function resolveUnit(unit: string) {\n    if (unit === \"\") return { name: \"\", unit: \"\", scale: 1, offset: 1 } // indentifier\n\n    // seconary unit?\n    const su = secondaryUnitConverters[unit]\n    if (su) return su\n\n    const name = unitDescription[unit]\n    if (name) return { name, unit, scale: 1, offset: 0 }\n\n    return undefined\n}\n\nexport function units(): { name: string; description: string }[] {\n    const r: { name: string; description: string }[] = []\n    Object.keys(unitDescription).forEach(k => {\n        r.push({ name: k, description: unitDescription[k] })\n        Object.keys(secondaryUnitConverters)\n            .filter(scd => secondaryUnitConverters[scd].unit === k)\n            .forEach(scd =>\n                r.push({\n                    name: scd,\n                    description: secondaryUnitConverters[scd].name,\n                })\n            )\n    })\n    r.sort((l, r) => l.name.localeCompare(r.name))\n    return r\n}\n\n/* check ranges, see system.md\nRegisters `0x001-0x07f` - r/w common to all services\nRegisters `0x080-0x0ff` - r/w defined per-service\nRegisters `0x100-0x17f` - r/o common to all services\nRegisters `0x180-0x1ff` - r/o defined per-service\nRegisters `0x200-0xeff` - custom, defined per-service\nRegisters `0xf00-0xfff` - reserved for implementation, should not be seen on the wire\n*/\nconst identifierRanges: { [index: string]: [number, number][] } = {\n    rw: [\n        [0x001, 0x07f],\n        [0x080, 0x0ff],\n        [0x200, 0xeff], // custom\n        [0xf00, 0xfff], // impl\n    ],\n    ro: [\n        [0x100, 0x17f],\n        [0x180, 0x1ff],\n        [0x200, 0xeff], // custom\n        [0xf00, 0xfff], // impl\n    ],\n    const: [\n        [0x100, 0x17f],\n        [0x180, 0x1ff],\n        [0x200, 0xeff], // custom\n        [0xf00, 0xfff], // impl\n    ],\n    command: [\n        [0x000, 0x07f],\n        [0x080, 0xeff],\n        [0xf00, 0xfff],\n    ],\n    report: [\n        [0x000, 0x07f],\n        [0x080, 0xeff],\n        [0xf00, 0xfff],\n    ],\n    event: [\n        [0x00, 0x7f], // system\n        [0x80, 0xff],\n    ],\n}\n\nexport function parseServiceSpecificationMarkdownToJSON(\n    filecontent: string,\n    includes?: jdspec.SMap<jdspec.ServiceSpec>,\n    filename = \"\"\n): jdspec.ServiceSpec {\n    filecontent = (filecontent || \"\").replace(/\\r/g, \"\")\n    const info: jdspec.ServiceSpec = {\n        name: \"\",\n        status: \"experimental\",\n        shortId: filename.replace(/\\.md$/, \"\").replace(/.*\\//, \"\"),\n        camelName: \"\",\n        shortName: \"\",\n        extends: [],\n        notes: {},\n        classIdentifier: 0,\n        enums: {},\n        packets: [],\n        tags: [],\n    }\n\n    let backticksType = \"\"\n    let enumInfo: jdspec.EnumInfo = null\n    let packetInfo: jdspec.PacketInfo = null\n    let pipePacket: jdspec.PacketInfo = null\n    let errors: jdspec.Diagnostic[] = []\n    let lineNo = 0\n    let noteId = \"short\"\n    let lastCmd: jdspec.PacketInfo\n    let packetsToDescribe: jdspec.PacketInfo[]\n    let nextModifier: \"\" | \"segmented\" | \"multi-segmented\" | \"repeats\" = \"\"\n\n    const systemInfo = includes?.[\"_system\"]\n    const usedIds: jdspec.SMap<string> = {}\n    for (const prev of values(includes || {})) {\n        if (prev.classIdentifier) usedIds[prev.classIdentifier + \"\"] = prev.name\n    }\n\n    try {\n        if (includes[\"_system\"] && includes[\"_base\"]) processInclude(\"_base\")\n        for (const line of filecontent.split(/\\n/)) {\n            lineNo++\n            processLine(line)\n        }\n    } catch (e) {\n        error(\"exception: \" + e.message)\n    }\n\n    if (errors.length) info.errors = errors\n\n    for (const k of Object.keys(info.notes))\n        info.notes[k] = normalizeMD(info.notes[k])\n    for (const v of info.packets) v.description = normalizeMD(v.description)\n\n    if (!info.camelName)\n        info.camelName = camelize(\n            info.name\n                .replace(/\\s+/g, \" \")\n                .replace(/[ -](.)/g, (f, l) => l.toUpperCase())\n                .replace(/[^\\w]+/g, \"_\")\n        )\n    if (!info.shortName) info.shortName = info.camelName\n\n    if (info.camelName == \"system\") info.classIdentifier = 0x1fff_fff1\n    else if (info.camelName == \"base\") info.classIdentifier = 0x1fff_fff3\n    else if (info.camelName == \"sensor\") info.classIdentifier = 0x1fff_fff2\n\n    if (info.shortName != \"control\" && !info.classIdentifier)\n        error(\"identifier: not specified\")\n\n    info.packets.forEach(pkt => (pkt.packFormat = packFormat(info, pkt)))\n\n    return info\n\n    function processLine(line: string) {\n        if (backticksType) {\n            if (line.trim() == \"```\") {\n                backticksType = null\n                if (backticksType == \"default\") return\n            }\n        } else {\n            const m = /^```(.*)/.exec(line)\n            if (m) {\n                backticksType = m[1] || \"default\"\n                if (backticksType == \"default\") return\n            }\n        }\n\n        const interpret =\n            backticksType == \"default\" || line.slice(0, 4) == \"    \"\n\n        if (!interpret) {\n            const m = /^(#+)\\s*(.*)/.exec(line)\n            if (m) {\n                const [, hd, cont] = m\n                packetsToDescribe = null\n                const newNoteId = cont.trim().toLowerCase()\n                if (hd == \"#\" && !info.name) {\n                    info.name = cont.trim()\n                    line = \"\"\n                } else if (\n                    newNoteId == \"registers\" ||\n                    newNoteId == \"commands\" ||\n                    newNoteId == \"events\" ||\n                    newNoteId == \"examples\"\n                ) {\n                    noteId = newNoteId\n                    line = \"\"\n                } else {\n                    if (noteId == \"short\") noteId = \"long\"\n                    // keep line\n                }\n            }\n\n            if (packetsToDescribe) {\n                for (const iface of packetsToDescribe)\n                    iface.description += line + \"\\n\"\n            } else {\n                if (line || info.notes[noteId]) {\n                    if (!info.notes[noteId]) info.notes[noteId] = \"\"\n                    info.notes[noteId] += line + \"\\n\"\n                }\n            }\n        } else {\n            if (packetsToDescribe && packetsToDescribe[0].description)\n                packetsToDescribe = null\n            const expanded = line\n                .replace(/\\/\\/.*/, \"\")\n                .replace(/[?@:=,{};]/g, s => \" \" + s + \" \")\n                .trim()\n            if (!expanded) return\n            const words = expanded.split(/\\s+/)\n            if (/^[;,]/.test(words[words.length - 1])) words.pop()\n            let cmd = words[0]\n            // allow for `command = Foo.Bar` etc (ie. command is not a keyword there)\n            if (words[1] == \":\" || words[1] == \"=\") cmd = \":\"\n            switch (cmd) {\n                case \"enum\":\n                case \"flags\":\n                    startEnum(words)\n                    break\n                case \"meta\":\n                case \"pipe\":\n                case \"report\":\n                case \"command\":\n                case \"const\":\n                case \"ro\":\n                case \"rw\":\n                case \"event\":\n                    startPacket(words)\n                    break\n                case \"}\":\n                    if (packetInfo) {\n                        finishPacket()\n                    } else if (enumInfo) {\n                        enumInfo = null\n                    } else {\n                        error(\"nothing to end here\")\n                    }\n                    break\n                default:\n                    if (packetInfo) packetField(words)\n                    else if (enumInfo) enumMember(words)\n                    else metadataMember(words)\n            }\n        }\n    }\n\n    function finishPacket() {\n        packetInfo.packed = hasNaturalAlignment(packetInfo) ? undefined : true\n        if (packetInfo.packed)\n            warn(`you may want to use explicit padding in ${packetInfo.name}`)\n\n        let repeats = false\n        let hadzero = false\n        for (const p of packetInfo.fields) {\n            if (hadzero) {\n                error(\n                    `field ${p.name} in ${packetInfo.kind} ${packetInfo.name} follows a variable-sized field`\n                )\n                break\n            }\n            if (p.startRepeats) {\n                if (repeats)\n                    error(\n                        `repeats: can only be specified once; in ${packetInfo.kind} ${packetInfo.name}`\n                    )\n                repeats = true\n            }\n            if (p.storage == 0 && p.type != \"string0\") {\n                if (repeats) {\n                    error(\n                        `variable-sized field ${p.name} in ${packetInfo.kind} ${packetInfo.name} cannot repeat`\n                    )\n                    break\n                }\n                hadzero = true\n            }\n        }\n\n        const pid = packetInfo.identifier\n        const ranges = identifierRanges[packetInfo.kind]\n        if (\n            packetInfo.name != \"set_register\" &&\n            packetInfo.name != \"get_register\" &&\n            ranges &&\n            !ranges.some(range => range[0] <= pid && pid <= range[1])\n        )\n            error(\n                `${packetInfo.name} identifier 0x${pid.toString(\n                    16\n                )} out of range, expected in ${ranges\n                    .map(\n                        range =>\n                            `[${range\n                                .map(r => `0x${r.toString(16)}`)\n                                .join(\", \")}]`\n                    )\n                    .join(\", \")}`\n            )\n\n        packetInfo = null\n    }\n\n    function normalizeMD(md: string) {\n        return md.replace(/^\\s+/, \"\").replace(/\\s+$/, \"\")\n    }\n\n    function checkBraces(words: string[]) {\n        if (enumInfo || packetInfo) error(\"already in braces\")\n        if (words) {\n            if (words[2] != \"{\") error(`expecting: ${words[0]} NAME {`)\n        }\n\n        enumInfo = null\n        packetInfo = null\n    }\n\n    function forceSection(sectionId: string) {\n        if (noteId != sectionId) {\n            error(`this is only allowed in ## ${sectionId} not in ## ${noteId}`)\n        }\n    }\n\n    function startPacket(words: string[]) {\n        checkBraces(null)\n        const kindSt = words.shift()\n        let kind: jdspec.PacketKind = \"command\"\n        if (kindSt == \"meta\") {\n            forceSection(\"commands\")\n            let w2 = words.shift()\n            if (w2 == \"pipe\") w2 = words.shift()\n            if (w2 == \"report\" || w2 == \"command\")\n                kind = (\"meta_pipe_\" + w2) as any\n            else error(\"invalid token after meta\")\n        } else if (kindSt == \"pipe\") {\n            forceSection(\"commands\")\n            const w2 = words.shift()\n            if (w2 == \"report\" || w2 == \"command\") kind = (\"pipe_\" + w2) as any\n            else error(\"invalid token after pipe\")\n        } else {\n            kind = kindSt as any\n        }\n\n        let internal: boolean = undefined\n        if (words[0] === \"internal\") {\n            internal = true\n            words.shift()\n        }\n\n        let name = words.shift()\n        const isReport = kind == \"report\"\n        if (isReport && lastCmd && !/^\\w+$/.test(name)) {\n            words.unshift(name)\n            name = lastCmd.name\n        }\n        packetInfo = {\n            kind,\n            name: normalizeName(name),\n            identifier: undefined,\n            description: \"\",\n            fields: [],\n            internal,\n        }\n        if (isReport && lastCmd && name == lastCmd.name) {\n            packetInfo.secondary = true\n            lastCmd.hasReport = true\n        }\n        if (!packetsToDescribe) packetsToDescribe = []\n        packetsToDescribe.push(packetInfo)\n        if (words[0] == \"?\") {\n            words.shift()\n            packetInfo.optional = true\n        }\n\n        const prev = info.packets.filter(p => p.name == packetInfo.name)\n        if (prev.length == 0) {\n            // OK\n        } else if (\n            prev.length == 1 &&\n            prev[0].kind == \"command\" &&\n            packetInfo.kind == \"report\"\n        ) {\n            // OK\n        } else {\n            error(`packet redefinition ${prev.map(p => p.name).join(\", \")} `)\n        }\n\n        if (/pipe/.test(kind)) {\n            if (!pipePacket)\n                error(\n                    \"pipe definitions can only occur after the pipe-open packet\"\n                )\n            else packetInfo.pipeType = pipePacket.pipeType\n        }\n\n        const atat = words.indexOf(\"@\")\n        if (kind == \"pipe_command\" || kind == \"pipe_report\") {\n            // no identifier\n            packetInfo.identifier = 0\n        } else if (atat >= 0) {\n            const w = words[atat + 1]\n            let v = parseInt(w)\n            let isSet = true\n            if (isNaN(v)) {\n                v = 0\n                isSet = false\n                if (systemInfo) {\n                    const systemPacket = systemInfo.packets.find(\n                        p => p.name == w\n                    )\n                    if (systemPacket) {\n                        v = systemPacket.identifier\n                        packetInfo.identifierName = w\n                        if (systemPacket.kind != kind)\n                            error(\n                                `kind mismatch on ${w}: ${systemPacket.kind} vs ${kind}`\n                            )\n                        else isSet = true\n                    } else error(`${w} not found in _system`)\n                } else {\n                    error(`${w} cannot be resolved, since _system is missing`)\n                }\n            }\n\n            let isUser = false\n            let isSystem = false\n            let isHigh = 0x200 <= v && v <= 0xeff\n            switch (kind) {\n                case \"const\":\n                case \"ro\":\n                    forceSection(\"registers\")\n                    isSystem = 0x100 <= v && v <= 0x17f\n                    isUser = 0x180 <= v && v <= 0x1ff\n                    break\n                case \"rw\":\n                    forceSection(\"registers\")\n                    isSystem = 0x00 <= v && v <= 0x7f\n                    isUser = 0x80 <= v && v <= 0xff\n                    break\n                case \"report\":\n                case \"command\":\n                    forceSection(\"commands\")\n                    isSystem = 0x00 <= v && v <= 0x7f\n                    isUser = 0x80 <= v && v <= 0xff\n                    isHigh = 0x100 <= v && v <= 0xeff\n                    break\n                case \"event\":\n                    forceSection(\"events\")\n                    isSystem = 0x00 <= v && v <= 0x7f\n                    isUser = 0x80 <= v && v <= 0xff\n                    break\n            }\n\n            if (isUser) {\n                // ok\n            } else if (isSystem) {\n                if (!packetInfo.identifierName)\n                    warn(\n                        `${kind} @ ${toHex(\n                            v\n                        )} should be expressed with a name from _system.md`\n                    )\n            } else if (isHigh) {\n                if (!info.highCommands)\n                    warn(\n                        `${kind} @ ${toHex(\n                            v\n                        )} is from the extended range but 'high: 1' missing`\n                    )\n            }\n\n            packetInfo.identifier = v\n            words.splice(atat, 2)\n        } else {\n            if (isReport && lastCmd) packetInfo.identifier = lastCmd.identifier\n            else error(`@ not found at ${packetInfo.name}`)\n        }\n\n        if (\n            info.packets.some(\n                p =>\n                    p.kind == packetInfo.kind &&\n                    (!/pipe/.test(p.kind) ||\n                        p.pipeType == packetInfo.pipeType) &&\n                    p.identifier == packetInfo.identifier\n            )\n        ) {\n            error(\"packet identifier already used\")\n        }\n\n        info.packets.push(packetInfo)\n\n        if (kind == \"command\") lastCmd = packetInfo\n        else lastCmd = null\n\n        if (words[0] == \"=\" || words[0] == \":\") {\n            words.unshift(\"_\")\n            packetField(words)\n            finishPacket()\n        } else {\n            const last = words.shift()\n            if (last == \"{\") {\n                if (words[0] == \"...\") words.shift()\n                if (words[0] == \"}\") {\n                    words.shift()\n                    finishPacket()\n                }\n                if (words.length) error(`excessive tokens: ${words[0]}...`)\n            } else {\n                if (last === undefined && kind == \"event\") {\n                    finishPacket()\n                } else {\n                    error(\"expecting '{'\")\n                }\n            }\n        }\n    }\n\n    function rangeCheck(tp: string, v: number) {\n        const [storage, type, typeShift] = normalizeStorageType(tp)\n\n        if (isNaN(v)) return v // error already reported\n\n        if (storage == 0) {\n            error(`numeric values like ${v} not allowed for ${tp}`)\n            return v\n        }\n\n        if (v < 0 && storage > 0) {\n            error(`negative values like ${v} not allowed for ${tp}`)\n            return v\n        }\n\n        if (Math.floor(v) != v && typeShift == 0) {\n            error(`only integer values allowed for ${tp}; got ${v}`)\n            return v\n        }\n\n        let bits = storage < 0 ? -storage * 8 - 1 : storage * 8\n        bits -= typeShift || 0\n        // don't use bitshift to allow for more than 32 bits\n        let max = 1\n        while (bits--) max *= 2\n        if (-v == max) {\n            // OK - min_int\n        } else if (max == 1 && v == 1) {\n            // we make an exception for u0.8 being set to 1\n        } else {\n            if (Math.abs(v) >= max) {\n                error(`value ${v} is out of range for ${tp}`)\n                return v\n            }\n        }\n\n        return v\n    }\n\n    function parseVal(words: string[]) {\n        const eq = words.shift()\n        if (eq != \"=\" && eq != \":\") error(\"expecting '='\")\n        const val = words.shift()\n        return parseIntCheck(val, true)\n    }\n\n    function packetField(words: string[]) {\n        if (\n            words.length == 2 &&\n            (words[0] == \"repeats\" ||\n                words[0] == \"segmented\" ||\n                words[0] == \"multi-segmented\")\n        ) {\n            nextModifier = words[0]\n            return\n        }\n        const name = normalizeName(words.shift())\n        let defaultValue: number = undefined\n        let isOptional: boolean = undefined\n        let op = words.shift()\n        if (op == \"?\") {\n            isOptional = true\n            op = words.shift()\n        }\n        if (op == \"=\") {\n            defaultValue = parseIntCheck(words.shift(), true)\n            op = words.shift()\n        }\n\n        if (op != \":\") error(\"expecting ':'\")\n\n        const tp = words.shift()\n        const [storage, type, typeShift] = normalizeStorageType(tp)\n        const isFloat = typeShift === null || undefined\n\n        let tok = words.shift()\n        let unit: jdspec.Unit = \"\"\n        if (tok != \"{\") {\n            unit = normalizeUnit(tok)\n            tok = words.shift()\n        }\n\n        if (defaultValue !== undefined) rangeCheck(tp, defaultValue)\n\n        let shift = typeShift || undefined\n        if (unit == \"/\") {\n            // / units should be used with ui0. data\n            if (!/^(u0|i1)\\.\\d+$/.test(tp))\n                error(\n                    `fraction unit must be used with u0.yyy or i1.yyy data types (got ${tp})`\n                )\n\n            shift = Math.abs(storage) * 8\n            if (storage < 0) shift -= 1\n        }\n\n        const field: jdspec.PacketMember = {\n            name,\n            unit,\n            shift,\n            isFloat,\n            type,\n            storage,\n            isSimpleType: canonicalType(storage) == type || undefined,\n            defaultValue,\n            isOptional,\n            multiSegmented: nextModifier == \"multi-segmented\" || undefined,\n            segmented:\n                nextModifier == \"segmented\" ||\n                nextModifier == \"multi-segmented\" ||\n                undefined,\n            startRepeats: nextModifier == \"repeats\" || undefined,\n        }\n\n        if (tok == \"{\") {\n            while (words.length) {\n                tok = words.shift()\n                if (tok == \"}\") break\n                tok = camelize(tok)\n                switch (tok) {\n                    case \"maxBytes\":\n                        ;(field as any)[tok] = rangeCheck(\"u8\", parseVal(words))\n                        break\n                    case \"typicalMin\":\n                    case \"typicalMax\":\n                    case \"absoluteMin\":\n                    case \"absoluteMax\":\n                        ;(field as any)[tok] = rangeCheck(tp, parseVal(words))\n                        break\n                    case \"preferredInterval\":\n                        if ((packetInfo as any)[tok] !== undefined)\n                            error(`field ${tok} already set`)\n                        ;(packetInfo as any)[tok] = rangeCheck(\n                            \"u32\",\n                            parseVal(words)\n                        )\n                        break\n                    default:\n                        error(\"unknown constraint: \" + tok)\n                        break\n                }\n                if (words[0] == \",\") words.shift()\n            }\n            if (tok == \"}\") tok = null\n        }\n\n        if (tok) error(`excessive tokens at the end of member: ${tok}...`)\n\n        if (\n            field.typicalMin === undefined &&\n            field.typicalMax !== undefined &&\n            storage > 0\n        )\n            field.typicalMin = 0\n\n        if (\n            field.absoluteMin === undefined &&\n            field.absoluteMax !== undefined &&\n            storage > 0\n        )\n            field.absoluteMin = 0\n\n        if (!field.storage && field.maxBytes) field.storage = field.maxBytes\n\n        if (/pipe/.test(type)) {\n            packetInfo.pipeType = packetInfo.name\n            if (\n                pipePacket &&\n                pipePacket.name == packetInfo.name &&\n                packetInfo.kind == \"report\"\n            ) {\n                // keep old pipePacket\n            } else {\n                pipePacket = packetInfo\n            }\n        }\n\n        if (\n            !field.isOptional &&\n            packetInfo.fields[packetInfo.fields.length - 1]?.isOptional\n        ) {\n            error(`all fields after an optional field have to optional`)\n        }\n\n        packetInfo.fields.push(field)\n        nextModifier = undefined\n    }\n\n    function startEnum(words: string[]) {\n        checkBraces(null)\n        if (words[2] != \":\" || words[4] != \"{\")\n            error(\"expecting: enum NAME : TYPE {\")\n        enumInfo = {\n            name: normalizeName(words[1]),\n            storage: normalizeStorageType(words[3])[0],\n            isFlags: words[0] == \"flags\" || undefined,\n            members: {},\n        }\n        if (info.enums[enumInfo.name]) error(\"enum redefinition\")\n        info.enums[enumInfo.name] = enumInfo\n    }\n\n    function enumMember(words: string[]) {\n        if (words[1] != \"=\" || words.length != 3)\n            error(`expecting: FIELD_NAME = INTEGER`)\n        enumInfo.members[normalizeName(words[0])] = rangeCheck(\n            canonicalType(enumInfo.storage),\n            parseIntCheck(words[2])\n        )\n    }\n\n    function parseIntCheck(w: string, allowFloat = false) {\n        try {\n            return parseIntFloat(info, w, allowFloat)\n        } catch (e) {\n            error(e.message)\n            return 0\n        }\n    }\n\n    function looksRandom(n: number) {\n        const s = n.toString(16)\n        const h = \"0123456789abcdef\"\n        for (let i = 0; i < h.length; ++i) {\n            const hh = h[i]\n            if (s.indexOf(hh + hh + hh) >= 0) return false\n        }\n        if (/f00d|dead|deaf|beef/.test(s)) return false\n        return true\n    }\n\n    function genRandom() {\n        for (;;) {\n            const m = (Math.random() * 0xfff_ffff) | 0x1000_0000\n            if (looksRandom(m)) return m\n        }\n    }\n\n    function metadataMember(words: string[]) {\n        if (\n            !(\n                (words[1] == \"=\" || words[1] == \":\") &&\n                (words[0] == \"tags\" || words.length == 3)\n            )\n        )\n            error(`expecting: FIELD_NAME = VALUE or FIELD_NAME : VALUE`)\n        switch (words[0]) {\n            case \"extends\":\n                processInclude(words[2])\n                break\n            case \"class\":\n            case \"identifier\": {\n                info.classIdentifier = parseIntCheck(words[2])\n                if (info.name != \"Control\" && info.classIdentifier == 0)\n                    info.classIdentifier = 1\n                const gen = `how about ${toHex(genRandom())}`\n                if (\n                    !(\n                        info.classIdentifier == 0 ||\n                        (0x1000_0001 <= info.classIdentifier &&\n                            info.classIdentifier <= 0x1fff_ff00)\n                    )\n                )\n                    error(`class identifier out of range; ${gen}`)\n                if (!looksRandom(info.classIdentifier))\n                    error(`class identifier doesn't look random; ${gen}`)\n                if (usedIds[info.classIdentifier + \"\"])\n                    error(\n                        `class identifier ${toHex(\n                            info.classIdentifier\n                        )} already used in ${\n                            usedIds[info.classIdentifier + \"\"]\n                        }; ${gen}`\n                    )\n                break\n            }\n            case \"camel\":\n                info.camelName = words[2]\n                break\n            case \"short\":\n                info.shortName = words[2]\n                break\n            case \"high\":\n                info.highCommands = !!parseIntCheck(words[2])\n                break\n            case \"status\":\n                if (\n                    [\"stable\", \"experimental\", \"deprecated\"].indexOf(words[2]) >\n                    -1\n                )\n                    info.status = <any>words[2]\n                else error(\"unknown status\")\n                break\n            case \"group\":\n                info.group = capitalize(words.slice(2).join(\" \"));\n                break;\n            case \"tags\": {\n                const tags = words.slice(2).filter(w => w != \",\" && w != \";\")\n                info.tags = info.tags.concat(tags)\n                break\n            }\n            default:\n                error(\"unknown metadata field: \" + words[0])\n                break\n        }\n    }\n\n    function processInclude(name: string) {\n        if (name == \"_system\") return\n        const inner = includes[name]\n        if (!inner) return error(\"include file not found: \" + name)\n        if (\n            info.packets.some(pkt => !pkt.derived) ||\n            values(info.enums).some(e => !e.derived)\n        )\n            error(\"extends: only allowed on top of the .md file\")\n        if (inner.errors) errors = errors.concat(inner.errors)\n        const innerEnums = clone(inner.enums)\n        Object.keys(innerEnums)\n            .filter(k => !info.enums[k])\n            .forEach(k => {\n                const ie = innerEnums[k]\n                ie.derived = name\n                info.enums[k] = ie\n            })\n        const innerPackets = clone(\n            inner.packets.filter(\n                pkt =>\n                    !info.packets.find(\n                        ipkt =>\n                            ipkt.kind === pkt.kind &&\n                            ipkt.identifier === pkt.identifier\n                    )\n            )\n        )\n        innerPackets.forEach(pkt => (pkt.derived = name))\n        info.packets = [...info.packets, ...innerPackets]\n        if (inner.highCommands) info.highCommands = true\n        info.extends = inner.extends.concat([name])\n    }\n\n    function clone<T>(v: T): T {\n        return JSON.parse(JSON.stringify(v))\n    }\n\n    function error(msg: string) {\n        if (!msg) msg = \"syntax error\"\n        if (errors.some(e => e.line == lineNo && e.message == msg)) return\n        errors.push({ file: filename, line: lineNo, message: msg })\n    }\n\n    function warn(msg: string) {\n        if (info.camelName == \"system\") return // no warnings in _system\n        if (errors.some(e => e.line == lineNo && e.message == msg)) return\n        errors.push({ file: filename, line: lineNo, message: msg })\n    }\n\n    function normalizeName(n: string) {\n        if (!/^\\w+$/.test(n)) error(\"expecting name here\")\n        if (n.length > 31) error(`name '${n}' too long`)\n        return n\n    }\n\n    function normalizeStorageType(\n        tp: string\n    ): [jdspec.StorageType, string, number] {\n        if (info.enums[tp]) return [info.enums[tp].storage, tp, 0]\n        if (!tp) error(\"expecting type here\")\n        const tp2 = tp.replace(/_t$/, \"\").toLowerCase()\n        const m = /^([ui])(\\d+)\\.(\\d+)$/.exec(tp2)\n        if (m) {\n            const a = parseIntCheck(m[2])\n            const b = parseIntCheck(m[3])\n            const len = a + b\n            if (!(len == 8 || len == 16 || len == 32 || len == 64))\n                error(`fixed point ${tp} can't be ${len} bits`)\n            if (a == 0 && m[1] == \"i\")\n                error(\n                    `fixed point ${tp} can't be i0.X; has to be at least i1.X`\n                )\n            return [(m[1] == \"i\" ? -1 : 1) * (len >> 3), tp2, b]\n        }\n\n        switch (tp2) {\n            case \"bool\":\n                return [1, tp2, 0]\n            case \"i8\":\n            case \"u8\":\n            case \"i16\":\n            case \"u16\":\n            case \"i32\":\n            case \"u32\":\n            case \"i64\":\n            case \"u64\": {\n                let sz = parseIntCheck(tp2.replace(/^./, \"\")) >> 3\n                if (tp2[0] == \"i\") sz = -sz\n                return [sz, tp2, 0]\n            }\n            case \"f16\":\n                return [2, tp2, null]\n            case \"f32\":\n                return [4, tp2, null]\n            case \"f64\":\n                return [8, tp2, null]\n            case \"pipe\":\n                return [12, tp2, 0]\n            case \"pipe_port\":\n                return [2, tp2, 0]\n            case \"devid\":\n                return [8, tp2, 0]\n            case \"bytes\":\n            case \"string\":\n            case \"string0\":\n                return [0, tp2, 0]\n            default: {\n                const m = /^u8\\[(\\d+)\\]$/.exec(tp2)\n                if (m) return [parseIntCheck(m[1]), tp2, 0]\n                error(\"unknown type: \" + tp + \" \" + tp2)\n                return [4, tp2, 0]\n            }\n        }\n    }\n\n    function normalizeUnit(unit: string): jdspec.Unit {\n        if (unit === undefined || unit === null) return \"\"\n\n        if (unitDescription[unit] || secondaryUnitConverters[unit])\n            return unit as jdspec.Unit\n        error(`expecting unit, got '${unit}'`)\n        return \"\"\n    }\n\n    function hasNaturalAlignment(iface: jdspec.PacketInfo) {\n        let byteOffset = 0\n\n        for (const m of iface.fields) {\n            const sz = memberSize(m)\n            if (sz == 0) continue\n            const pad = sz > 4 ? 4 : sz\n            if (!/^u8\\[/.test(m.type) && byteOffset % pad != 0) return false\n            byteOffset += sz\n        }\n\n        return true\n    }\n}\n\nfunction values<T>(o: jdspec.SMap<T>): T[] {\n    const r: T[] = []\n    for (const k of Object.keys(o)) r.push(o[k])\n    return r\n}\n\nfunction fail(msg: string) {\n    throw new Error(msg)\n}\n\nfunction toUpper(name: string) {\n    return name\n        ?.replace(/([a-z])([A-Z])/g, (x, a, b) => a + \"_\" + b)\n        .toUpperCase()\n}\n\nfunction toLower(name: string) {\n    return name\n        ?.replace(/([a-z])([A-Z])/g, (x, a, b) => a + \"_\" + b)\n        .toLowerCase()\n}\n\nfunction packed(iface: jdspec.PacketInfo) {\n    if (!iface.packed) return \"\"\n    else return \" __attribute__((packed))\"\n}\n\nfunction cStorage(tp: jdspec.StorageType) {\n    if (tp == 0 || [1, 2, 4, 8].indexOf(Math.abs(tp)) < 0) return \"bytes\"\n    if (tp < 0) return `int${-tp * 8}_t`\n    else return `uint${tp * 8}_t`\n}\n\nfunction canonicalType(tp: jdspec.StorageType): string {\n    if (tp == 0) return \"bytes\"\n    if (tp < 0) return `i${-tp * 8}`\n    else return `u${tp * 8}`\n}\n\nfunction isRegister(k: jdspec.PacketKind) {\n    return k == \"ro\" || k == \"rw\" || k == \"const\"\n}\n\nfunction toHex(n: number): string {\n    if (n === undefined) return \"\"\n    if (n < 0) return \"-\" + toHex(n)\n    return \"0x\" + n.toString(16)\n}\n\nfunction unitPref(f: jdspec.PacketMember) {\n    if (!f.unit) return \"\"\n    else return prettyUnit(f.unit) + \" \"\n}\n\nfunction prettyUnit(u: jdspec.Unit): string {\n    switch (u) {\n        case \"us\":\n            return \"s\"\n        case \"C\":\n            return \"C\"\n        case \"/\":\n            return \"ratio\"\n        default:\n            return u\n    }\n}\n\nfunction toH(info: jdspec.ServiceSpec) {\n    let r = \"// Autogenerated C header file for \" + info.name + \"\\n\"\n    const hdDef = `_JACDAC_SPEC_${toUpper(info.camelName)}_H`\n    r += `#ifndef ${hdDef}\\n`\n    r += `#define ${hdDef} 1\\n`\n\n    let pref = \"JD_\" + toUpper(info.shortName) + \"_\"\n\n    if (info.shortId[0] == \"_\") pref = \"JD_\"\n\n    if (info.shortId[0] != \"_\")\n        r += `\\n#define JD_SERVICE_CLASS_${toUpper(info.shortName)}  ${toHex(\n            info.classIdentifier\n        )}\\n`\n\n    for (const en of values(info.enums).filter(en => !en.derived)) {\n        const enPref = pref + toUpper(en.name)\n        r += `\\n// enum ${en.name} (${cStorage(en.storage)})\\n`\n        for (const k of Object.keys(en.members))\n            r +=\n                \"#define \" +\n                enPref +\n                \"_\" +\n                toUpper(k) +\n                \" \" +\n                toHex(en.members[k]) +\n                \"\\n\"\n    }\n    for (const pkt of info.packets) {\n        if (pkt.derived) continue\n\n        const cmt = addComment(pkt)\n        r += wrapComment(cmt.comment)\n\n        if (\n            !pkt.secondary &&\n            pkt.kind != \"pipe_command\" &&\n            pkt.kind != \"pipe_report\"\n        ) {\n            let inner = \"CMD\"\n            if (isRegister(pkt.kind)) inner = \"REG\"\n            else if (pkt.kind == \"event\") inner = \"EV\"\n            else if (\n                pkt.kind == \"meta_pipe_command\" ||\n                pkt.kind == \"meta_pipe_report\"\n            )\n                inner = \"PIPE\"\n            let val = toHex(pkt.identifier)\n            if (pkt.identifierName)\n                val = \"JD_\" + inner + \"_\" + toUpper(pkt.identifierName)\n            const name = pref + inner + \"_\" + toUpper(pkt.name)\n            if (name != val) r += `#define ${name} ${val}\\n`\n        }\n\n        const isMetaPipe =\n            pkt.kind == \"meta_pipe_report\" || pkt.kind == \"meta_pipe_command\"\n\n        if (cmt.needsStruct || isMetaPipe) {\n            let tname =\n                \"jd_\" + toLower(info.camelName) + \"_\" + toLower(pkt.name)\n            if (pkt.kind == \"report\") tname += \"_report\"\n            r += `typedef struct ${tname} {\\n`\n            if (isMetaPipe) {\n                r += `    uint32_t identifier; // ${toHex(pkt.identifier)}\\n`\n            }\n            let unaligned = \"\"\n            for (let i = 0; i < pkt.fields.length; ++i) {\n                const f = pkt.fields[i]\n                let def = \"\"\n                const cst = cStorage(f.storage)\n                const sz = memberSize(f)\n                if (f.type == \"string\" || f.type == \"string0\")\n                    def = `char ${f.name}[${sz}]`\n                else if (cst == \"bytes\") def = `uint8_t ${f.name}[${sz}]`\n                else def = `${cst} ${f.name}`\n                // if it's the last field and it start repeats, treat it as an array\n                if (f.startRepeats && i == pkt.fields.length - 1) def += \"[0]\"\n                def += \";\"\n                if (!f.isSimpleType && f.type != \"devid\")\n                    def += \"  // \" + unitPref(f) + f.type\n                else if (f.unit) def += \" // \" + prettyUnit(f.unit)\n                r += \"    \" + unaligned + def + \"\\n\"\n                if (f.type == \"string0\") unaligned = \"// \"\n            }\n            r += `}${packed(pkt)} ${tname}_t;\\n\\n`\n        }\n    }\n    r += \"\\n#endif\\n\"\n    return r\n}\n\nexport function camelize(name: string) {\n    if (!name) return name\n    return (\n        name[0].toLowerCase() +\n        name.slice(1).replace(/_([a-z0-9])/gi, (_, l) => l.toUpperCase())\n    )\n}\n\nexport function capitalize(name: string) {\n    if (!name) return name\n    return name[0].toUpperCase() + name.slice(1)\n}\n\nfunction upperCamel(name: string) {\n    name = camelize(name)\n    if (!name?.length) return name\n    return name[0].toUpperCase() + name.slice(1)\n}\n\nexport function snakify(name: string) {\n    return name?.replace(/([a-z])([A-Z])/g, (_, a, b) => a + \"_\" + b)\n}\n\nexport function dashify(name: string) {\n    if (!name) return name\n    return snakify(name.replace(/^_+/, \"\")).replace(/_/g, \"-\").toLowerCase()\n}\n\nexport function humanify(name: string) {\n    return name\n        ?.replace(/([a-z])([A-Z])/g, (_, a, b) => a + \" \" + b)\n        .replace(/(-|_)/g, \" \")\n}\n\nfunction addComment(pkt: jdspec.PacketInfo) {\n    let comment = \"\"\n\n    let typeInfo = \"\"\n    let needsStruct = false\n    if (pkt.fields.length == 0) {\n        if (pkt.kind != \"event\") typeInfo = \"No args\"\n    } else if (pkt.fields.length == 1 && !pkt.fields[0].startRepeats) {\n        const f0 = pkt.fields[0]\n        typeInfo = cStorage(f0.storage)\n        if (!f0.isSimpleType) typeInfo = f0.type + \" (\" + typeInfo + \")\"\n        typeInfo = unitPref(f0) + typeInfo\n        if (f0.name != \"_\") typeInfo = f0.name + \" \" + typeInfo\n    } else {\n        needsStruct = true\n    }\n\n    if (pkt.fields.length == 1) {\n        if (isRegister(pkt.kind)) {\n            let info = \"\"\n            if (pkt.kind == \"ro\") info = \"Read-only\"\n            else if (pkt.kind == \"const\") info = \"Constant\"\n            else info = \"Read-write\"\n            if (typeInfo) typeInfo = info + \" \" + typeInfo\n            else typeInfo = info\n        } else if (typeInfo) {\n            typeInfo = \"Argument: \" + typeInfo\n        }\n    }\n\n    if (pkt.kind == \"report\" && pkt.secondary) {\n        comment += \"Report: \" + typeInfo + \"\\n\"\n    } else {\n        if (pkt.description) {\n            let desc = pkt.description.replace(/\\n\\n[^]*/, \"\")\n            if (typeInfo) desc = typeInfo + \". \" + desc\n            comment = desc + \"\\n\" + comment\n        }\n    }\n\n    return {\n        comment,\n        needsStruct,\n    }\n}\n\nfunction wrapComment(comment: string) {\n    return (\n        \"\\n/**\\n * \" +\n        comment.replace(/\\n+$/, \"\").replace(/\\n/g, \"\\n * \") +\n        \"\\n */\\n\"\n    )\n}\n\nfunction wrapSnippet(code: string) {\n    if (!code) return code\n    return `\n\\`\\`\\`\n${code.replace(/^\\n+/, \"\").replace(/\\n+$/, \"\")}\n\\`\\`\\`\n`\n}\n\nexport const TYPESCRIPT_STATIC_NAMESPACE = \"jacdac\"\nfunction packFormatForField(\n    info: jdspec.ServiceSpec,\n    fld: jdspec.PacketMember,\n    isStatic?: boolean,\n    useBooleans?: boolean\n) {\n    const sz = memberSize(fld)\n    const szSuff = sz ? `[${sz}]` : ``\n    let tsType = \"number\"\n    let fmt = \"\"\n    if (/^[fiu]\\d+(\\.\\d+)?$/.test(fld.type) && 1 <= sz && sz <= 8) {\n        fmt = fld.type\n    } else if (/^u8\\[\\d*\\]$/.exec(fld.type)) {\n        fmt = \"b\" + szSuff\n    } else if (info.enums[fld.type]) {\n        fmt = canonicalType(info.enums[fld.type].storage)\n        tsType = upperCamel(info.camelName) + upperCamel(fld.type)\n        if (isStatic) tsType = TYPESCRIPT_STATIC_NAMESPACE + \".\" + tsType\n    } else {\n        switch (fld.type) {\n            case \"string\":\n                fmt = \"s\" + szSuff\n                tsType = \"string\"\n                break\n            case \"bytes\":\n                fmt = \"b\" + szSuff\n                break\n            case \"string0\":\n                fmt = \"z\"\n                tsType = \"string\"\n                break\n            case \"devid\":\n                fmt = \"b[8]\"\n                break\n            case \"pipe_port\":\n                fmt = \"u16\"\n                break\n            case \"pipe\":\n                fmt = \"b[12]\"\n                break\n            case \"bool\":\n                // TODO native bool support\n                fmt = \"u8\"\n                if (useBooleans) tsType = \"boolean\"\n                break\n            default:\n                return null\n        }\n    }\n\n    if (tsType == \"number\" && fmt && fmt[0] == \"b\") tsType = \"Buffer\"\n    return { fmt, tsType }\n}\n\n/**\n * Generates the format to pack/unpack a data payload for this packet\n * @param pkt\n * TODO fix this\n */\nexport function packFormat(\n    sinfo: jdspec.ServiceSpec,\n    pkt: jdspec.PacketInfo,\n    useBooleans?: boolean\n): string {\n    if (pkt.packed || !pkt.fields?.length) return undefined\n\n    const fmt: string[] = []\n    for (const fld of pkt.fields) {\n        if (fld.startRepeats) fmt.push(\"r:\")\n        const ff = packFormatForField(sinfo, fld, false, useBooleans)\n        if (!ff) return undefined\n        fmt.push(ff.fmt)\n    }\n\n    return fmt.join(\" \")\n}\n\nexport function packInfo(\n    info: jdspec.ServiceSpec,\n    pkt: jdspec.PacketInfo,\n    isStatic: boolean,\n    useBooleans?: boolean\n) {\n    const vars: string[] = []\n    const vartp: string[] = []\n    let fmt = \"\"\n    let repeats: string[]\n    let reptp: string[]\n\n    for (let i = 0; i < pkt.fields.length; ++i) {\n        const fld = pkt.fields[i]\n        let isArray = \"\"\n        if (fld.startRepeats) {\n            if (i == pkt.fields.length - 1) {\n                isArray = \"[]\"\n            } else {\n                fmt += \"r: \"\n                repeats = []\n                reptp = []\n                vars.push(\"rest\")\n            }\n        }\n        const varname = camelize(fld.name == \"_\" ? pkt.name : fld.name)\n        const f0 = packFormatForField(info, fld, isStatic, useBooleans)\n        if (!f0 || /(reserved|padding)/.test(fld.name)) {\n            if (!f0)\n                console.log(\n                    `${pkt.name}/${fld.name} - can't get format for '${fld.type}'`\n                )\n            fmt += `x[${memberSize(fld)}] `\n        } else {\n            fmt += f0.fmt + isArray + \" \"\n            let tp = f0.tsType\n            if (tp == \"Buffer\" && !isStatic) tp = \"Uint8Array\"\n            tp += isArray\n            if (repeats) {\n                repeats.push(varname)\n                reptp.push(tp)\n            } else {\n                vars.push(varname)\n                vartp.push(tp)\n            }\n        }\n    }\n\n    fmt = fmt.replace(/ *$/, \"\")\n\n    if (reptp) vartp.push(\"([\" + reptp.join(\", \") + \"])[]\")\n\n    let buffers = \"\"\n    buffers += `const [${vars.join(\", \")}] = jdunpack<[${vartp.join(\n        \", \"\n    )}]>(buf, \"${fmt}\")\\n`\n    if (repeats) buffers += `const [${repeats.join(\", \")}] = rest[0]\\n`\n\n    buffers = buffers.replace(/\\n*$/, \"\")\n\n    return {\n        buffers,\n        names: vars,\n        types: vartp,\n    }\n}\n\nfunction memberSize(fld: jdspec.PacketMember) {\n    return Math.abs(fld.storage)\n}\n\nfunction toTypescript(info: jdspec.ServiceSpec, staticTypeScript: boolean) {\n    const indent = staticTypeScript ? \"    \" : \"\"\n    const indent2 = indent + \"    \"\n    const enumkw = staticTypeScript\n        ? indent + \"export const enum\"\n        : \"export enum\"\n    let r = staticTypeScript ? `namespace ${TYPESCRIPT_STATIC_NAMESPACE} {\\n` : \"\"\n    r += indent + \"// Service: \" + info.name + \"\\n\"\n    if (info.shortId[0] != \"_\") {\n        r +=\n            indent +\n            `export const SRV_${snakify(\n                info.camelName\n            ).toLocaleUpperCase()} = ${toHex(info.classIdentifier)}\\n`\n    }\n    const pref = upperCamel(info.camelName)\n    for (const en of values(info.enums)) {\n        const enPref = pref + upperCamel(en.name)\n        r += `\\n${enumkw} ${enPref} { // ${cStorage(en.storage)}\\n`\n        for (const k of Object.keys(en.members))\n            r += indent2 + k + \" = \" + toHex(en.members[k]) + \",\\n\"\n        r += indent + \"}\\n\\n\"\n    }\n    const tsEnums: jdspec.SMap<string> = {}\n\n    for (const pkt of info.packets) {\n        if (pkt.derived) continue\n\n        const cmt = addComment(pkt)\n        const pack = pkt.fields.length\n            ? packInfo(info, pkt, staticTypeScript).buffers\n            : \"\"\n\n        let inner = \"Cmd\"\n        if (isRegister(pkt.kind)) inner = \"Reg\"\n        else if (pkt.kind == \"event\") inner = \"Event\"\n        else if (\n            pkt.kind == \"meta_pipe_command\" ||\n            pkt.kind == \"meta_pipe_report\"\n        )\n            inner = \"PipeCmd\"\n        else if (pkt.kind == \"pipe_command\" || pkt.kind == \"pipe_report\")\n            inner = \"info\"\n\n        let text = \"\"\n        let meta = \"\"\n        if (pkt.secondary || inner == \"info\") {\n            if (pack)\n                text = wrapComment(\n                    `${pkt.kind} ${upperCamel(pkt.name)}${wrapSnippet(pack)}`\n                )\n        } else {\n            const val = toHex(pkt.identifier)\n            if (staticTypeScript && pkt.kind === \"event\") {\n                meta = `//% block=\"${snakify(pkt.name).replace(/_/g, \" \")}\"\\n`\n            }\n            text = `${\n                wrapComment(cmt.comment + wrapSnippet(pack)) + meta\n            }${upperCamel(pkt.name)} = ${val},\\n`\n        }\n\n        if (text) tsEnums[inner] = (tsEnums[inner] || \"\") + text\n\n        // don't line const strings in makecode,\n        // they don't get dropped efficiently\n    }\n\n    for (const k of Object.keys(tsEnums)) {\n        if (k == \"info\") r += tsEnums[k].replace(/^/gm, indent) + \"\\n\\n\"\n        else {\n            const inner = tsEnums[k]\n                .replace(/^\\n+/, \"\")\n                .replace(/\\n$/, \"\")\n                .replace(/\\n/g, \"\\n    \" + indent)\n            r += `${enumkw} ${pref}${k} {\\n    ${indent}${inner}\\n${indent}}\\n\\n`\n        }\n    }\n\n    if (staticTypeScript) r += \"}\\n\"\n\n    return r.replace(/ *$/gm, \"\")\n}\n\nexport function normalizeDeviceSpecification(dev: jdspec.DeviceSpec) {\n    // reorder fields\n    const clone: jdspec.DeviceSpec = {\n        id: (dev.id =\n            escapeDeviceIdentifier(dev.company) +\n            \"-\" +\n            escapeDeviceNameIdentifier(dev.name)),\n        name: dev.name,\n        company: dev.company,\n        description: dev.description,\n        repo: dev.repo,\n        link: dev.link,\n        services: dev.services || [],\n        firmwares: dev.firmwares || [],\n    }\n    return clone\n}\n\nexport function escapeDeviceIdentifier(text: string) {\n    if (!text) text = \"\"\n    const escaped = text\n        .trim()\n        .toLowerCase()\n        .replace(/([^a-z0-9\\_-])+/gi, \"-\")\n        .replace(/^-+/, \"\")\n        .replace(/-+$/, \"\")\n    const id = snakify(escaped)\n    return id\n}\n\nexport function escapeDeviceNameIdentifier(text: string) {\n    return escapeDeviceIdentifier(text).replace(/-/g, \"\")\n}\n\nexport function converters(): jdspec.SMap<(s: jdspec.ServiceSpec) => string> {\n    return {\n        json: (j: jdspec.ServiceSpec) => JSON.stringify(j, null, 2),\n        c: toH,\n        ts: j => toTypescript(j, false),\n        sts: j => toTypescript(j, true),\n        /*\n        \"cpp\": toHPP,\n        */\n    }\n}\n"],"sourceRoot":""}
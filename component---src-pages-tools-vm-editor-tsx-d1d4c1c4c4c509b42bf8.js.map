{"version":3,"sources":["webpack://jacdac-docs/./node_modules/@material-ui/core/esm/internal/svg-icons/Cancel.js","webpack://jacdac-docs/./node_modules/@material-ui/core/esm/Chip/Chip.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/BugReport.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/Cancel.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/OpenInBrowser.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/Pause.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/PlayArrow.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/PlayForWork.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/Save.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/Stop.js","webpack://jacdac-docs/./node_modules/core-js/internals/add-to-unscopables.js","webpack://jacdac-docs/./node_modules/core-js/internals/array-species-create.js","webpack://jacdac-docs/./node_modules/core-js/internals/flatten-into-array.js","webpack://jacdac-docs/./node_modules/core-js/internals/function-bind-context.js","webpack://jacdac-docs/./node_modules/core-js/internals/html.js","webpack://jacdac-docs/./node_modules/core-js/internals/is-array.js","webpack://jacdac-docs/./node_modules/core-js/internals/object-create.js","webpack://jacdac-docs/./node_modules/core-js/internals/object-define-properties.js","webpack://jacdac-docs/./node_modules/core-js/internals/object-keys.js","webpack://jacdac-docs/./node_modules/core-js/internals/to-object.js","webpack://jacdac-docs/./node_modules/core-js/modules/es.array.flat-map.js","webpack://jacdac-docs/./node_modules/core-js/modules/es.array.unscopables.flat-map.js","webpack://jacdac-docs/./src/components/ImportButton.tsx","webpack://jacdac-docs/./jacdac-ts/src/vm/utils.ts","webpack://jacdac-docs/./jacdac-ts/src/vm/runner.ts","webpack://jacdac-docs/./src/components/vm/useVMRunner.ts","webpack://jacdac-docs/./src/components/vm/VMDiagnostics.tsx","webpack://jacdac-docs/./src/components/blockly/dsl/servicesdsl.ts","webpack://jacdac-docs/./src/components/blockly/dsl/toolsdsl.ts","webpack://jacdac-docs/./src/components/blockly/BlockRoles.tsx","webpack://jacdac-docs/./src/components/vm/VMRunnerButtons.tsx","webpack://jacdac-docs/./src/components/vm/VMStartSimulatorButton.tsx","webpack://jacdac-docs/./src/components/blockly/BlockFileButtons.tsx","webpack://jacdac-docs/./src/components/vm/VMToolbar.tsx","webpack://jacdac-docs/./src/components/blockly/dsl/loopsdsl.ts","webpack://jacdac-docs/./src/components/blockly/dsl/logicdsl.ts","webpack://jacdac-docs/./src/components/blockly/dsl/mathdsl.ts","webpack://jacdac-docs/./src/components/blockly/dsl/jsondsl.ts","webpack://jacdac-docs/./src/components/vm/VMEditor.tsx","webpack://jacdac-docs/./src/pages/tools/vm-editor.tsx"],"names":["DropzoneDialog","lazy","ImportButton","props","text","onFilesUploaded","disabled","acceptedFiles","icon","filesLimit","className","useState","open","setOpen","handleOpen","handleSave","files","length","handleClose","Mutex","promises","shift","acquire","f","Promise","resolve","reject","push","then","v","e","VMInternalStatus","VM_WAKE_SLEEPER","VMJumpException","label","Error","VMTimerException","ms","VMCommandEvaluator","parent","env","gc","_regSaved","undefined","_changeSaved","_started","trace","msg","context","command","type","evalExpression","expr","VMExprEvaluator","lookupAsync","evalAsync","checkExpression","start","callee","inst","args","arguments","evaluate","neededStart","Running","values","a","sendCommandAsync","Completed","name","event","hasEvent","regValue","ev","unparse","reg","writeRegisterAsync","writeGlobal","watch","sourceId","evString","writeLog","Stopped","VMException","VMExceptionCode","VMCommandRunner","handlerId","_status","_eval","handler","id","val","stepAsync","status","s","VMHandlerRunner","_commandIndex","_currentCommand","stopped","_labelToIndex","commands","forEach","c","index","cmd","reset","gotoTop","Ready","commandIndex","cancel","unsubscribe","wake","next","runToCompletionAsync","singleStep","singleStepCheckBreakAsync","getCommand","sid","breakpointOnAsync","singleStepAsync","vmt","Sleeping","sleepAsync","emit","VM_COMMAND_FAILED","JDEventSource","isEveryHandler","h","assert","VMStatus","MAX_LOG","VMProgramRunner","bus","roleManager","program","_handlerRunners","_roles","_waitQueue","_everyQueue","_runQueue","_sleepQueue","_watch","_log","_breaks","_in_run","compiled","compileProgram","checkProgram","registers","events","errors","roles","console","debug","_env","VMEnvironment","handlers","map","_waitRunMutex","_breaksMutex","_sleepMutex","mount","subscribe","CHANGE","waitingToRunning","GLOBAL_CHANGE","VM_GLOBAL_CHANGE","wakeSleeper","initializeRoleManagement","globals","g","Object","keys","k","value","setStatus","message","TRACE","VM_WATCH_CHANGE","last","count","VM_LOG_ENTRY","lookupWatch","setBreakpointsAsync","breaks","b","clearBreakpointsAsync","ret","setTimeout","handlerRunner","startAsync","setRoles","slice","stopSleepers","runAsync","VM_INTERNAL_ERROR","resumeAsync","Paused","getCurrentRunner","runHandlerAsync","postProcessHandler","newHead","emitBreakpoint","atTop","VM_BREAKPOINT","oneStep","brkCommand","ex","code","VM_ROLE_MISSING","data","done","moveToWait","unshift","waitCopy","handlersStarted","newRunners","sleepingRunners","findIndex","hs","indexOf","splice","consumeEvent","clearTimeout","p","addRoleService","role","service","getService","serviceChanged","r","find","rv","ROLE_BOUND","ROLE_UNBOUND","JDClient","useVMRunner","autoRun","useContext","JacdacContext","AppContext","setError","runner","setRunner","_autoStart","_setAutoStart","run","useEffect","newTestRunner","unmount","ERROR","handleTrace","Flags","VMDiagnostics","JSON","stringify","SET_STATUS_LIGHT_BLOCK","ROLE_BOUND_EVENT_BLOCK","ROLE_BOUND_BLOCK","isBooleanField","field","isStringField","toBlocklyType","encoding","JSON_TYPE","BOOLEAN_TYPE","STRING_TYPE","isNumericType","NUMBER_TYPE","enumInfo","srv","enums","ignoredServices","SRV_CONTROL","SRV_LOGGER","SRV_ROLE_MANAGER","SRV_PROTO_TEST","SRV_BOOTLOADER","ignoredEvents","SystemEvent","includedRegisters","SystemReg","customMessages","SRV_JOYSTICK","register","JoystickReg","get","commandColor","ServicesBlockDomainSpecificLanguage","supportedServices","createServiceColor","theme","sensorColor","palette","success","main","otherColor","info","serviceColor","isSensor","createBlocks","options","customShadows","serviceClass","SRV_SERVO","kind","identifier","ServoReg","shadow","ServoAngleField","SRV_BUZZER","BuzzerCmd","NoteField","lookupCustomShadow","cs","classIdentifier","serviceHelp","withPrefix","shortId","fieldsSupported","pkt","fields","every","fieldName","fieldToShadow","unit","test","defaultValue","min","typicalMin","absoluteMin","max","typicalMax","absoluteMax","variableName","humanify","camelName","toLowerCase","fieldVariable","variable","variableTypes","defaultType","fieldsToFieldInputs","check","fieldsToValues","toMap","fieldsToMessage","i","join","isEnabledRegister","customMessage","m","allServices","serviceSpecifications","filter","resolveService","cls","arrayConcatMany","packets","isRegister","lowLevel","isEvent","kv","isCommand","customBlockDefinitions","SRV_HID_KEYBOARD","message0","args0","KeyboardKeyField","colour","inputsInline","previousStatement","CODE_STATEMENT_TYPE","nextStatement","tooltip","helpUrl","expression","template","SRV_LED","color","LEDColorField","speed","SRV_SEVEN_SEGMENT_DISPLAY","digits","SRV_LED_MATRIX","LEDMatrixField","def","eventBlocks","registerChangeByEventBlocks","some","splitFilter","registerSimples","registerComposites","registerSimpleTypes","registerSimpleOthers","registerSimplesGetBlocks","output","description","registerSimpleEnumTypes","einfo","registerCompositeEnumTypes","registerEnumGetBlocks","members","member","registerNumericsGetBlocks","re","registerSetBlocks","commandBlocks","_serviceBlocks","eventFieldGroups","_eventFieldBlocks","_runtimeBlocks","createCategory","source","liveServices","blockServices","variables","serviceSpecificationFromName","usedEvents","Set","blocks","block","definition","resolveServiceBlockDefinition","eventName","inputs","jdBlocks","services","uniqueMap","toolboxServices","srvid","specification","sort","l","localeCompare","servicesCategories","serviceBlocks","contents","has","button","callbackKey","cat","commonCategory","compileEventToVM","blockToExpression","toMemberExpression","toString","toIdentifier","child","compileExpressionToVM","eventInfo","compileCommandToVM","makeVMBase","serviceCommand","exprsErrors","flatMap","servicesDSL","INSPECT_BLOCK","WATCH_BLOCK","LOG_BLOCK","VIEW_LOG_BLOCK","VARIABLES_BLOCK","TWIN_BLOCK","toolsDSL","TwinField","JDomTreeField","VariablesField","WatchValueField","LogViewField","meta","RoleChip","BlockContext","workspace","serviceShortId","server","useServiceServer","handleRoleClick","addServiceProvider","serviceProviderDefinitionFromServiceClass","twinBlock","getTopBlocks","inputList","fieldRow","getVariable","newBlock","log","setValue","getId","getMetrics","moveBy","viewWidth","viewHeight","initSvg","render","centerOnBlock","handleDelete","removeServiceProvider","device","BlockRoles","useChange","_","useWorkspaceBreakpoints","breakpoints","useMemo","setBreakpointHighlight","highlightBlock","VMRunnerButtons","t","indeterminate","setIndeterminate","breakpoint","setBreakpoint","pausing","paused","mounted","useMounted","handleRun","handleCancel","handleResume","handlePause","handleStep","VMStartSimulatorButton","toggleShowDeviceHostsDialog","LoadButton","handleFiles","file","jsfile","parse","xml","dom","Xml","clear","SaveButton","workspaceXml","json","url","encodeURIComponent","BlockFileButtons","VMToolbar","WAIT_BLOCK","ON_START_BLOCK","REPEAT_EVERY_BLOCK","loopsDsl","interval","time","processErrors","ops","AND","OR","EQ","NEQ","LT","GT","LTE","GTE","NEG","logicDsl","types","A","B","BOOL","blockToExpressionInner","left","right","op","operator","argument","prefix","ADD","MULTIPLY","DIVIDE","MINUS","mathDSL","style","extensions","vm","Math","random","minInclusive","maxInclusive","NUM","JSON_FIELD_TYPE","JSON_OBJECT_BLOCK","JSON_FIELD_SET_BLOCK","JSON_FIELD_GET_TEMPLATE","JSON_FIELD_VALUE_TYPE","PRIMITIVE_TYPES","JSON_FIELD_HAS_BLOCK","jsonDSL","VM_SOURCE_STORAGE_KEY","VMEditorWithContext","dsls","workspaceJSON","setWarnings","setProgram","autoStart","newProgram","workspaceJSONToVMProgram","error","ws","jacdacServices","VMEditor","variablesDsl","shadowDsl","fieldsDsl","Page"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAA+B;AACuB;AACtD;AACA;AACA;;AAEA,2CAAe,gCAAa,eAAe,mBAAmB;AAC9D;AACA,CAAC,YAAY,E;;;;;;;;;;;;ACR6C;AACgC;AAC3D;AACP;AAC8B;AACR;AACe;AAChB;AACU;AACV;AACN;AAChC;AACP;AACA,wBAAwB,iCAAI;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,KAAK;;AAEL,8DAA8D,KAAK;AACnE,gBAAgB;;AAEhB,iFAAiF,KAAK;AACtF;AACA;AACA;AACA;AACA;AACA,yBAAyB,sCAAS;AAClC,OAAO;AACP;AACA;AACA;AACA,KAAK;;AAEL,uGAAuG,KAAK;AAC5G;AACA;AACA,yBAAyB,sCAAS;AAClC;AACA,KAAK;;AAEL,yGAAyG,KAAK;AAC9G;AACA;AACA,yBAAyB,sCAAS;AAClC;AACA,KAAK;;AAEL;AACA;AACA;AACA,yBAAyB,sCAAS;AAClC;AACA,KAAK;;AAEL;AACA;AACA;AACA,yBAAyB,sCAAS;AAClC;AACA,KAAK;;AAEL;AACA;AACA;AACA,yBAAyB,sCAAS;AAClC;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,yBAAyB,iCAAI;AAC7B,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,yBAAyB,iCAAI;AAC7B;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,yBAAyB,iCAAI;AAC7B;AACA,KAAK;AACL;;AAEA;AACA,cAAc;;AAEd;AACA,mBAAmB;;AAEnB;AACA,0BAA0B;;AAE1B;AACA,4BAA4B;;AAE5B;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,iCAAI;AACnB;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,aAAa,iCAAI;AACjB;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,aAAa,iCAAI;AACjB;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,aAAa,iCAAI;AACjB;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,aAAa,iCAAI;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA,wBAAwB,gBAAgB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,0CAAwB;;AAEtC,gBAAgB,YAAY;AAC5B,kBAAkB,6BAAU;;AAE5B;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,gDAAgD,yBAAU;AAC1D,gCAAgC,yBAAU;AAC1C;AACA,GAAG;AACH;;AAEA;AACA,wBAAwB,yBAAI,kFAAkF,6BAAU,qDAAqD,6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","file":"component---src-pages-tools-vm-editor-tsx-d1d4c1c4c4c509b42bf8.js","sourcesContent":["import * as React from 'react';\nimport createSvgIcon from '../../utils/createSvgIcon';\n/**\n * @ignore - internal component.\n */\n\nexport default createSvgIcon( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z\"\n}), 'Cancel');","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport * as React from 'react';\nimport clsx from 'clsx';\nimport CancelIcon from '../internal/svg-icons/Cancel';\nimport withStyles from '../styles/withStyles';\nimport { emphasize, fade } from '../styles/colorManipulator';\nimport useForkRef from '../utils/useForkRef';\nimport unsupportedProp from '../utils/unsupportedProp';\nimport capitalize from '../utils/capitalize';\nimport ButtonBase from '../ButtonBase';\nexport var styles = function styles(theme) {\n  var backgroundColor = theme.palette.type === 'light' ? theme.palette.grey[300] : theme.palette.grey[700];\n  var deleteIconColor = fade(theme.palette.text.primary, 0.26);\n  return {\n    /* Styles applied to the root element. */\n    root: {\n      fontFamily: theme.typography.fontFamily,\n      fontSize: theme.typography.pxToRem(13),\n      display: 'inline-flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      height: 32,\n      color: theme.palette.getContrastText(backgroundColor),\n      backgroundColor: backgroundColor,\n      borderRadius: 32 / 2,\n      whiteSpace: 'nowrap',\n      transition: theme.transitions.create(['background-color', 'box-shadow']),\n      // label will inherit this from root, then `clickable` class overrides this for both\n      cursor: 'default',\n      // We disable the focus ring for mouse, touch and keyboard users.\n      outline: 0,\n      textDecoration: 'none',\n      border: 'none',\n      // Remove `button` border\n      padding: 0,\n      // Remove `button` padding\n      verticalAlign: 'middle',\n      boxSizing: 'border-box',\n      '&$disabled': {\n        opacity: 0.5,\n        pointerEvents: 'none'\n      },\n      '& $avatar': {\n        marginLeft: 5,\n        marginRight: -6,\n        width: 24,\n        height: 24,\n        color: theme.palette.type === 'light' ? theme.palette.grey[700] : theme.palette.grey[300],\n        fontSize: theme.typography.pxToRem(12)\n      },\n      '& $avatarColorPrimary': {\n        color: theme.palette.primary.contrastText,\n        backgroundColor: theme.palette.primary.dark\n      },\n      '& $avatarColorSecondary': {\n        color: theme.palette.secondary.contrastText,\n        backgroundColor: theme.palette.secondary.dark\n      },\n      '& $avatarSmall': {\n        marginLeft: 4,\n        marginRight: -4,\n        width: 18,\n        height: 18,\n        fontSize: theme.typography.pxToRem(10)\n      }\n    },\n\n    /* Styles applied to the root element if `size=\"small\"`. */\n    sizeSmall: {\n      height: 24\n    },\n\n    /* Styles applied to the root element if `color=\"primary\"`. */\n    colorPrimary: {\n      backgroundColor: theme.palette.primary.main,\n      color: theme.palette.primary.contrastText\n    },\n\n    /* Styles applied to the root element if `color=\"secondary\"`. */\n    colorSecondary: {\n      backgroundColor: theme.palette.secondary.main,\n      color: theme.palette.secondary.contrastText\n    },\n\n    /* Pseudo-class applied to the root element if `disabled={true}`. */\n    disabled: {},\n\n    /* Styles applied to the root element if `onClick` is defined or `clickable={true}`. */\n    clickable: {\n      userSelect: 'none',\n      WebkitTapHighlightColor: 'transparent',\n      cursor: 'pointer',\n      '&:hover, &:focus': {\n        backgroundColor: emphasize(backgroundColor, 0.08)\n      },\n      '&:active': {\n        boxShadow: theme.shadows[1]\n      }\n    },\n\n    /* Styles applied to the root element if `onClick` and `color=\"primary\"` is defined or `clickable={true}`. */\n    clickableColorPrimary: {\n      '&:hover, &:focus': {\n        backgroundColor: emphasize(theme.palette.primary.main, 0.08)\n      }\n    },\n\n    /* Styles applied to the root element if `onClick` and `color=\"secondary\"` is defined or `clickable={true}`. */\n    clickableColorSecondary: {\n      '&:hover, &:focus': {\n        backgroundColor: emphasize(theme.palette.secondary.main, 0.08)\n      }\n    },\n\n    /* Styles applied to the root element if `onDelete` is defined. */\n    deletable: {\n      '&:focus': {\n        backgroundColor: emphasize(backgroundColor, 0.08)\n      }\n    },\n\n    /* Styles applied to the root element if `onDelete` and `color=\"primary\"` is defined. */\n    deletableColorPrimary: {\n      '&:focus': {\n        backgroundColor: emphasize(theme.palette.primary.main, 0.2)\n      }\n    },\n\n    /* Styles applied to the root element if `onDelete` and `color=\"secondary\"` is defined. */\n    deletableColorSecondary: {\n      '&:focus': {\n        backgroundColor: emphasize(theme.palette.secondary.main, 0.2)\n      }\n    },\n\n    /* Styles applied to the root element if `variant=\"outlined\"`. */\n    outlined: {\n      backgroundColor: 'transparent',\n      border: \"1px solid \".concat(theme.palette.type === 'light' ? 'rgba(0, 0, 0, 0.23)' : 'rgba(255, 255, 255, 0.23)'),\n      '$clickable&:hover, $clickable&:focus, $deletable&:focus': {\n        backgroundColor: fade(theme.palette.text.primary, theme.palette.action.hoverOpacity)\n      },\n      '& $avatar': {\n        marginLeft: 4\n      },\n      '& $avatarSmall': {\n        marginLeft: 2\n      },\n      '& $icon': {\n        marginLeft: 4\n      },\n      '& $iconSmall': {\n        marginLeft: 2\n      },\n      '& $deleteIcon': {\n        marginRight: 5\n      },\n      '& $deleteIconSmall': {\n        marginRight: 3\n      }\n    },\n\n    /* Styles applied to the root element if `variant=\"outlined\"` and `color=\"primary\"`. */\n    outlinedPrimary: {\n      color: theme.palette.primary.main,\n      border: \"1px solid \".concat(theme.palette.primary.main),\n      '$clickable&:hover, $clickable&:focus, $deletable&:focus': {\n        backgroundColor: fade(theme.palette.primary.main, theme.palette.action.hoverOpacity)\n      }\n    },\n\n    /* Styles applied to the root element if `variant=\"outlined\"` and `color=\"secondary\"`. */\n    outlinedSecondary: {\n      color: theme.palette.secondary.main,\n      border: \"1px solid \".concat(theme.palette.secondary.main),\n      '$clickable&:hover, $clickable&:focus, $deletable&:focus': {\n        backgroundColor: fade(theme.palette.secondary.main, theme.palette.action.hoverOpacity)\n      }\n    },\n    // TODO v5: remove\n\n    /* Styles applied to the `avatar` element. */\n    avatar: {},\n\n    /* Styles applied to the `avatar` element if `size=\"small\"`. */\n    avatarSmall: {},\n\n    /* Styles applied to the `avatar` element if `color=\"primary\"`. */\n    avatarColorPrimary: {},\n\n    /* Styles applied to the `avatar` element if `color=\"secondary\"`. */\n    avatarColorSecondary: {},\n\n    /* Styles applied to the `icon` element. */\n    icon: {\n      color: theme.palette.type === 'light' ? theme.palette.grey[700] : theme.palette.grey[300],\n      marginLeft: 5,\n      marginRight: -6\n    },\n\n    /* Styles applied to the `icon` element if `size=\"small\"`. */\n    iconSmall: {\n      width: 18,\n      height: 18,\n      marginLeft: 4,\n      marginRight: -4\n    },\n\n    /* Styles applied to the `icon` element if `color=\"primary\"`. */\n    iconColorPrimary: {\n      color: 'inherit'\n    },\n\n    /* Styles applied to the `icon` element if `color=\"secondary\"`. */\n    iconColorSecondary: {\n      color: 'inherit'\n    },\n\n    /* Styles applied to the label `span` element. */\n    label: {\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      paddingLeft: 12,\n      paddingRight: 12,\n      whiteSpace: 'nowrap'\n    },\n\n    /* Styles applied to the label `span` element if `size=\"small\"`. */\n    labelSmall: {\n      paddingLeft: 8,\n      paddingRight: 8\n    },\n\n    /* Styles applied to the `deleteIcon` element. */\n    deleteIcon: {\n      WebkitTapHighlightColor: 'transparent',\n      color: deleteIconColor,\n      height: 22,\n      width: 22,\n      cursor: 'pointer',\n      margin: '0 5px 0 -6px',\n      '&:hover': {\n        color: fade(deleteIconColor, 0.4)\n      }\n    },\n\n    /* Styles applied to the `deleteIcon` element if `size=\"small\"`. */\n    deleteIconSmall: {\n      height: 16,\n      width: 16,\n      marginRight: 4,\n      marginLeft: -4\n    },\n\n    /* Styles applied to the deleteIcon element if `color=\"primary\"` and `variant=\"default\"`. */\n    deleteIconColorPrimary: {\n      color: fade(theme.palette.primary.contrastText, 0.7),\n      '&:hover, &:active': {\n        color: theme.palette.primary.contrastText\n      }\n    },\n\n    /* Styles applied to the deleteIcon element if `color=\"secondary\"` and `variant=\"default\"`. */\n    deleteIconColorSecondary: {\n      color: fade(theme.palette.secondary.contrastText, 0.7),\n      '&:hover, &:active': {\n        color: theme.palette.secondary.contrastText\n      }\n    },\n\n    /* Styles applied to the deleteIcon element if `color=\"primary\"` and `variant=\"outlined\"`. */\n    deleteIconOutlinedColorPrimary: {\n      color: fade(theme.palette.primary.main, 0.7),\n      '&:hover, &:active': {\n        color: theme.palette.primary.main\n      }\n    },\n\n    /* Styles applied to the deleteIcon element if `color=\"secondary\"` and `variant=\"outlined\"`. */\n    deleteIconOutlinedColorSecondary: {\n      color: fade(theme.palette.secondary.main, 0.7),\n      '&:hover, &:active': {\n        color: theme.palette.secondary.main\n      }\n    }\n  };\n};\n\nfunction isDeleteKeyboardEvent(keyboardEvent) {\n  return keyboardEvent.key === 'Backspace' || keyboardEvent.key === 'Delete';\n}\n/**\n * Chips represent complex entities in small blocks, such as a contact.\n */\n\n\nvar Chip = /*#__PURE__*/React.forwardRef(function Chip(props, ref) {\n  var avatarProp = props.avatar,\n      classes = props.classes,\n      className = props.className,\n      clickableProp = props.clickable,\n      _props$color = props.color,\n      color = _props$color === void 0 ? 'default' : _props$color,\n      ComponentProp = props.component,\n      deleteIconProp = props.deleteIcon,\n      _props$disabled = props.disabled,\n      disabled = _props$disabled === void 0 ? false : _props$disabled,\n      iconProp = props.icon,\n      label = props.label,\n      onClick = props.onClick,\n      onDelete = props.onDelete,\n      onKeyDown = props.onKeyDown,\n      onKeyUp = props.onKeyUp,\n      _props$size = props.size,\n      size = _props$size === void 0 ? 'medium' : _props$size,\n      _props$variant = props.variant,\n      variant = _props$variant === void 0 ? 'default' : _props$variant,\n      other = _objectWithoutProperties(props, [\"avatar\", \"classes\", \"className\", \"clickable\", \"color\", \"component\", \"deleteIcon\", \"disabled\", \"icon\", \"label\", \"onClick\", \"onDelete\", \"onKeyDown\", \"onKeyUp\", \"size\", \"variant\"]);\n\n  var chipRef = React.useRef(null);\n  var handleRef = useForkRef(chipRef, ref);\n\n  var handleDeleteIconClick = function handleDeleteIconClick(event) {\n    // Stop the event from bubbling up to the `Chip`\n    event.stopPropagation();\n\n    if (onDelete) {\n      onDelete(event);\n    }\n  };\n\n  var handleKeyDown = function handleKeyDown(event) {\n    // Ignore events from children of `Chip`.\n    if (event.currentTarget === event.target && isDeleteKeyboardEvent(event)) {\n      // will be handled in keyUp, otherwise some browsers\n      // might init navigation\n      event.preventDefault();\n    }\n\n    if (onKeyDown) {\n      onKeyDown(event);\n    }\n  };\n\n  var handleKeyUp = function handleKeyUp(event) {\n    // Ignore events from children of `Chip`.\n    if (event.currentTarget === event.target) {\n      if (onDelete && isDeleteKeyboardEvent(event)) {\n        onDelete(event);\n      } else if (event.key === 'Escape' && chipRef.current) {\n        chipRef.current.blur();\n      }\n    }\n\n    if (onKeyUp) {\n      onKeyUp(event);\n    }\n  };\n\n  var clickable = clickableProp !== false && onClick ? true : clickableProp;\n  var small = size === 'small';\n  var Component = ComponentProp || (clickable ? ButtonBase : 'div');\n  var moreProps = Component === ButtonBase ? {\n    component: 'div'\n  } : {};\n  var deleteIcon = null;\n\n  if (onDelete) {\n    var customClasses = clsx(color !== 'default' && (variant === \"default\" ? classes[\"deleteIconColor\".concat(capitalize(color))] : classes[\"deleteIconOutlinedColor\".concat(capitalize(color))]), small && classes.deleteIconSmall);\n    deleteIcon = deleteIconProp && /*#__PURE__*/React.isValidElement(deleteIconProp) ? /*#__PURE__*/React.cloneElement(deleteIconProp, {\n      className: clsx(deleteIconProp.props.className, classes.deleteIcon, customClasses),\n      onClick: handleDeleteIconClick\n    }) : /*#__PURE__*/React.createElement(CancelIcon, {\n      className: clsx(classes.deleteIcon, customClasses),\n      onClick: handleDeleteIconClick\n    });\n  }\n\n  var avatar = null;\n\n  if (avatarProp && /*#__PURE__*/React.isValidElement(avatarProp)) {\n    avatar = /*#__PURE__*/React.cloneElement(avatarProp, {\n      className: clsx(classes.avatar, avatarProp.props.className, small && classes.avatarSmall, color !== 'default' && classes[\"avatarColor\".concat(capitalize(color))])\n    });\n  }\n\n  var icon = null;\n\n  if (iconProp && /*#__PURE__*/React.isValidElement(iconProp)) {\n    icon = /*#__PURE__*/React.cloneElement(iconProp, {\n      className: clsx(classes.icon, iconProp.props.className, small && classes.iconSmall, color !== 'default' && classes[\"iconColor\".concat(capitalize(color))])\n    });\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (avatar && icon) {\n      console.error('Material-UI: The Chip component can not handle the avatar ' + 'and the icon prop at the same time. Pick one.');\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(Component, _extends({\n    role: clickable || onDelete ? 'button' : undefined,\n    className: clsx(classes.root, className, color !== 'default' && [classes[\"color\".concat(capitalize(color))], clickable && classes[\"clickableColor\".concat(capitalize(color))], onDelete && classes[\"deletableColor\".concat(capitalize(color))]], variant !== \"default\" && [classes.outlined, {\n      'primary': classes.outlinedPrimary,\n      'secondary': classes.outlinedSecondary\n    }[color]], disabled && classes.disabled, small && classes.sizeSmall, clickable && classes.clickable, onDelete && classes.deletable),\n    \"aria-disabled\": disabled ? true : undefined,\n    tabIndex: clickable || onDelete ? 0 : undefined,\n    onClick: onClick,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    ref: handleRef\n  }, moreProps, other), avatar || icon, /*#__PURE__*/React.createElement(\"span\", {\n    className: clsx(classes.label, small && classes.labelSmall)\n  }, label), deleteIcon);\n});\nprocess.env.NODE_ENV !== \"production\" ? void 0 : void 0;\nexport default withStyles(styles, {\n  name: 'MuiChip'\n})(Chip);","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8zm-6 8h-4v-2h4v2zm0-4h-4v-2h4v2z\"\n}), 'BugReport');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z\"\n}), 'Cancel');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z\"\n}), 'OpenInBrowser');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M6 19h4V5H6v14zm8-14v14h4V5h-4z\"\n}), 'Pause');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M8 5v14l11-7z\"\n}), 'PlayArrow');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M11 5v5.59H7.5l4.5 4.5 4.5-4.5H13V5h-2zm-5 9c0 3.31 2.69 6 6 6s6-2.69 6-6h-2c0 2.21-1.79 4-4 4s-4-1.79-4-4H6z\"\n}), 'PlayForWork');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z\"\n}), 'Save');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M6 6h12v12H6z\"\n}), 'Stop');\n\nexports.default = _default;","var wellKnownSymbol = require('../internals/well-known-symbol');\nvar create = require('../internals/object-create');\nvar definePropertyModule = require('../internals/object-define-property');\n\nvar UNSCOPABLES = wellKnownSymbol('unscopables');\nvar ArrayPrototype = Array.prototype;\n\n// Array.prototype[@@unscopables]\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\nif (ArrayPrototype[UNSCOPABLES] == undefined) {\n  definePropertyModule.f(ArrayPrototype, UNSCOPABLES, {\n    configurable: true,\n    value: create(null)\n  });\n}\n\n// add a key to Array.prototype[@@unscopables]\nmodule.exports = function (key) {\n  ArrayPrototype[UNSCOPABLES][key] = true;\n};\n","var isObject = require('../internals/is-object');\nvar isArray = require('../internals/is-array');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar SPECIES = wellKnownSymbol('species');\n\n// `ArraySpeciesCreate` abstract operation\n// https://tc39.es/ecma262/#sec-arrayspeciescreate\nmodule.exports = function (originalArray, length) {\n  var C;\n  if (isArray(originalArray)) {\n    C = originalArray.constructor;\n    // cross-realm fallback\n    if (typeof C == 'function' && (C === Array || isArray(C.prototype))) C = undefined;\n    else if (isObject(C)) {\n      C = C[SPECIES];\n      if (C === null) C = undefined;\n    }\n  } return new (C === undefined ? Array : C)(length === 0 ? 0 : length);\n};\n","'use strict';\nvar isArray = require('../internals/is-array');\nvar toLength = require('../internals/to-length');\nvar bind = require('../internals/function-bind-context');\n\n// `FlattenIntoArray` abstract operation\n// https://tc39.github.io/proposal-flatMap/#sec-FlattenIntoArray\nvar flattenIntoArray = function (target, original, source, sourceLen, start, depth, mapper, thisArg) {\n  var targetIndex = start;\n  var sourceIndex = 0;\n  var mapFn = mapper ? bind(mapper, thisArg, 3) : false;\n  var element;\n\n  while (sourceIndex < sourceLen) {\n    if (sourceIndex in source) {\n      element = mapFn ? mapFn(source[sourceIndex], sourceIndex, original) : source[sourceIndex];\n\n      if (depth > 0 && isArray(element)) {\n        targetIndex = flattenIntoArray(target, original, element, toLength(element.length), targetIndex, depth - 1) - 1;\n      } else {\n        if (targetIndex >= 0x1FFFFFFFFFFFFF) throw TypeError('Exceed the acceptable array length');\n        target[targetIndex] = element;\n      }\n\n      targetIndex++;\n    }\n    sourceIndex++;\n  }\n  return targetIndex;\n};\n\nmodule.exports = flattenIntoArray;\n","var aFunction = require('../internals/a-function');\n\n// optional / simple context binding\nmodule.exports = function (fn, that, length) {\n  aFunction(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 0: return function () {\n      return fn.call(that);\n    };\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('document', 'documentElement');\n","var classof = require('../internals/classof-raw');\n\n// `IsArray` abstract operation\n// https://tc39.es/ecma262/#sec-isarray\n// eslint-disable-next-line es/no-array-isarray -- safe\nmodule.exports = Array.isArray || function isArray(arg) {\n  return classof(arg) == 'Array';\n};\n","var anObject = require('../internals/an-object');\nvar defineProperties = require('../internals/object-define-properties');\nvar enumBugKeys = require('../internals/enum-bug-keys');\nvar hiddenKeys = require('../internals/hidden-keys');\nvar html = require('../internals/html');\nvar documentCreateElement = require('../internals/document-create-element');\nvar sharedKey = require('../internals/shared-key');\n\nvar GT = '>';\nvar LT = '<';\nvar PROTOTYPE = 'prototype';\nvar SCRIPT = 'script';\nvar IE_PROTO = sharedKey('IE_PROTO');\n\nvar EmptyConstructor = function () { /* empty */ };\n\nvar scriptTag = function (content) {\n  return LT + SCRIPT + GT + content + LT + '/' + SCRIPT + GT;\n};\n\n// Create object with fake `null` prototype: use ActiveX Object with cleared prototype\nvar NullProtoObjectViaActiveX = function (activeXDocument) {\n  activeXDocument.write(scriptTag(''));\n  activeXDocument.close();\n  var temp = activeXDocument.parentWindow.Object;\n  activeXDocument = null; // avoid memory leak\n  return temp;\n};\n\n// Create object with fake `null` prototype: use iframe Object with cleared prototype\nvar NullProtoObjectViaIFrame = function () {\n  // Thrash, waste and sodomy: IE GC bug\n  var iframe = documentCreateElement('iframe');\n  var JS = 'java' + SCRIPT + ':';\n  var iframeDocument;\n  iframe.style.display = 'none';\n  html.appendChild(iframe);\n  // https://github.com/zloirock/core-js/issues/475\n  iframe.src = String(JS);\n  iframeDocument = iframe.contentWindow.document;\n  iframeDocument.open();\n  iframeDocument.write(scriptTag('document.F=Object'));\n  iframeDocument.close();\n  return iframeDocument.F;\n};\n\n// Check for document.domain and active x support\n// No need to use active x approach when document.domain is not set\n// see https://github.com/es-shims/es5-shim/issues/150\n// variation of https://github.com/kitcambridge/es5-shim/commit/4f738ac066346\n// avoid IE GC bug\nvar activeXDocument;\nvar NullProtoObject = function () {\n  try {\n    /* global ActiveXObject -- old IE */\n    activeXDocument = document.domain && new ActiveXObject('htmlfile');\n  } catch (error) { /* ignore */ }\n  NullProtoObject = activeXDocument ? NullProtoObjectViaActiveX(activeXDocument) : NullProtoObjectViaIFrame();\n  var length = enumBugKeys.length;\n  while (length--) delete NullProtoObject[PROTOTYPE][enumBugKeys[length]];\n  return NullProtoObject();\n};\n\nhiddenKeys[IE_PROTO] = true;\n\n// `Object.create` method\n// https://tc39.es/ecma262/#sec-object.create\nmodule.exports = Object.create || function create(O, Properties) {\n  var result;\n  if (O !== null) {\n    EmptyConstructor[PROTOTYPE] = anObject(O);\n    result = new EmptyConstructor();\n    EmptyConstructor[PROTOTYPE] = null;\n    // add \"__proto__\" for Object.getPrototypeOf polyfill\n    result[IE_PROTO] = O;\n  } else result = NullProtoObject();\n  return Properties === undefined ? result : defineProperties(result, Properties);\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar anObject = require('../internals/an-object');\nvar objectKeys = require('../internals/object-keys');\n\n// `Object.defineProperties` method\n// https://tc39.es/ecma262/#sec-object.defineproperties\n// eslint-disable-next-line es/no-object-defineproperties -- safe\nmodule.exports = DESCRIPTORS ? Object.defineProperties : function defineProperties(O, Properties) {\n  anObject(O);\n  var keys = objectKeys(Properties);\n  var length = keys.length;\n  var index = 0;\n  var key;\n  while (length > index) definePropertyModule.f(O, key = keys[index++], Properties[key]);\n  return O;\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n// eslint-disable-next-line es/no-object-keys -- safe\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n","var requireObjectCoercible = require('../internals/require-object-coercible');\n\n// `ToObject` abstract operation\n// https://tc39.es/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return Object(requireObjectCoercible(argument));\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar aFunction = require('../internals/a-function');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flatMap` method\n// https://tc39.es/ecma262/#sec-array.prototype.flatmap\n$({ target: 'Array', proto: true }, {\n  flatMap: function flatMap(callbackfn /* , thisArg */) {\n    var O = toObject(this);\n    var sourceLen = toLength(O.length);\n    var A;\n    aFunction(callbackfn);\n    A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, 1, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    return A;\n  }\n});\n","// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('flatMap');\n","import React, { lazy, useState } from \"react\"\nimport { Box, Button } from \"@material-ui/core\"\n// tslint:disable-next-line: no-submodule-imports match-default-export-name\nimport OpenInBrowserIcon from \"@material-ui/icons/OpenInBrowser\"\nimport IconButtonWithTooltip from \"./ui/IconButtonWithTooltip\"\nimport Suspense from \"./ui/Suspense\"\nconst DropzoneDialog = lazy(() => import(\"./ui/DropzoneDialog\"))\n\nexport default function ImportButton(props: {\n    icon?: boolean\n    text: string\n    onFilesUploaded: (files: File[]) => void\n    disabled?: boolean\n    acceptedFiles?: string[]\n    filesLimit?: number\n    className?: string\n}) {\n    const {\n        text,\n        onFilesUploaded,\n        disabled,\n        acceptedFiles,\n        icon,\n        filesLimit,\n        className,\n    } = props\n    const [open, setOpen] = useState(false)\n\n    const handleOpen = () => {\n        setOpen(true)\n    }\n    const handleSave = (files: File[]) => {\n        if (files?.length) onFilesUploaded(files)\n        setOpen(false)\n    }\n    const handleClose = () => setOpen(false)\n\n    return (\n        <Box className={className}>\n            {icon && (\n                <IconButtonWithTooltip title={text} onClick={handleOpen}>\n                    <OpenInBrowserIcon />\n                </IconButtonWithTooltip>\n            )}\n            {!icon && (\n                <Button\n                    disabled={disabled}\n                    variant=\"outlined\"\n                    onClick={handleOpen}\n                    startIcon={<OpenInBrowserIcon />}\n                >\n                    {text}\n                </Button>\n            )}\n            {open && (\n                <Suspense>\n                    <DropzoneDialog\n                        open={open}\n                        onSave={handleSave}\n                        maxFileSize={5000000}\n                        onClose={handleClose}\n                        acceptedFiles={acceptedFiles}\n                        clearOnUnmount={true}\n                        filesLimit={filesLimit || 1}\n                        submitButtonText={\"import\"}\n                    />\n                </Suspense>\n            )}\n        </Box>\n    )\n}\n","export class Mutex {\n    private promises: (() => Promise<any>)[] = []\n    private shift() {\n        this.promises.shift()\n        if (this.promises[0]) this.promises[0]()\n    }\n    acquire<T>(f: () => Promise<T>): Promise<T> {\n        return new Promise<T>((resolve, reject) => {\n            this.promises.push(() =>\n                f().then(\n                    v => {\n                        this.shift()\n                        resolve(v)\n                    },\n                    e => {\n                        this.shift()\n                        reject(e)\n                    }\n                )\n            )\n            if (this.promises.length == 1) this.promises[0]()\n        })\n    }\n}\n","import { VMProgram, VMHandler, VMCommand, VMRole } from \"./ir\"\nimport RoleManager from \"../servers/rolemanager\"\nimport {\n    VMEnvironment,\n    VMException,\n    VMExceptionCode,\n    GLOBAL_CHANGE,\n} from \"./environment\"\nimport { VMExprEvaluator, unparse } from \"./expr\"\nimport { JDBus } from \"../jdom/bus\"\nimport { JDEventSource } from \"../jdom/eventsource\"\nimport { CHANGE, ROLE_BOUND, ROLE_UNBOUND, TRACE } from \"../jdom/constants\"\nimport { checkProgram, compileProgram } from \"./compile\"\nimport {\n    VM_GLOBAL_CHANGE,\n    VM_COMMAND_FAILED,\n    VM_WATCH_CHANGE,\n    VM_BREAKPOINT,\n    VM_INTERNAL_ERROR,\n    VM_LOG_ENTRY,\n    VM_ROLE_MISSING,\n} from \"./events\"\nimport { Mutex } from \"./utils\"\nimport { assert, SMap } from \"../jdom/utils\"\nimport { JDClient } from \"../jdom/client\"\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type VMTraceContext = any\n\nenum VMInternalStatus {\n    Ready = \"ready\", // the pc is at this instruction, but pre-condition not met\n    Enabled = \"enabled\", // the instruction pre-conditions are met (is this needed?)\n    Running = \"running\", // the instruction has started running (may need retries)\n    Sleeping = \"sleep\", // waiting to be woken by timer\n    Completed = \"completed\", // the instruction completed successfully\n    Stopped = \"stopped\", // halt instruction encountered, handler stopped\n}\n\nconst VM_WAKE_SLEEPER = \"vmWakeSleeper\"\n\nexport type atomic = string | boolean | number\n\nexport interface VMEnvironmentInterface {\n    writeRegisterAsync: (\n        e: jsep.MemberExpression | string,\n        v: atomic\n    ) => Promise<void>\n    sendCommandAsync: (\n        command: jsep.MemberExpression,\n        values: atomic[]\n    ) => Promise<void>\n    lookupAsync: (e: jsep.MemberExpression | string) => Promise<atomic>\n    writeGlobal: (e: jsep.MemberExpression | string, v: atomic) => boolean\n    hasEvent: (e: jsep.MemberExpression | string) => boolean\n    unsubscribe: () => void\n}\n\nclass VMJumpException extends Error {\n    constructor(public label: string) {\n        super()\n    }\n}\n\nclass VMTimerException extends Error {\n    constructor(public ms: number) {\n        super()\n    }\n}\n\nclass VMCommandEvaluator {\n    private _regSaved: number = undefined\n    private _changeSaved: number = undefined\n    private _started = false\n    constructor(\n        public parent: VMCommandRunner,\n        private readonly env: VMEnvironment,\n        private readonly gc: VMCommand\n    ) {}\n\n    trace(msg: string, context: VMTraceContext = {}) {\n        this.parent.trace(msg, { command: this.gc.command.type, ...context })\n    }\n\n    private get inst() {\n        return (this.gc.command.callee as jsep.Identifier)?.name\n    }\n\n    private async evalExpression(e: jsep.Expression) {\n        const expr = new VMExprEvaluator(async e => await this.env.lookupAsync(e), undefined)\n        return await expr.evalAsync(e)\n    }\n\n    private async checkExpression(e: jsep.Expression) {\n        return await this.evalExpression(e) ? true : false\n    }\n\n    private async start() {\n        if (\n            this.gc.command.callee.type !== \"MemberExpression\" &&\n            (this.inst === \"awaitRegister\" || this.inst === \"awaitChange\")\n        ) {\n            // need to capture register value for awaitChange/awaitRegister\n            const args = this.gc.command.arguments\n            this._regSaved = await this.evalExpression(args[0])\n            if (this.inst === \"awaitChange\")\n                this._changeSaved = await this.evalExpression(args[1])\n            return true\n        }\n        return false\n    }\n\n    public async evaluate(): Promise<VMInternalStatus> {\n        if (!this._started) {\n            const neededStart = this.start()\n            this._started = true\n            if (neededStart) return VMInternalStatus.Running\n        }\n        const args = this.gc.command.arguments\n        if (this.gc.command.callee.type === \"MemberExpression\") {\n            // interpret as a service command (role.comand)\n            const expr = new VMExprEvaluator(async e => await this.env.lookupAsync(e), undefined)\n            // TODO\n            const values: atomic[] = []\n            for(const a of this.gc.command.arguments) {\n                values.push(await expr.evalAsync(a))\n            }\n            await this.env.sendCommandAsync(\n                this.gc.command.callee as jsep.MemberExpression,\n                values\n            )\n            return VMInternalStatus.Completed\n        }\n        switch (this.inst) {\n            case \"branchOnCondition\": {\n                const expr = this.checkExpression(args[0])\n                if (expr) {\n                    throw new VMJumpException((args[1] as jsep.Identifier).name)\n                }\n                return VMInternalStatus.Completed\n            }\n            case \"jump\": {\n                throw new VMJumpException((args[0] as jsep.Identifier).name)\n            }\n            case \"label\": {\n                return VMInternalStatus.Completed\n            }\n            case \"awaitEvent\": {\n                const event = args[0] as jsep.MemberExpression\n                if (this.env.hasEvent(event)) {\n                    return this.checkExpression(args[1])\n                        ? VMInternalStatus.Completed\n                        : VMInternalStatus.Running\n                }\n                return VMInternalStatus.Running\n            }\n            case \"awaitCondition\": {\n                return this.checkExpression(args[0])\n                    ? VMInternalStatus.Completed\n                    : VMInternalStatus.Running\n            }\n            case \"awaitChange\":\n            case \"awaitRegister\": {\n                const regValue = await this.evalExpression(args[0])\n                if (\n                    (this.inst === \"awaitRegister\" &&\n                        regValue !== this._regSaved) ||\n                    (this.inst === \"awaitChange\" &&\n                        ((this._changeSaved === 0 &&\n                            regValue !== this._regSaved) ||\n                            (this._changeSaved < 0 &&\n                                regValue <=\n                                    this._regSaved + this._changeSaved) ||\n                            (this._changeSaved > 0 &&\n                                regValue >=\n                                    this._regSaved + this._changeSaved)))\n                ) {\n                    return VMInternalStatus.Completed\n                }\n                return VMInternalStatus.Running\n            }\n            case \"writeRegister\":\n            case \"writeLocal\": {\n                const expr = new VMExprEvaluator(\n                    async e => this.env.lookupAsync(e),\n                    undefined\n                )\n                const ev = await expr.evalAsync(args[1])\n                this.trace(\"eval-end\", { expr: unparse(args[1]) })\n                const reg = args[0] as jsep.MemberExpression\n                if (this.inst === \"writeRegister\") {\n                    await this.env.writeRegisterAsync(reg, ev)\n                    this.trace(\"write-after-wait\", {\n                        reg: unparse(reg),\n                        expr: ev,\n                    })\n                } else this.env.writeGlobal(reg, ev)\n                return VMInternalStatus.Completed\n            }\n            case \"watch\": {\n                const expr = new VMExprEvaluator(\n                    e => this.env.lookupAsync(e),\n                    undefined\n                )\n                const ev = await expr.evalAsync(args[0])\n                this.parent.watch(this.gc?.sourceId, ev)\n                return VMInternalStatus.Completed\n            }\n            case \"log\": {\n                const expr = new VMExprEvaluator(\n                    e => this.env.lookupAsync(e),\n                    undefined\n                )\n                const ev = await expr.evalAsync(args[0])\n                const evString = ev + \"\"\n                this.parent.writeLog(this.gc?.sourceId, evString)\n                return VMInternalStatus.Completed\n            }\n            case \"halt\": {\n                return VMInternalStatus.Stopped\n            }\n            case \"nop\": {\n                return VMInternalStatus.Completed\n            }\n            case \"wait\": {\n                const expr = new VMExprEvaluator(\n                    e => this.env.lookupAsync(e),\n                    undefined\n                )\n                const ev = await expr.evalAsync(args[0])\n                throw new VMTimerException(ev * 1000)\n            }\n            case \"onRoleConnected\": {\n                // first time fires based on state\n                // after that, only on transitions\n                return VMInternalStatus.Completed\n            }\n            case \"onRoleDisonnected\": {\n                // first time fires based on state\n                // after that, only on transitions\n                return VMInternalStatus.Completed\n            }\n            default:\n                throw new VMException(\n                    VMExceptionCode.InternalError,\n                    `Unknown instruction ${this.inst}`\n                )\n        }\n    }\n}\n\nclass VMCommandRunner {\n    private _eval: VMCommandEvaluator\n    private _status: VMInternalStatus = VMInternalStatus.Running\n    constructor(\n        public readonly parent: VMHandlerRunner,\n        private handlerId: number,\n        env: VMEnvironment,\n        public gc: VMCommand\n    ) {\n        this._eval = new VMCommandEvaluator(this, env, gc)\n    }\n\n    trace(msg: string, context: VMTraceContext = {}) {\n        this.parent.trace(msg, { handler: this.handlerId, ...context })\n    }\n\n    watch(id: string, val: any) {\n        this.parent.watch(id, val)\n    }\n\n    writeLog(id: string, val: any) {\n        this.parent.writeLog(id, val)\n    }\n\n    get status() {\n        return this._status\n    }\n\n    set status(s: VMInternalStatus) {\n        this._status = s\n    }\n\n    async stepAsync() {\n        if (this.status === VMInternalStatus.Running) {\n            this.trace(unparse(this.gc.command))\n            this.status = await this._eval.evaluate()\n        }\n    }\n}\n\nclass VMHandlerRunner extends JDEventSource {\n    private _commandIndex: number = undefined\n    private _currentCommand: VMCommandRunner = undefined\n    private stopped = false\n    private _labelToIndex: SMap<number> = {}\n\n    constructor(\n        public readonly parent: VMProgramRunner,\n        public readonly id: number,\n        public readonly env: VMEnvironment,\n        public readonly handler: VMHandler\n    ) {\n        super()\n        // find the label commands (targets of jumps)\n        this.handler.commands.forEach((c, index) => {\n            const cmd = c as VMCommand\n            const id = cmd.command?.callee as jsep.Identifier\n            if (id?.name === \"label\") {\n                const label = cmd.command.arguments[0] as jsep.Identifier\n                this._labelToIndex[label.name] = index\n            }\n        })\n        this.reset()\n    }\n\n    trace(msg: string, context: VMTraceContext = {}) {\n        this.parent.trace(msg, { id: this.id, ...context })\n    }\n\n    watch(id: string, val: any) {\n        this.parent.watch(id, val)\n    }\n\n    writeLog(id: string, val: any) {\n        this.parent.writeLog(id, val)\n    }\n\n    get status() {\n        return this.stopped\n            ? VMInternalStatus.Stopped\n            : this._commandIndex === undefined\n            ? VMInternalStatus.Ready\n            : this._currentCommand.status === VMInternalStatus.Completed &&\n              this._commandIndex < this.handler.commands.length - 1\n            ? VMInternalStatus.Running\n            : this._currentCommand.status\n    }\n\n    get command() {\n        return this._currentCommand\n    }\n\n    get atTop() {\n        return (\n            this.status === VMInternalStatus.Running && this._commandIndex === 0\n        )\n    }\n\n    gotoTop() {\n        if (\n            this.status === VMInternalStatus.Ready &&\n            this.handler.commands.length\n        )\n            this.commandIndex = 0\n    }\n\n    reset() {\n        this.commandIndex = undefined\n        this.stopped = false\n    }\n\n    cancel() {\n        this.stopped = true\n        this.env.unsubscribe()\n    }\n\n    wake() {\n        if (this._currentCommand) {\n            this._currentCommand.status = VMInternalStatus.Completed\n            this.next()\n        }\n    }\n\n    // run-to-completion semantics\n    // returns command if breakpoint encountered when not single stepping\n    async runToCompletionAsync(singleStep = false) {\n        if (this.stopped || !this.handler.commands.length) return undefined\n        if (this.commandIndex === undefined) {\n            this.commandIndex = 0\n        }\n        if ((await this.singleStepCheckBreakAsync(singleStep)) && !singleStep)\n            return this._currentCommand\n        while (this.next()) {\n            if (singleStep || (await this.singleStepCheckBreakAsync()))\n                return this._currentCommand\n        }\n        return undefined\n    }\n\n    private next() {\n        if (\n            this._currentCommand.status === VMInternalStatus.Completed &&\n            this.commandIndex < this.handler.commands.length - 1\n        ) {\n            this.commandIndex++\n            return true\n        }\n        return false\n    }\n\n    private getCommand() {\n        const cmd = this.handler.commands[this._commandIndex]\n        if (cmd.type === \"ite\") {\n            throw new VMException(\n                VMExceptionCode.InternalError,\n                \"ite not compiled away\"\n            )\n        }\n        return cmd as VMCommand\n    }\n\n    private async singleStepCheckBreakAsync(singleStep = false) {\n        this.trace(\"step begin\")\n        const sid = this._currentCommand.gc?.sourceId\n        if (!singleStep && (await this.parent.breakpointOnAsync(sid))) {\n            return true\n        }\n        await this.singleStepAsync()\n        this.trace(\"step end\")\n        return false\n    }\n\n    private async singleStepAsync() {\n        const sid = this._currentCommand.gc.sourceId\n        try {\n            await this._currentCommand.stepAsync()\n        } catch (e) {\n            if (e instanceof VMJumpException) {\n                const { label } = e as VMJumpException\n                const index = this._labelToIndex[label]\n                this.commandIndex = index\n                this._currentCommand.status = VMInternalStatus.Completed\n            } else if (e instanceof VMTimerException) {\n                const vmt = e as VMTimerException\n                this._currentCommand.status = VMInternalStatus.Sleeping\n                await this.parent.sleepAsync(this, vmt.ms)\n            } else {\n                this.emit(VM_COMMAND_FAILED, this._currentCommand.gc.sourceId)\n                throw e\n            }\n        }\n        if (this._currentCommand.status === VMInternalStatus.Stopped)\n            this.stopped = true\n    }\n\n    private set commandIndex(index: number) {\n        if (index === undefined) {\n            this._commandIndex = undefined\n            this._currentCommand = undefined\n        } else if (index !== this._commandIndex) {\n            this._commandIndex = index\n            this._currentCommand = new VMCommandRunner(\n                this,\n                this.id,\n                this.env,\n                this.getCommand()\n            )\n        }\n    }\n\n    private get commandIndex() {\n        return this._commandIndex\n    }\n}\n\nexport type WatchValueType = boolean | string | number\n\ninterface SleepingHandler {\n    ms: number\n    handlerRunner: VMHandlerRunner\n    handler?: VMHandler\n    id: NodeJS.Timeout\n}\n\nfunction isEveryHandler(h: VMHandler) {\n    assert(!!h)\n    if (h.commands.length) {\n        const cmd = (h.commands[0] as VMCommand).command\n            .callee as jsep.Identifier\n        return cmd.name === \"wait\"\n    }\n    return false\n}\n\nexport enum VMStatus {\n    Stopped = \"stopped\",\n    Running = \"running\",\n    Paused = \"paused\",\n}\nconst MAX_LOG = 100\nexport class VMProgramRunner extends JDClient {\n    // program, environment\n    private _handlerRunners: VMHandlerRunner[] = []\n    private _env: VMEnvironment\n    private _roles: VMRole[] = []\n    // running\n    private _status: VMStatus\n    private _waitQueue: VMHandlerRunner[] = []\n    private _everyQueue: VMHandlerRunner[] = []\n    private _runQueue: VMHandlerRunner[] = []\n    private _waitRunMutex: Mutex\n    private _sleepQueue: SleepingHandler[] = []\n    private _sleepMutex: Mutex\n    // debugging\n    private _watch: SMap<any> = {}\n    private _log: { text: string; count: number }[] = []\n    private _breaks: SMap<boolean> = {}\n    private _breaksMutex: Mutex\n\n    constructor(\n        readonly bus: JDBus,\n        readonly roleManager: RoleManager,\n        readonly program: VMProgram\n    ) {\n        super()\n        const compiled = compileProgram(program)\n        const { registers, events, errors } = checkProgram(compiled)\n        this._roles = compiled.roles\n        if (errors?.length) console.debug(\"ERRORS\", errors)\n        // data structures for running program\n        this._status = VMStatus.Stopped\n        this._env = new VMEnvironment(registers, events)\n        this._handlerRunners = compiled.handlers.map(\n            (h, index) => new VMHandlerRunner(this, index, this._env, h)\n        )\n        // TODO: can't add multiple handlers until we have deduplicate CHANGE on Event\n        /*\n        const len = this._handlerRunners.length\n        compiled.handlers.forEach((h, index) =>\n            this._handlerRunners.push(\n                new VMHandlerRunner(this, len + index, this._env, h)\n            )\n        )*/\n\n        this._waitRunMutex = new Mutex()\n        this._breaksMutex = new Mutex()\n        this._sleepMutex = new Mutex()\n        // run on any change to environment\n        this.mount(\n            this._env.subscribe(CHANGE, () => {\n                this.waitingToRunning()\n            })\n        )\n        this.mount(\n            this._env.subscribe(GLOBAL_CHANGE, name =>\n                this.emit(VM_GLOBAL_CHANGE, name)\n            )\n        )\n        this.mount(\n            this.subscribe(\n                VM_WAKE_SLEEPER,\n                async (h: VMHandlerRunner | VMHandler) => {\n                    await this.wakeSleeper(h)\n                }\n            )\n        )\n        this.initializeRoleManagement()\n    }\n\n    // control of VM\n    get status() {\n        return this._status\n    }\n\n    get logData() {\n        return this._log.slice(0)\n    }\n\n    globals(): { name: string; value: atomic }[] {\n        const g = this._env.globals()\n        return Object.keys(g).map(k => {\n            return { name: k, value: g[k].value }\n        })\n    }\n\n    private setStatus(s: VMStatus) {\n        if (s !== this._status) {\n            this._status = s\n            this.emit(CHANGE)\n        }\n    }\n\n    // debugging\n    trace(message: string, context: VMTraceContext = {}) {\n        this.emit(TRACE, { message, context })\n    }\n\n    watch(sourceId: string, value: WatchValueType) {\n        this._watch[sourceId] = value\n        this.emit(VM_WATCH_CHANGE, sourceId)\n    }\n\n    writeLog(sourceId: string, value: WatchValueType) {\n        const s = value + \"\"\n        const last = this._log[this._log.length - 1]\n        if (last?.text === s) last.count++\n        else this._log.push({ text: value + \"\", count: 1 })\n        while (this._log.length > MAX_LOG) this._log.shift()\n        this.emit(VM_LOG_ENTRY, sourceId)\n    }\n\n    lookupWatch(sourceId: string) {\n        return this._watch[sourceId]\n    }\n\n    async setBreakpointsAsync(breaks: string[]) {\n        await this._breaksMutex.acquire(async () => {\n            this._breaks = {}\n            breaks.forEach(b => {\n                this._breaks[b] = true\n            })\n        })\n    }\n\n    async clearBreakpointsAsync() {\n        await this._breaksMutex.acquire(async () => {\n            this._breaks = {}\n        })\n    }\n\n    async breakpointOnAsync(id: string) {\n        let ret = false\n        await this._breaksMutex.acquire(async () => {\n            ret = !!this._breaks?.[id]\n        })\n        return ret\n    }\n\n    // utility called by handlerRunner\n    async sleepAsync(\n        h: VMHandlerRunner,\n        ms: number,\n        handler: VMHandler = undefined\n    ) {\n        assert(h.status === VMInternalStatus.Sleeping)\n        await this._sleepMutex.acquire(async () => {\n            const id = setTimeout(() => {\n                this.emit(VM_WAKE_SLEEPER, h ? h : handler)\n            }, ms)\n            this._sleepQueue.push({ ms, handlerRunner: h, id, handler })\n        })\n    }\n\n    async startAsync() {\n        if (this.status !== VMStatus.Stopped) return // already running\n        this.trace(\"start\")\n        try {\n            this.roleManager.setRoles(this._roles)\n            await this._waitRunMutex.acquire(async () => {\n                this._waitQueue = this._handlerRunners.slice(0)\n                this._waitQueue.forEach(h => h.reset())\n                this._runQueue = []\n                this._everyQueue = []\n                this.stopSleepers()\n                // make sure to have another handler for every\n                /*\n                for (const h of this._waitQueue) {\n                    if (isEveryHandler(h.handler)) {\n                        const dup = new VMHandlerRunner(\n                            this,\n                            undefined,\n                            this._env,\n                            h.handler\n                        )\n                        dup.reset()\n                        this._everyQueue.push(dup)\n                    }\n                }*/\n            })\n            this.clearBreakpointsAsync()\n            this.setStatus(VMStatus.Running)\n            this.waitingToRunning()\n            this.runAsync()\n        } catch (e) {\n            console.debug(e)\n            this.emit(VM_INTERNAL_ERROR, e)\n        }\n    }\n\n    cancel() {\n        if (this.status === VMStatus.Stopped) return // nothing to cancel\n        this.setStatus(VMStatus.Stopped)\n        this.trace(\"cancelled\")\n    }\n\n    async resumeAsync() {\n        if (this.status !== VMStatus.Paused) return\n        this.trace(\"resume\")\n        this.setStatus(VMStatus.Running)\n        await this.runAsync()\n    }\n\n    private async getCurrentRunner() {\n        return await this._waitRunMutex.acquire(async () => {\n            if (this._runQueue.length) return this._runQueue[0]\n            return undefined\n        })\n    }\n\n    async stepAsync() {\n        if (this.status !== VMStatus.Paused) return\n        this.trace(\"step\")\n        const h = await this.getCurrentRunner()\n        if (h) {\n            await this.runHandlerAsync(h, true)\n            await this.postProcessHandler(h)\n            const newHead = await this.getCurrentRunner()\n            if (newHead && newHead !== h) {\n                this.emitBreakpoint(newHead)\n            }\n        }\n    }\n\n    private _in_run = false\n    private async runAsync() {\n        if (this.status === VMStatus.Stopped) return\n        if (this._in_run) return\n        this.trace(\"run\")\n        this._in_run = true\n        try {\n            let h: VMHandlerRunner = undefined\n            while (\n                this.status === VMStatus.Running &&\n                (h = await this.getCurrentRunner())\n            ) {\n                assert(!h.atTop)\n                await this.runHandlerAsync(h)\n                await this.postProcessHandler(h)\n            }\n        } catch (e) {\n            console.debug(e)\n            this.emit(VM_INTERNAL_ERROR, e)\n        }\n        this._in_run = false\n        this.trace(\"run end\")\n    }\n\n    private emitBreakpoint(h: VMHandlerRunner) {\n        this.emit(\n            VM_BREAKPOINT,\n            h,\n            h.status === VMInternalStatus.Completed\n                ? \"\"\n                : h.command.gc?.sourceId\n        )\n    }\n\n    private async runHandlerAsync(h: VMHandlerRunner, oneStep = false) {\n        try {\n            const brkCommand = await h.runToCompletionAsync(oneStep)\n            if ((brkCommand && !oneStep) || this.status === VMStatus.Paused) {\n                this.setStatus(VMStatus.Paused)\n                this.emitBreakpoint(h)\n            }\n            if (h.status === VMInternalStatus.Completed) {\n                h.reset()\n            }\n        } catch (e) {\n            if (e instanceof VMException) {\n                const ex = e as VMException\n                if (ex.code === VMExceptionCode.RoleNoService)\n                    this.emit(VM_ROLE_MISSING, (e as VMException).data)\n            } else {\n                console.debug(e)\n                this.emit(VM_INTERNAL_ERROR, e)\n            }\n            // on handler error, reset the handler\n            h.reset()\n        }\n    }\n\n    private async postProcessHandler(h: VMHandlerRunner) {\n        if (\n            h.status === VMInternalStatus.Ready ||\n            h.status === VMInternalStatus.Sleeping ||\n            h.status === VMInternalStatus.Stopped\n        ) {\n            let done: VMHandlerRunner = undefined\n            await this._waitRunMutex.acquire(async () => {\n                assert(!!this._runQueue.length)\n                assert(h === this._runQueue[0])\n                done = this._runQueue.shift()\n                const moveToWait = h.status === VMInternalStatus.Ready\n                if (moveToWait && !isEveryHandler(h.handler)) {\n                    this._waitQueue.push(done)\n                    done = undefined\n                }\n            })\n            if (\n                done &&\n                h.status === VMInternalStatus.Ready &&\n                isEveryHandler(h.handler)\n            ) {\n                if (this.status === VMStatus.Running)\n                    await this.runHandlerAsync(h)\n                else if (this.status === VMStatus.Paused) {\n                    await this._waitRunMutex.acquire(async () => {\n                        this._runQueue.unshift(h)\n                        // this.emitBreakpoint(h)\n                    })\n                }\n            }\n        }\n    }\n\n    // call this whenever some event/change arises\n    private async waitingToRunning() {\n        if (this.status !== VMStatus.Stopped) {\n            this.trace(\"waiting to running - try\")\n            let waitCopy: VMHandlerRunner[] = undefined\n            await this._waitRunMutex.acquire(async () => {\n                if (this.status === VMStatus.Paused && this._runQueue.length)\n                    return\n                waitCopy = this._waitQueue.slice(0)\n            })\n            if (!waitCopy) return\n\n            this.trace(\"waiting to running - start\")\n            const handlersStarted: VMHandler[] = []\n            const newRunners: VMHandlerRunner[] = []\n            const sleepingRunners: VMHandlerRunner[] = []\n            for (const h of waitCopy) {\n                await this.runHandlerAsync(h, true)\n                if (h.status === VMInternalStatus.Sleeping) {\n                    sleepingRunners.push(h)\n                } else if (\n                    !h.atTop &&\n                    handlersStarted.findIndex(hs => hs === h.handler) === -1\n                ) {\n                    newRunners.push(h)\n                    handlersStarted.push(h.handler)\n                }\n            }\n            await this._waitRunMutex.acquire(async () => {\n                newRunners.forEach(h => {\n                    this._runQueue.push(h)\n                    const index = this._waitQueue.indexOf(h)\n                    if (index >= 0) this._waitQueue.splice(index, 1)\n                })\n                sleepingRunners.forEach(h => {\n                    const index = this._waitQueue.indexOf(h)\n                    if (index >= 0) this._waitQueue.splice(index, 1)\n                })\n            })\n            this._env.consumeEvent()\n            this.runAsync()\n        }\n    }\n\n    private async stopSleepers() {\n        await this._sleepMutex.acquire(async () => {\n            for (const s of this._sleepQueue) {\n                clearTimeout(s.id)\n            }\n            this._sleepQueue = []\n        })\n    }\n\n    private async wakeSleeper(h: VMHandlerRunner | VMHandler) {\n        try {\n            // let handlerMs: number = undefined\n            let handlerRunner: VMHandlerRunner = undefined\n            // let handler: VMHandler = undefined\n            await this._sleepMutex.acquire(async () => {\n                const index = this._sleepQueue.findIndex(\n                    p => p?.handlerRunner === h // || p?.handler === h\n                )\n                assert(index >= 0)\n                if (index >= 0) {\n                    const p = this._sleepQueue[index]\n                    //  handlerMs = p.ms\n                    handlerRunner = p.handlerRunner\n                    // handler = p?.handler\n                    this._sleepQueue.splice(index, 1)\n                    // clearTimeout(p.id)\n                }\n            })\n            if (this.status === VMStatus.Stopped) return\n            // this logic is to deal with starting a handler rather than a runner\n            await this._waitRunMutex.acquire(async () => {\n                /*\n                if (!handlerRunner && isEveryHandler(handler)) {\n                    const index = this._everyQueue.findIndex(\n                        h => h.handler === handler\n                    )\n                    if (index >= 0) {\n                        handlerRunner = this._everyQueue[index]\n                        this._everyQueue.splice(index, 1)\n                        handlerRunner.gotoTop()\n                    }\n                }*/\n                if (handlerRunner) {\n                    // transition to the run queue\n                    handlerRunner.wake()\n                    this._runQueue.push(handlerRunner)\n                }\n            })\n            /*\n            const theHandler = handlerRunner?.handler || handler\n            if (isEveryHandler(theHandler)) {\n                // setup next\n                this.sleepAsync(undefined, handlerMs, theHandler)\n            }*/\n            if (handlerRunner) {\n                if (this.status === VMStatus.Running) {\n                    this.trace(\"wake sleeper run\")\n                    this.runAsync()\n                } else if (this.status === VMStatus.Paused) {\n                    this.emitBreakpoint(await this.getCurrentRunner())\n                }\n            }\n        } catch (e) {\n            console.debug(e)\n            this.emit(VM_INTERNAL_ERROR, e)\n        }\n    }\n\n    private initializeRoleManagement() {\n        // adding a (role,service) binding\n        const addRoleService = (role: string) => {\n            const service = this.roleManager.getService(role)\n            if (service) {\n                this._env.serviceChanged(role, service)\n            }\n        }\n        // initialize\n        this.roleManager.roles.forEach(r => {\n            if (this._roles.find(rv => rv.role === r.role)) {\n                addRoleService(r.role)\n            }\n        })\n        this.mount(\n            this.roleManager.subscribe(ROLE_BOUND, async (role: string) => {\n                addRoleService(role)\n            })\n        )\n        this.mount(\n            this.roleManager.subscribe(ROLE_UNBOUND, (role: string) => {\n                this._env.serviceChanged(role, undefined)\n            })\n        )\n    }\n}\n","import { useContext, useEffect, useState } from \"react\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport { VMProgram } from \"../../../jacdac-ts/src/vm/ir\"\nimport {\n    VMProgramRunner,\n    VMTraceContext,\n} from \"../../../jacdac-ts/src/vm/runner\"\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\nimport AppContext from \"../AppContext\"\nimport { ERROR, TRACE } from \"../../../jacdac-ts/src/jdom/constants\"\nimport Flags from \"../../../jacdac-ts/src/jdom/flags\"\nimport RoleManager from \"../../../jacdac-ts/src/servers/rolemanager\"\n\nexport default function useVMRunner(\n    roleManager: RoleManager,\n    program: VMProgram,\n    autoRun: boolean\n) {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const { setError } = useContext(AppContext)\n    const [runner, setRunner] = useState<VMProgramRunner>()\n    const [_autoStart, _setAutoStart] = useState<boolean>(!!autoRun)\n\n    const run = async () => {\n        _setAutoStart(!!autoRun)\n        await runner.startAsync()\n    }\n    const cancel = async () => {\n        _setAutoStart(false)\n        runner.cancel()\n    }\n\n    // auto start\n    useEffect(() => {\n        if (_autoStart && runner) runner.startAsync()\n        return () => runner?.cancel()\n    }, [runner, _autoStart])\n\n    // create runner\n    useEffect(() => {\n        try {\n            const newTestRunner =\n                program && new VMProgramRunner(bus, roleManager, program)\n            setRunner(newTestRunner)\n\n            return () => newTestRunner?.unmount()\n        } catch (e) {\n            console.debug(e)\n            setRunner(undefined)\n        }\n    }, [roleManager, program])\n\n    // errors\n    useEffect(() => runner?.subscribe(ERROR, e => setError(e)), [runner])\n    // traces\n    const handleTrace = (value: {\n        message: string\n        context: VMTraceContext\n    }) => {\n        const { message, context } = value\n        if (Flags.diagnostics) console.debug(`vm> ${message}`, context)\n    }\n    useEffect(\n        () =>\n            runner?.subscribe<{ message: string; context: VMTraceContext }>(\n                TRACE,\n                handleTrace\n            ),\n        [runner]\n    )\n\n    return { runner, run, cancel }\n}\n","import { Grid, Typography } from \"@material-ui/core\"\nimport React from \"react\"\nimport { VMProgram } from \"../../../jacdac-ts/src/vm/ir\"\nimport CodeBlock from \"../CodeBlock\"\n\nexport default function VMDiagnostics(props: { program: VMProgram }) {\n    const { program } = props\n    return (\n        <Grid item xs={12}>\n            <Typography variant=\"subtitle1\">VM</Typography>\n            <CodeBlock\n                className=\"json\"\n                downloadName={\"test.json.vm\"}\n                downloadText={JSON.stringify(program, null, 2)}\n            >\n                {JSON.stringify(program, null, 2)}\n            </CodeBlock>\n        </Grid>\n    )\n}\n","import { Theme } from \"@material-ui/core\"\nimport { withPrefix } from \"gatsby\"\nimport {\n    humanify,\n    isNumericType,\n} from \"../../../../jacdac-ts/jacdac-spec/spectool/jdspec\"\nimport {\n    BuzzerCmd,\n    JoystickReg,\n    ServoReg,\n    SRV_BOOTLOADER,\n    SRV_BUZZER,\n    SRV_CONTROL,\n    SRV_HID_KEYBOARD,\n    SRV_JOYSTICK,\n    SRV_LED,\n    SRV_LED_MATRIX,\n    SRV_LOGGER,\n    SRV_PROTO_TEST,\n    SRV_ROLE_MANAGER,\n    SRV_SERVO,\n    SRV_SETTINGS,\n    SRV_SEVEN_SEGMENT_DISPLAY,\n    SystemEvent,\n    SystemReg,\n} from \"../../../../jacdac-ts/src/jdom/constants\"\nimport Flags from \"../../../../jacdac-ts/src/jdom/flags\"\nimport {\n    isCommand,\n    isEvent,\n    isRegister,\n    isSensor,\n    serviceSpecificationFromName,\n    serviceSpecifications,\n} from \"../../../../jacdac-ts/src/jdom/spec\"\nimport {\n    arrayConcatMany,\n    splitFilter,\n    toMap,\n    uniqueMap,\n} from \"../../../../jacdac-ts/src/jdom/utils\"\nimport {\n    toIdentifier,\n    toMemberExpression,\n} from \"../../../../jacdac-ts/src/vm/compile\"\nimport { VMError } from \"../../../../jacdac-ts/src/vm/ir\"\nimport KeyboardKeyField from \"../fields/KeyboardKeyField\"\nimport LEDColorField from \"../fields/LEDColorField\"\nimport LEDMatrixField from \"../fields/LEDMatrixField\"\nimport NoteField from \"../fields/NoteField\"\nimport ServoAngleField from \"../fields/ServoAngleField\"\nimport {\n    BlockDefinition,\n    BlockReference,\n    BOOLEAN_TYPE,\n    CategoryDefinition,\n    CODE_STATEMENT_TYPE,\n    CommandBlockDefinition,\n    CustomBlockDefinition,\n    EventBlockDefinition,\n    EventFieldDefinition,\n    InputDefinition,\n    JSON_TYPE,\n    NUMBER_TYPE,\n    OptionsInputDefinition,\n    RegisterBlockDefinition,\n    resolveServiceBlockDefinition,\n    ServiceBlockDefinition,\n    STRING_TYPE,\n    ValueInputDefinition,\n    VariableInputDefinition,\n} from \"../toolbox\"\nimport { ExpressionWithErrors, makeVMBase } from \"../../vm/VMgenerator\"\nimport BlockDomainSpecificLanguage, {\n    CompileCommandToVMOptions,\n    CompileEventToVMOptions,\n    CompileEventToVMResult,\n    CompileExpressionToVMOptions,\n    CreateBlocksOptions,\n    CreateCategoryOptions,\n} from \"./dsl\"\n\nconst SET_STATUS_LIGHT_BLOCK = \"jacdac_set_status_light\"\nconst ROLE_BOUND_EVENT_BLOCK = \"jacdac_role_bound_event\"\nconst ROLE_BOUND_BLOCK = \"jacdac_role_bound\"\n\nfunction isBooleanField(field: jdspec.PacketMember) {\n    return field.type === \"bool\"\n}\nfunction isStringField(field: jdspec.PacketMember) {\n    return field.type === \"string\"\n}\nfunction toBlocklyType(field: jdspec.PacketMember) {\n    return field.encoding === \"JSON\"\n        ? JSON_TYPE\n        : isBooleanField(field)\n        ? BOOLEAN_TYPE\n        : isStringField(field)\n        ? STRING_TYPE\n        : isNumericType(field)\n        ? NUMBER_TYPE\n        : undefined\n}\nfunction enumInfo(srv: jdspec.ServiceSpec, field: jdspec.PacketMember) {\n    const e = srv.enums?.[field.type]\n    return e\n}\n\nconst ignoredServices = [\n    SRV_CONTROL,\n    SRV_LOGGER,\n    SRV_ROLE_MANAGER,\n    SRV_PROTO_TEST,\n    SRV_BOOTLOADER,\n]\nconst ignoredEvents = [SystemEvent.StatusCodeChanged]\nconst includedRegisters = [\n    SystemReg.Reading,\n    SystemReg.Value,\n    SystemReg.Intensity,\n]\n\nconst customMessages = [\n    {\n        service: SRV_JOYSTICK,\n        register: JoystickReg.Direction,\n        field: \"buttons\",\n        get: \"is %1 %2 pressed\",\n    },\n]\n\nconst commandColor = \"#8c6a1d\"\n\nexport class ServicesBlockDomainSpecificLanguage\n    implements BlockDomainSpecificLanguage\n{\n    id = \"jacdacServices\"\n    supportedServices: jdspec.ServiceSpec[] = []\n    private _serviceBlocks: ServiceBlockDefinition[]\n    private _eventFieldBlocks: EventFieldDefinition[]\n    private _runtimeBlocks: BlockDefinition[]\n\n    private createServiceColor(theme: Theme) {\n        const sensorColor = theme.palette.success.main\n        const otherColor = theme.palette.info.main\n        const serviceColor = (srv: jdspec.ServiceSpec) =>\n            isSensor(srv) ? sensorColor : otherColor\n        return serviceColor\n    }\n\n    createBlocks(options: CreateBlocksOptions) {\n        const { theme } = options\n        const serviceColor = this.createServiceColor(theme)\n        // blocks\n        const customShadows = [\n            {\n                serviceClass: SRV_SERVO,\n                kind: \"rw\",\n                identifier: ServoReg.Angle,\n                field: \"_\",\n                shadow: <BlockDefinition>{\n                    kind: \"block\",\n                    type: ServoAngleField.SHADOW.type,\n                },\n            },\n            {\n                serviceClass: SRV_BUZZER,\n                kind: \"command\",\n                identifier: BuzzerCmd.PlayNote,\n                field: \"frequency\",\n                shadow: <BlockDefinition>{\n                    kind: \"block\",\n                    type: NoteField.SHADOW.type,\n                },\n            },\n        ]\n        const lookupCustomShadow = (\n            service: jdspec.ServiceSpec,\n            info: jdspec.PacketInfo,\n            field: jdspec.PacketMember\n        ) =>\n            customShadows.find(\n                cs =>\n                    cs.serviceClass === service.classIdentifier &&\n                    cs.kind == info.kind &&\n                    cs.identifier === info.identifier &&\n                    cs.field == field.name\n            )?.shadow\n\n        const serviceHelp = (service: jdspec.ServiceSpec) =>\n            withPrefix(`/services/${service.shortId}`)\n        const fieldsSupported = (pkt: jdspec.PacketInfo) =>\n            pkt.fields.every(toBlocklyType)\n        const fieldName = (\n            reg: jdspec.PacketInfo,\n            field: jdspec.PacketMember\n        ) => (field.name === \"_\" ? reg.name : field.name)\n        const fieldToShadow = (\n            service: jdspec.ServiceSpec,\n            info: jdspec.PacketInfo,\n            field: jdspec.PacketMember\n        ): BlockReference =>\n            lookupCustomShadow(service, info, field) ||\n            (isBooleanField(field)\n                ? { kind: \"block\", type: \"jacdac_on_off\" }\n                : isStringField(field)\n                ? { kind: \"block\", type: \"text\" }\n                : field.unit === \"\"\n                ? {\n                      kind: \"block\",\n                      type: \"jacdac_angle\",\n                  }\n                : field.unit === \"/\"\n                ? { kind: \"block\", type: \"jacdac_ratio\" }\n                : /^%/.test(field.unit)\n                ? { kind: \"block\", type: \"jacdac_percent\" }\n                : field.type === \"u8\"\n                ? { kind: \"block\", type: \"jacdac_byte\" }\n                : {\n                      kind: \"block\",\n                      type: \"math_number\",\n                      value: field.defaultValue || 0,\n                      min: field.typicalMin || field.absoluteMin,\n                      max: field.typicalMax || field.absoluteMax,\n                  })\n        const variableName = (srv: jdspec.ServiceSpec) =>\n            `${humanify(srv.camelName).toLowerCase()} 1`\n        const fieldVariable = (\n            service: jdspec.ServiceSpec\n        ): VariableInputDefinition => ({\n            type: \"field_variable\",\n            name: \"role\",\n            variable: variableName(service),\n            variableTypes: [service.shortId],\n            defaultType: service.shortId,\n        })\n        const fieldsToFieldInputs = (info: jdspec.PacketInfo) =>\n            info.fields.map(field => ({\n                type: \"input_value\",\n                name: fieldName(info, field),\n                check: toBlocklyType(field),\n            }))\n        const fieldsToValues = (\n            service: jdspec.ServiceSpec,\n            info: jdspec.PacketInfo\n        ) =>\n            toMap<jdspec.PacketMember, BlockReference | BlockDefinition>(\n                info.fields,\n                field => fieldName(info, field),\n                field => fieldToShadow(service, info, field)\n            )\n        const fieldsToMessage = (info: jdspec.PacketInfo) =>\n            info.fields\n                .map((field, i) => `${humanify(field.name)} %${2 + i}`)\n                .join(\" \")\n        const isEnabledRegister = (info: jdspec.PacketInfo) =>\n            info.fields.length === 1 &&\n            info.fields[0].type === \"bool\" &&\n            info.name === \"enabled\"\n        const customMessage = (\n            srv: jdspec.ServiceSpec,\n            reg: jdspec.PacketInfo,\n            field: jdspec.PacketMember\n        ) =>\n            customMessages.find(\n                m =>\n                    m.service === srv.classIdentifier &&\n                    m.register === reg.identifier &&\n                    m.field === field.name\n            )\n\n        const allServices = serviceSpecifications()\n        this.supportedServices = allServices\n            .filter(\n                service =>\n                    !/^_/.test(service.shortId) &&\n                    service.status !== \"deprecated\"\n            )\n            .filter(\n                service => ignoredServices.indexOf(service.classIdentifier) < 0\n            )\n        const resolveService = (cls: number): jdspec.ServiceSpec[] =>\n            allServices.filter(srv => srv.classIdentifier === cls)\n        const registers = arrayConcatMany(\n            this.supportedServices.map(service =>\n                service.packets\n                    .filter(\n                        pkt =>\n                            isRegister(pkt) &&\n                            !pkt.lowLevel &&\n                            includedRegisters.indexOf(pkt.identifier) > -1\n                    )\n                    .map(register => ({\n                        service,\n                        register,\n                    }))\n            )\n        )\n        const events = this.supportedServices\n            .map(service => ({\n                service,\n                events: service.packets.filter(\n                    pkt =>\n                        isEvent(pkt) &&\n                        !pkt.lowLevel &&\n                        ignoredEvents.indexOf(pkt.identifier) < 0\n                ),\n            }))\n            .filter(kv => !!kv.events.length)\n        const commands = arrayConcatMany(\n            this.supportedServices.map(service =>\n                service.packets\n                    .filter(\n                        pkt =>\n                            isCommand(pkt) &&\n                            !pkt.lowLevel &&\n                            fieldsSupported(pkt)\n                    )\n                    .map(pkt => ({\n                        service,\n                        command: pkt,\n                    }))\n            )\n        )\n\n        const customBlockDefinitions: CustomBlockDefinition[] = [\n            ...resolveService(SRV_HID_KEYBOARD).map(\n                service =>\n                    <CustomBlockDefinition>{\n                        kind: \"block\",\n                        type: `key`,\n                        message0: `%1 %2 key %3`,\n                        args0: [\n                            fieldVariable(service),\n                            <OptionsInputDefinition>{\n                                type: \"field_dropdown\",\n                                name: \"action\",\n                                options: [\n                                    [\"press\", \"press\"],\n                                    [\"down\", \"down\"],\n                                    [\"up\", \"up\"],\n                                ],\n                            },\n                            {\n                                type: KeyboardKeyField.KEY,\n                                name: \"combo\",\n                            },\n                        ],\n                        colour: serviceColor(service),\n                        inputsInline: true,\n                        previousStatement: CODE_STATEMENT_TYPE,\n                        nextStatement: CODE_STATEMENT_TYPE,\n                        tooltip: `Send a keyboard key combo`,\n                        helpUrl: serviceHelp(service),\n                        service,\n                        expression: `role.key(combo.selectors, combo.modifiers, action)`,\n                        template: \"custom\",\n                    }\n            ),\n            ...resolveService(SRV_LED).map(\n                service =>\n                    <CustomBlockDefinition>{\n                        kind: \"block\",\n                        type: `fade`,\n                        message0: `fade %1 to %2 at speed %3`,\n                        args0: [\n                            fieldVariable(service),\n                            {\n                                type: \"input_value\",\n                                name: \"color\",\n                                check: \"Number\",\n                            },\n                            {\n                                type: \"input_value\",\n                                name: \"speed\",\n                                check: \"Number\",\n                            },\n                        ],\n                        values: {\n                            color: {\n                                kind: \"block\",\n                                type: LEDColorField.SHADOW.type,\n                            },\n                            speed: {\n                                kind: \"block\",\n                                type: \"jacdac_ratio\",\n                            },\n                        },\n                        colour: serviceColor(service),\n                        inputsInline: true,\n                        previousStatement: CODE_STATEMENT_TYPE,\n                        nextStatement: CODE_STATEMENT_TYPE,\n                        tooltip: `Fade LED color`,\n                        helpUrl: serviceHelp(service),\n                        service,\n                        expression: `role.animate((color >> 16) & 0xff, (color >> 8) & 0xff, (color >> 0) & 0xff, speed * 0xff)`,\n                        template: \"custom\",\n                    }\n            ),\n            ...resolveService(SRV_SEVEN_SEGMENT_DISPLAY).map(\n                service =>\n                    <CustomBlockDefinition>{\n                        kind: \"block\",\n                        type: `set_digits`,\n                        message0: `set %1 digits to %2`,\n                        args0: [\n                            fieldVariable(service),\n                            {\n                                type: \"input_value\",\n                                name: \"digits\",\n                                check: \"Number\",\n                            },\n                        ],\n                        values: {\n                            digits: {\n                                kind: \"block\",\n                                type: \"math_number\",\n                            },\n                        },\n                        colour: serviceColor(service),\n                        inputsInline: true,\n                        previousStatement: CODE_STATEMENT_TYPE,\n                        nextStatement: CODE_STATEMENT_TYPE,\n                        tooltip: `Display a number of the screen`,\n                        helpUrl: serviceHelp(service),\n                        service,\n                        // encode digits\n                        template: \"custom\",\n                    }\n            ),\n            ...resolveService(SRV_LED_MATRIX).map(\n                service =>\n                    <CustomBlockDefinition>{\n                        kind: \"block\",\n                        type: `show_leds`,\n                        message0: `show %1 leds %2`,\n                        args0: [\n                            fieldVariable(service),\n                            {\n                                type: LEDMatrixField.KEY,\n                                name: \"leds\",\n                            },\n                        ],\n                        colour: serviceColor(service),\n                        inputsInline: true,\n                        previousStatement: CODE_STATEMENT_TYPE,\n                        nextStatement: CODE_STATEMENT_TYPE,\n                        tooltip: `Display LEDs on the LED matrix`,\n                        helpUrl: serviceHelp(service),\n                        service,\n                        // encode digits\n                        template: \"custom\",\n                    }\n            ),\n        ].map(def => {\n            def.type = `jacdac_custom_${def.service.shortId.toLowerCase()}_${\n                def.type\n            }`\n            return def\n        })\n\n        const eventBlocks = events.map<EventBlockDefinition>(\n            ({ service, events }) => ({\n                kind: \"block\",\n                type: `jacdac_events_${service.shortId}`,\n                message0: `on %1 %2`,\n                args0: [\n                    fieldVariable(service),\n                    <InputDefinition>{\n                        type: \"field_dropdown\",\n                        name: \"event\",\n                        options: events.map(event => [\n                            humanify(event.name),\n                            event.name,\n                        ]),\n                    },\n                ],\n                colour: serviceColor(service),\n                inputsInline: true,\n                nextStatement: CODE_STATEMENT_TYPE,\n                tooltip: `Events for the ${service.name} service`,\n                helpUrl: serviceHelp(service),\n                service,\n                events,\n                template: \"event\",\n            })\n        )\n\n        const registerChangeByEventBlocks = registers\n            .filter(\n                ({ service }) =>\n                    !service.packets.some(\n                        pkt =>\n                            isEvent(pkt) &&\n                            ignoredEvents.indexOf(pkt.identifier) < 0\n                    )\n            )\n            .filter(\n                ({ register }) =>\n                    register.fields.length === 1 &&\n                    isNumericType(register.fields[0]) &&\n                    register.identifier !== SystemReg.Intensity\n            )\n            .map<RegisterBlockDefinition>(({ service, register }) => ({\n                kind: \"block\",\n                type: `jacdac_change_by_events_${service.shortId}_${register.name}`,\n                message0: `on %1 ${humanify(register.name)} change by %2`,\n                args0: [\n                    fieldVariable(service),\n                    ...fieldsToFieldInputs(register),\n                ].filter(v => !!v),\n                values: fieldsToValues(service, register),\n                inputsInline: true,\n                nextStatement: CODE_STATEMENT_TYPE,\n                colour: serviceColor(service),\n                tooltip: `Event raised when ${register.name} changes`,\n                helpUrl: serviceHelp(service),\n                service,\n                register,\n\n                template: \"register_change_event\",\n            }))\n\n        const [registerSimples, registerComposites] = splitFilter(\n            registers,\n            reg => reg.register.fields.length == 1\n        )\n        const [registerSimpleTypes, registerSimpleOthers] = splitFilter(\n            registerSimples,\n            ({ register }) => !!toBlocklyType(register.fields[0])\n        )\n        const registerSimplesGetBlocks =\n            registerSimpleTypes.map<RegisterBlockDefinition>(\n                ({ service, register }) => ({\n                    kind: \"block\",\n                    type: `jacdac_get_simple_${service.shortId}_${register.name}`,\n                    message0:\n                        customMessage(service, register, register.fields[0])\n                            ?.get || `%1 ${humanify(register.name)}`,\n                    args0: [fieldVariable(service)],\n                    inputsInline: true,\n                    output: toBlocklyType(register.fields[0]),\n                    colour: serviceColor(service),\n                    tooltip: register.description,\n                    helpUrl: serviceHelp(service),\n                    service,\n                    register,\n                    field: register.fields[0],\n\n                    template: \"register_get\",\n                })\n            )\n        const registerSimpleEnumTypes = registerSimpleOthers\n            .filter(\n                ({ service, register }) =>\n                    !!enumInfo(service, register.fields[0])\n            )\n            .map(({ service, register }) => ({\n                service,\n                register,\n                field: register.fields[0],\n                einfo: enumInfo(service, register.fields[0]),\n            }))\n        const registerCompositeEnumTypes = arrayConcatMany(\n            registerComposites.map(({ service, register }) =>\n                register.fields\n                    .map(field => ({\n                        service,\n                        register,\n                        field,\n                        einfo: enumInfo(service, field),\n                    }))\n                    .filter(({ einfo }) => !!einfo)\n            )\n        )\n        const registerEnumGetBlocks = [\n            ...registerSimpleEnumTypes,\n            ...registerCompositeEnumTypes,\n        ].map<RegisterBlockDefinition>(\n            ({ service, register, field, einfo }) => ({\n                kind: \"block\",\n                type: `jacdac_get_enum_${service.shortId}_${register.name}_${field.name}`,\n                message0:\n                    customMessage(service, register, field)?.get ||\n                    `%1 ${humanify(register.name)}${\n                        field.name === \"_\" ? \"\" : ` ${field.name}`\n                    } %2`,\n                args0: [\n                    fieldVariable(service),\n                    <OptionsInputDefinition>{\n                        type: \"field_dropdown\",\n                        name: field.name,\n                        options: Object.keys(einfo.members).map(member => [\n                            humanify(member),\n                            member,\n                        ]),\n                    },\n                ],\n                inputsInline: true,\n                output: \"Boolean\",\n                colour: serviceColor(service),\n                tooltip: register.description,\n                helpUrl: serviceHelp(service),\n                service,\n                register,\n                field,\n\n                template: \"register_get\",\n            })\n        )\n\n        const registerNumericsGetBlocks = registerComposites\n            .filter(re => re.register.fields.some(isNumericType))\n            .map<RegisterBlockDefinition>(({ service, register }) => ({\n                kind: \"block\",\n                type: `jacdac_get_numerics_${service.shortId}_${register.name}`,\n                message0: `%1 ${humanify(register.name)}${\n                    register.fields.length > 1 ? ` %2` : \"\"\n                }`,\n                args0: [\n                    fieldVariable(service),\n                    register.fields.length > 1\n                        ? <OptionsInputDefinition>{\n                              type: \"field_dropdown\",\n                              name: \"field\",\n                              options: register.fields\n                                  .filter(f => isNumericType(f))\n                                  .map(field => [\n                                      humanify(field.name),\n                                      fieldName(register, field),\n                                  ]),\n                          }\n                        : undefined,\n                ].filter(v => !!v),\n                inputsInline: true,\n                output: \"Number\",\n                colour: serviceColor(service),\n                tooltip: register.description,\n                helpUrl: serviceHelp(service),\n                service,\n                register,\n\n                template: \"register_get\",\n            }))\n\n        const registerSetBlocks = registers\n            .filter(({ register }) => register.kind === \"rw\")\n            .filter(({ register }) => fieldsSupported(register))\n            .map<RegisterBlockDefinition>(({ service, register }) => ({\n                kind: \"block\",\n                type: `jacdac_set_${service.shortId}_${register.name}`,\n                message0: isEnabledRegister(register)\n                    ? `set %1 %2`\n                    : `set %1 ${register.name} to ${\n                          register.fields.length === 1\n                              ? \"%2\"\n                              : fieldsToMessage(register)\n                      }`,\n                args0: [\n                    fieldVariable(service),\n                    ...fieldsToFieldInputs(register),\n                ],\n                values: fieldsToValues(service, register),\n                inputsInline: true,\n                colour: serviceColor(service),\n                tooltip: register.description,\n                helpUrl: serviceHelp(service),\n                service,\n                register,\n                previousStatement: CODE_STATEMENT_TYPE,\n                nextStatement: CODE_STATEMENT_TYPE,\n\n                template: \"register_set\",\n            }))\n\n        const commandBlocks = commands.map<CommandBlockDefinition>(\n            ({ service, command }) => ({\n                kind: \"block\",\n                type: `jacdac_command_${service.shortId}_${command.name}`,\n                message0: !command.fields.length\n                    ? `${humanify(command.name)} %1`\n                    : `${humanify(command.name)} %1 with ${fieldsToMessage(\n                          command\n                      )}`,\n                args0: [\n                    fieldVariable(service),\n                    ...fieldsToFieldInputs(command),\n                ],\n                values: fieldsToValues(service, command),\n                inputsInline: true,\n                colour: serviceColor(service),\n                tooltip: command.description,\n                helpUrl: serviceHelp(service),\n                service,\n                command,\n                previousStatement: CODE_STATEMENT_TYPE,\n                nextStatement: CODE_STATEMENT_TYPE,\n\n                template: \"command\",\n            })\n        )\n\n        this._serviceBlocks = [\n            ...eventBlocks,\n            ...registerChangeByEventBlocks,\n            ...registerSimplesGetBlocks,\n            ...registerEnumGetBlocks,\n            ...registerNumericsGetBlocks,\n            ...registerSetBlocks,\n            ...customBlockDefinitions,\n            ...commandBlocks,\n        ]\n\n        const eventFieldGroups = [\n            {\n                output: NUMBER_TYPE,\n                filter: isNumericType,\n            },\n            {\n                output: BOOLEAN_TYPE,\n                filter: isBooleanField,\n            },\n            {\n                output: STRING_TYPE,\n                filter: (f: jdspec.PacketMember) =>\n                    isStringField(f) && f.encoding !== \"JSON\",\n            },\n            {\n                output: JSON_TYPE,\n                filter: (f: jdspec.PacketMember) =>\n                    isStringField(f) && f.encoding === \"JSON\",\n            },\n        ]\n        // generate accessor blocks for event data with numbers\n        this._eventFieldBlocks = arrayConcatMany(\n            arrayConcatMany(\n                eventFieldGroups.map(({ output, filter }) =>\n                    events.map(({ service, events }) =>\n                        events\n                            .filter(\n                                event => event.fields.filter(filter).length > 0\n                            )\n                            .map(event => ({ service, event }))\n                            .map(\n                                ({ service, event }) =>\n                                    <EventFieldDefinition>{\n                                        kind: \"block\",\n                                        type: `jacdac_event_field_${output.toLowerCase()}_${\n                                            service.shortId\n                                        }_${event.name}`,\n                                        message0: `${event.name} %1`,\n                                        args0: [\n                                            <InputDefinition>{\n                                                type: \"field_dropdown\",\n                                                name: \"field\",\n                                                options: event.fields.map(\n                                                    field => [\n                                                        humanify(field.name),\n                                                        field.name,\n                                                    ]\n                                                ),\n                                            },\n                                        ],\n                                        colour: serviceColor(service),\n                                        inputsInline: true,\n                                        tooltip: `Data fields of the ${event.name} event`,\n                                        helpUrl: serviceHelp(service),\n                                        service,\n                                        event,\n                                        output,\n                                        template: \"event_field\",\n                                    }\n                            )\n                    )\n                )\n            )\n        )\n\n        this._runtimeBlocks = [\n            {\n                kind: \"block\",\n                type: ROLE_BOUND_EVENT_BLOCK,\n                message0: \"on %1 %2\",\n                args0: [\n                    <VariableInputDefinition>{\n                        type: \"field_variable\",\n                        name: \"role\",\n                        variable: \"any\",\n                        variableTypes: [\n                            \"client\",\n                            ...this.supportedServices.map(\n                                service => service.shortId\n                            ),\n                        ],\n                        defaultType: \"client\",\n                    },\n                    <OptionsInputDefinition>{\n                        type: \"field_dropdown\",\n                        name: \"event\",\n                        options: [\n                            [\"bound\", \"bound\"],\n                            [\"unbound\", \"unbound\"],\n                        ],\n                    },\n                ],\n                inputsInline: true,\n                nextStatement: CODE_STATEMENT_TYPE,\n                colour: commandColor,\n                tooltip: \"Runs code when a role is connected or disconnected\",\n                helpUrl: \"\",\n                template: \"role_binding_event\",\n            },\n            {\n                kind: \"block\",\n                type: ROLE_BOUND_BLOCK,\n                message0: \"%1 bound\",\n                args0: [\n                    <VariableInputDefinition>{\n                        type: \"field_variable\",\n                        name: \"role\",\n                        variable: \"any\",\n                        variableTypes: [\n                            \"client\",\n                            ...this.supportedServices.map(\n                                service => service.shortId\n                            ),\n                        ],\n                        defaultType: \"client\",\n                    },\n                ],\n                output: \"Boolean\",\n                inputsInline: true,\n                colour: commandColor,\n                tooltip: \"Runs code when a role is connected or disconnected\",\n                helpUrl: \"\",\n                template: \"role_bound\",\n            },\n            {\n                kind: \"block\",\n                type: SET_STATUS_LIGHT_BLOCK,\n                message0: \"set %1 status light to %2\",\n                args0: [\n                    <VariableInputDefinition>{\n                        type: \"field_variable\",\n                        name: \"role\",\n                        variable: \"all\",\n                        variableTypes: [\n                            \"client\",\n                            ...this.supportedServices.map(\n                                service => service.shortId\n                            ),\n                        ],\n                        defaultType: \"client\",\n                    },\n                    <ValueInputDefinition>{\n                        type: \"input_value\",\n                        name: \"color\",\n                        check: \"Number\",\n                    },\n                ],\n                values: {\n                    color: {\n                        kind: \"block\",\n                        type: LEDColorField.SHADOW.type,\n                    },\n                },\n                inputsInline: true,\n                previousStatement: CODE_STATEMENT_TYPE,\n                nextStatement: CODE_STATEMENT_TYPE,\n                colour: commandColor,\n                tooltip: \"Sets the color on the status light\",\n                helpUrl: \"\",\n            },\n        ]\n\n        return [\n            ...this._serviceBlocks,\n            ...this._eventFieldBlocks,\n            ...this._runtimeBlocks,\n        ]\n    }\n\n    createCategory(options: CreateCategoryOptions) {\n        const { theme, source, liveServices } = options\n        const serviceColor = this.createServiceColor(theme)\n\n        const blockServices =\n            source?.variables\n                .map(v => v.type)\n                .filter(type => !!serviceSpecificationFromName(type)) || []\n        const usedEvents: Set<jdspec.PacketInfo> = new Set(\n            source?.blocks\n                ?.map(block => ({\n                    block,\n                    definition: resolveServiceBlockDefinition(block.type),\n                }))\n                .filter(({ definition }) => definition?.template === \"event\")\n                .map(({ block, definition }) => {\n                    const eventName = block.inputs[0].fields[\"event\"]\n                        .value as string\n                    return (definition as EventBlockDefinition).events.find(\n                        ev => ev.name === eventName\n                    )\n                })\n                .filter(ev => !!ev)\n        )\n        const jdBlocks = this._serviceBlocks.filter(block => !!block.service)\n        const services = uniqueMap(\n            jdBlocks,\n            block => block.service.shortId,\n            block => block.service\n        )\n\n        const toolboxServices: jdspec.ServiceSpec[] = uniqueMap(\n            Flags.diagnostics\n                ? services\n                : [\n                      ...blockServices\n                          .map(srvid =>\n                              services.find(\n                                  service => service.shortId === srvid\n                              )\n                          )\n                          .filter(srv => !!srv),\n                      ...liveServices.map(srv => srv.specification),\n                  ],\n            srv => srv.shortId,\n            srv => srv\n        )\n            .filter(\n                srv => srv && ignoredServices.indexOf(srv.classIdentifier) < 0\n            )\n            .sort((l, r) => l.name.localeCompare(r.name))\n\n        const servicesCategories: CategoryDefinition[] = toolboxServices\n            .map(service => ({\n                service,\n                serviceBlocks: this._serviceBlocks.filter(\n                    block => block.service === service\n                ),\n            }))\n            .map<CategoryDefinition>(({ service, serviceBlocks }) => ({\n                kind: \"category\",\n                name: service.name,\n                colour: serviceColor(service),\n                contents: [\n                    ...serviceBlocks.map<BlockReference>(block => ({\n                        kind: \"block\",\n                        type: block.type,\n                        values: block.values,\n                    })),\n                    ...this._eventFieldBlocks\n                        .filter(\n                            ev =>\n                                ev.service === service &&\n                                usedEvents.has(ev.event)\n                        )\n                        .map<BlockReference>(block => ({\n                            kind: \"block\",\n                            type: block.type,\n                            values: block.values,\n                        })),\n                ],\n                button: {\n                    kind: \"button\",\n                    text: `Add ${service.name} role`,\n                    callbackKey: `jacdac_add_role_callback_${service.shortId}`,\n                    service,\n                },\n            }))\n            .filter(cat => !!cat.contents?.length)\n\n        const commonCategory: CategoryDefinition = {\n            kind: \"category\",\n            name: \"Roles\",\n            colour: commandColor,\n            contents: [\n                <BlockReference>{\n                    kind: \"block\",\n                    type: ROLE_BOUND_EVENT_BLOCK,\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: ROLE_BOUND_BLOCK,\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: SET_STATUS_LIGHT_BLOCK,\n                    values: {\n                        color: {\n                            kind: \"block\",\n                            type: LEDColorField.SHADOW.type,\n                        },\n                    },\n                },\n            ],\n        }\n\n        return [...servicesCategories, commonCategory]\n    }\n\n    compileEventToVM(options: CompileEventToVMOptions): CompileEventToVMResult {\n        const { block, definition, blockToExpression } = options\n        const { inputs } = block\n        const { template } = definition\n\n        switch (template) {\n            case \"event\": {\n                const { value: role } = inputs[0].fields[\"role\"]\n                const { value: eventName } = inputs[0].fields[\"event\"]\n                return <CompileEventToVMResult>{\n                    expression: <jsep.CallExpression>{\n                        type: \"CallExpression\",\n                        arguments: [\n                            toMemberExpression(\n                                role.toString(),\n                                eventName.toString()\n                            ),\n                        ],\n                        callee: toIdentifier(\"awaitEvent\"),\n                    },\n                    event: {\n                        role: role.toString(),\n                        event: eventName.toString(),\n                    },\n                }\n            }\n            case \"register_change_event\": {\n                const { value: role } = inputs[0].fields[\"role\"]\n                const { register } = definition as RegisterBlockDefinition\n                const { expr, errors } = blockToExpression(\n                    undefined,\n                    inputs[0].child\n                )\n                return <CompileEventToVMResult>{\n                    expression: <jsep.CallExpression>{\n                        type: \"CallExpression\",\n                        arguments: [\n                            toMemberExpression(role.toString(), register.name),\n                            expr,\n                        ],\n                        callee: toIdentifier(\"awaitChange\"),\n                    },\n                    errors,\n                }\n            }\n        }\n\n        return undefined\n    }\n\n    compileExpressionToVM(\n        options: CompileExpressionToVMOptions\n    ): ExpressionWithErrors {\n        const { event, definition, block } = options\n        const { inputs, id } = block\n        const { template } = definition\n        switch (template) {\n            case \"register_get\": {\n                const { register } = definition as RegisterBlockDefinition\n                const { value: role } = inputs[0].fields[\"role\"]\n                const field = inputs[0].fields[\"field\"]\n                return {\n                    expr: toMemberExpression(\n                        role as string,\n                        field\n                            ? toMemberExpression(\n                                  register.name,\n                                  field.value as string\n                              )\n                            : register.name\n                    ),\n                    errors: [],\n                }\n            }\n            case \"event_field\": {\n                const { event: eventInfo } = definition as EventFieldDefinition\n                const errors: VMError[] = []\n                if (event.event !== eventInfo.name) {\n                    errors.push({\n                        sourceId: id,\n                        message: `Event ${eventInfo.name} is not available in this handler.`,\n                    })\n                }\n                const field = inputs[0].fields[\"field\"]\n                return {\n                    expr: toMemberExpression(\n                        event.role,\n                        toMemberExpression(event.event, field.value as string)\n                    ),\n                    errors,\n                }\n            }\n            default:\n                return undefined\n        }\n    }\n\n    compileCommandToVM(options: CompileCommandToVMOptions) {\n        const { event, block, definition, blockToExpression } = options\n        const { template } = definition\n        const { inputs } = block\n        switch (template) {\n            case \"register_set\": {\n                const { register } = definition as RegisterBlockDefinition\n                const { expr, errors } = blockToExpression(\n                    event,\n                    inputs[0].child\n                )\n                const { value: role } = inputs[0].fields.role\n                return {\n                    cmd: makeVMBase(block, {\n                        type: \"CallExpression\",\n                        arguments: [\n                            toMemberExpression(role as string, register.name),\n                            expr,\n                        ],\n                        callee: toIdentifier(\"writeRegister\"),\n                    }),\n                    errors,\n                }\n            }\n            case \"command\": {\n                const { command: serviceCommand } =\n                    definition as CommandBlockDefinition\n                const { value: role } = inputs[0].fields.role\n                const exprsErrors = inputs.map(a =>\n                    blockToExpression(event, a.child)\n                )\n                return {\n                    cmd: makeVMBase(block, {\n                        type: \"CallExpression\",\n                        arguments: exprsErrors.map(p => p.expr),\n                        callee: toMemberExpression(\n                            role as string,\n                            serviceCommand.name\n                        ),\n                    }),\n                    errors: exprsErrors.flatMap(p => p.errors),\n                }\n            }\n        }\n\n        return undefined\n    }\n}\nconst servicesDSL = new ServicesBlockDomainSpecificLanguage()\nexport default servicesDSL\n","import { toIdentifier } from \"../../../../jacdac-ts/src/vm/compile\"\nimport { CmdWithErrors, makeVMBase } from \"../../vm/VMgenerator\"\nimport JDomTreeField from \"../fields/JDomTreeField\"\nimport LogViewField from \"../fields/LogViewField\"\nimport TwinField from \"../fields/TwinField\"\nimport VariablesField from \"../fields/VariablesFields\"\nimport WatchValueField from \"../fields/WatchValueField\"\nimport {\n    BlockReference,\n    InputDefinition,\n    LabelDefinition,\n    VariableInputDefinition,\n} from \"../toolbox\"\nimport BlockDomainSpecificLanguage from \"./dsl\"\nimport servicesDSL from \"./servicesdsl\"\n\nconst colour = \"#888\"\nconst INSPECT_BLOCK = \"jacdac_tools_inspect\"\nconst WATCH_BLOCK = \"jacdac_tools_watch\"\nconst LOG_BLOCK = \"jacdac_tools_log\"\nconst VIEW_LOG_BLOCK = \"jacdac_tools_log_view\"\nconst VARIABLES_BLOCK = \"jacdac_variables_view\"\nexport const TWIN_BLOCK = \"jacdac_tools_twin\"\n\nconst toolsDSL: BlockDomainSpecificLanguage = {\n    id: \"tools\",\n    createBlocks: () => [\n        {\n            kind: \"block\",\n            type: TWIN_BLOCK,\n            message0: `view %1 %2 %3`,\n            args0: [\n                <VariableInputDefinition>{\n                    type: \"field_variable\",\n                    name: \"role\",\n                    variable: \"none\",\n                    variableTypes: [\n                        \"client\",\n                        ...servicesDSL.supportedServices.map(\n                            service => service.shortId\n                        ),\n                    ],\n                    defaultType: \"client\",\n                },\n                {\n                    type: \"input_dummy\",\n                },\n                <InputDefinition>{\n                    type: TwinField.KEY,\n                    name: \"twin\",\n                },\n            ],\n            colour,\n            inputsInline: false,\n            tooltip: `Twin of the selected service`,\n            helpUrl: \"\",\n            template: \"meta\",\n        },\n        {\n            kind: \"block\",\n            type: INSPECT_BLOCK,\n            message0: `inspect %1 %2 %3`,\n            args0: [\n                <VariableInputDefinition>{\n                    type: \"field_variable\",\n                    name: \"role\",\n                    variable: \"none\",\n                    variableTypes: [\n                        \"client\",\n                        ...servicesDSL.supportedServices.map(\n                            service => service.shortId\n                        ),\n                    ],\n                    defaultType: \"client\",\n                },\n                {\n                    type: \"input_dummy\",\n                },\n                <InputDefinition>{\n                    type: JDomTreeField.KEY,\n                    name: \"twin\",\n                },\n            ],\n            colour,\n            inputsInline: false,\n            tooltip: `Inspect a service`,\n            helpUrl: \"\",\n            template: \"meta\",\n        },\n        {\n            kind: \"block\",\n            type: VARIABLES_BLOCK,\n            message0: `variables %1 %2`,\n            args0: [\n                {\n                    type: \"input_dummy\",\n                },\n                {\n                    type: VariablesField.KEY,\n                    name: \"variables\",\n                },\n            ],\n            colour,\n            inputsInline: false,\n            tooltip: `Watch variables values`,\n            helpUrl: \"\",\n            template: \"meta\"\n        },\n        {\n            kind: \"block\",\n            type: WATCH_BLOCK,\n            message0: `watch %1 %2`,\n            args0: [\n                <InputDefinition>{\n                    type: \"input_value\",\n                    name: \"value\",\n                },\n                <InputDefinition>{\n                    type: WatchValueField.KEY,\n                    name: \"watch\",\n                },\n            ],\n            colour,\n            inputsInline: true,\n            tooltip: `Watch a value in the editor`,\n            helpUrl: \"\",\n        },\n        {\n            kind: \"block\",\n            type: LOG_BLOCK,\n            message0: `log %1`,\n            args0: [\n                <InputDefinition>{\n                    type: \"input_value\",\n                    name: \"value\",\n                },\n            ],\n            colour,\n            inputsInline: true,\n            previousStatement: null,\n            nextStatement: null,\n            tooltip: `Log an entry to the console`,\n            helpUrl: \"\",\n        },\n        {\n            kind: \"block\",\n            type: VIEW_LOG_BLOCK,\n            message0: `console %1 %2`,\n            args0: [\n                {\n                    type: \"input_dummy\",\n                },\n                <InputDefinition>{\n                    type: LogViewField.KEY,\n                    name: \"watch\",\n                },\n            ],\n            colour,\n            inputsInline: false,\n            tooltip: `View console content`,\n            template: \"meta\",\n        },\n    ],\n    createCategory: () => [\n        {\n            kind: \"sep\",\n        },\n        {\n            kind: \"category\",\n            name: \"Tools\",\n            colour: colour,\n            contents: [\n                <LabelDefinition>{\n                    kind: \"label\",\n                    text: \"Variables\",\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: VARIABLES_BLOCK,\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: WATCH_BLOCK,\n                },\n                <LabelDefinition>{\n                    kind: \"label\",\n                    text: \"Roles\",\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: TWIN_BLOCK,\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: INSPECT_BLOCK,\n                },\n                <LabelDefinition>{\n                    kind: \"label\",\n                    text: \"Logging\",\n                },\n                {\n                    kind: \"block\",\n                    type: LOG_BLOCK,\n                    values: {\n                        value: { kind: \"block\", type: \"text\" },\n                    },\n                },\n                {\n                    kind: \"block\",\n                    type: VIEW_LOG_BLOCK,\n                },\n            ],\n        },\n    ],\n\n    compileCommandToVM: ({ block, blockToExpression }): CmdWithErrors => {\n        const { type } = block\n        if (type === LOG_BLOCK) {\n            const { inputs } = block\n            const { expr, errors } = blockToExpression(\n                undefined,\n                inputs[0].child\n            )\n            return {\n                cmd: makeVMBase(block, {\n                    type: \"CallExpression\",\n                    arguments: [expr],\n                    callee: toIdentifier(\"log\"),\n                }),\n                errors,\n            }\n        }\n        return undefined\n    },\n    compileEventToVM: ({ block, blockToExpression }) => {\n        const { type } = block\n        if (type === WATCH_BLOCK) {\n            const { inputs } = block\n            const { expr, errors } = blockToExpression(\n                undefined,\n                inputs[0].child\n            )\n            return {\n                expression: <jsep.CallExpression>{\n                    type: \"CallExpression\",\n                    arguments: [expr],\n                    callee: toIdentifier(\"watch\"),\n                },\n                errors,\n                meta: true,\n            }\n        }\n        return undefined\n    },\n}\n\nexport default toolsDSL\n","import React, { useContext } from \"react\"\nimport { Chip, Grid, Tooltip } from \"@material-ui/core\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\nimport DeviceAvatar from \"../devices/DeviceAvatar\"\nimport { serviceSpecificationFromName } from \"../../../jacdac-ts/src/jdom/spec\"\nimport { JDService } from \"../../../jacdac-ts/src/jdom/service\"\nimport {\n    addServiceProvider,\n    serviceProviderDefinitionFromServiceClass,\n} from \"../../../jacdac-ts/src/servers/servers\"\nimport useChange from \"../../jacdac/useChange\"\nimport { BlockSvg, FieldVariable } from \"blockly\"\nimport useServiceServer from \"../hooks/useServiceServer\"\nimport CancelIcon from \"@material-ui/icons/Cancel\"\nimport BlockContext from \"./BlockContext\"\nimport { TWIN_BLOCK } from \"./dsl/toolsdsl\"\n\nfunction RoleChip(props: {\n    role: string\n    service: JDService\n    serviceShortId: string\n    handleRoleClick: () => void\n}) {\n    const { workspace } = useContext(BlockContext)\n    const { role, service, serviceShortId } = props\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const server = useServiceServer(service)\n    const handleRoleClick = () => {\n        // spin off simulator\n        if (!service) {\n            const specification = serviceSpecificationFromName(serviceShortId)\n            if (specification)\n                addServiceProvider(\n                    bus,\n                    serviceProviderDefinitionFromServiceClass(\n                        specification.classIdentifier\n                    )\n                )\n        }\n        // add twin block\n        if (workspace) {\n            // try to find existing twin block\n            let twinBlock = workspace\n                .getTopBlocks(false)\n                .find(\n                    b =>\n                        b.type === TWIN_BLOCK &&\n                        (\n                            b.inputList[0].fieldRow.find(\n                                f => f.name === \"role\"\n                            ) as FieldVariable\n                        )?.getVariable()?.name === role\n                ) as BlockSvg\n            if (!twinBlock) {\n                twinBlock = workspace.newBlock(TWIN_BLOCK) as BlockSvg\n                const variable = workspace.getVariable(role, serviceShortId)\n                console.log(`new twin`, { twinBlock })\n                const field = twinBlock.inputList[0].fieldRow.find(\n                    f => f.name === \"role\"\n                ) as FieldVariable\n                field.setValue(variable.getId())\n                const m = workspace.getMetrics()\n                twinBlock.moveBy(m.viewWidth / 2, m.viewHeight / 3)\n                twinBlock.initSvg()\n                twinBlock.render(false)\n            }\n            workspace.centerOnBlock(twinBlock.id)\n        }\n    }\n\n    const handleDelete = () => bus.removeServiceProvider(server.device)\n    return (\n        <Chip\n            label={role}\n            variant={service ? \"default\" : \"outlined\"}\n            avatar={service && <DeviceAvatar device={service.device} />}\n            onClick={handleRoleClick}\n            onDelete={server ? handleDelete : undefined}\n            deleteIcon={\n                <Tooltip title=\"stop simulator\">\n                    <CancelIcon />\n                </Tooltip>\n            }\n        />\n    )\n}\n\nexport default function BlockRoles() {\n    const { roleManager } = useContext(BlockContext)\n    const roles = useChange(roleManager, _ => _?.roles)\n\n    return (\n        <>\n            {roles?.map(({ role, service, serviceShortId }) => (\n                <Grid item key={role}>\n                    <RoleChip\n                        role={role}\n                        service={service}\n                        serviceShortId={serviceShortId}\n                    />\n                </Grid>\n            ))}\n        </>\n    )\n}\n","import React, { useContext, useEffect, useMemo, useState } from \"react\"\nimport useChange from \"../../jacdac/useChange\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport { VMProgramRunner, VMStatus } from \"../../../jacdac-ts/src/vm/runner\"\nimport PlayArrowIcon from \"@material-ui/icons/PlayArrow\"\nimport StopIcon from \"@material-ui/icons/Stop\"\nimport IconButtonWithTooltip from \"../ui/IconButtonWithTooltip\"\nimport { Chip, Grid } from \"@material-ui/core\"\nimport PauseIcon from \"@material-ui/icons/Pause\"\nimport { arrayConcatMany } from \"../../../jacdac-ts/src/jdom/utils\"\nimport { VM_BREAKPOINT } from \"../../../jacdac-ts/src/vm/events\"\nimport { VMHandler, VMProgram } from \"../../../jacdac-ts/src/vm/ir\"\nimport PlayForWorkIcon from \"@material-ui/icons/PlayForWork\"\nimport useMounted from \"../hooks/useMounted\"\nimport IconButtonWithProgress from \"../ui/IconButtonWithProgress\"\nimport BugReportIcon from \"@material-ui/icons/BugReport\"\nimport BlockContext from \"../blockly/BlockContext\"\n\nfunction useWorkspaceBreakpoints(program: VMProgram) {\n    const { workspace } = useContext(BlockContext)\n    const breakpoints = useMemo(\n        () =>\n            arrayConcatMany(\n                program?.handlers\n                    ?.filter(h => !h.meta) // don't debug watch statements\n                    .map(h => h.commands.map(cmd => cmd.sourceId))\n            )?.filter(id => !!id) || [],\n        [program]\n    )\n    const setBreakpointHighlight = (sourceId: string) => {\n        workspace?.highlightBlock(sourceId)\n    }\n\n    return {\n        breakpoints,\n        setBreakpointHighlight,\n    }\n}\n\nexport default function VMRunnerButtons(props: {\n    runner: VMProgramRunner\n    run: () => Promise<void>\n    cancel: () => Promise<void>\n}) {\n    const { runner, run, cancel } = props\n    const status = useChange(runner, t => t?.status)\n    const stopped = !status || status === VMStatus.Stopped\n    const program = runner?.program\n    const [indeterminate, setIndeterminate] = useState(false)\n    const [breakpoint, setBreakpoint] = useState<string>(undefined)\n    const pausing = breakpoint === \"\"\n    const paused = !!breakpoint?.length\n    const mounted = useMounted()\n    const disabled = indeterminate || !runner\n    const { breakpoints, setBreakpointHighlight } =\n        useWorkspaceBreakpoints(program)\n\n    //console.log(\"runner status\", status)\n\n    const handleRun = async () => {\n        try {\n            setIndeterminate(true)\n            setBreakpoint(undefined)\n            await run()\n        } finally {\n            if (mounted()) setIndeterminate(false)\n        }\n    }\n    const handleCancel = async () => {\n        try {\n            setIndeterminate(true)\n            await runner.clearBreakpointsAsync()\n            setBreakpoint(undefined)\n            await cancel()\n        } finally {\n            if (mounted()) setIndeterminate(false)\n        }\n    }\n    const handleResume = async () => {\n        try {\n            setIndeterminate(true)\n            setBreakpoint(undefined)\n            await runner.clearBreakpointsAsync()\n            await runner.resumeAsync()\n        } finally {\n            if (mounted()) setIndeterminate(false)\n        }\n    }\n    const handlePause = async () => {\n        try {\n            setIndeterminate(true)\n            await runner.setBreakpointsAsync(breakpoints)\n            await runner.resumeAsync()\n            setBreakpoint(\"\")\n        } finally {\n            if (mounted()) setIndeterminate(false)\n        }\n    }\n    const handleStep = () => runner.stepAsync()\n\n    // register breakpoint handler\n    useEffect(\n        () =>\n            runner?.subscribe(\n                VM_BREAKPOINT,\n                (_: VMHandler, sourceId?: string) => {\n                    if (mounted()) setBreakpoint(sourceId)\n                }\n            ),\n        [runner]\n    )\n\n    // setting blockly breakpoint\n    useEffect(() => {\n        setBreakpointHighlight(breakpoint)\n        return () => setBreakpointHighlight(undefined)\n    }, [breakpoint])\n\n    // reset breakpoint in ui when runner, paused mode changes\n    useEffect(() => setBreakpoint(undefined), [runner])\n\n    return (\n        <>\n            <Grid item>\n                <IconButtonWithTooltip\n                    title={paused ? \"resume\" : stopped ? \"start\" : \"stop\"}\n                    disabled={disabled}\n                    color={stopped ? \"primary\" : \"default\"}\n                    onClick={\n                        paused\n                            ? handleResume\n                            : stopped\n                            ? handleRun\n                            : handleCancel\n                    }\n                >\n                    {paused || stopped ? <PlayArrowIcon /> : <StopIcon />}\n                </IconButtonWithTooltip>{\" \"}\n            </Grid>\n            <Grid item>\n                <IconButtonWithProgress\n                    title={pausing ? \"cancel pause\" : paused ? \"step\" : \"pause\"}\n                    disabled={disabled}\n                    indeterminate={pausing}\n                    onClick={\n                        pausing\n                            ? handleResume\n                            : paused\n                            ? handleStep\n                            : handlePause\n                    }\n                >\n                    {paused ? <PlayForWorkIcon /> : <PauseIcon />}\n                </IconButtonWithProgress>\n            </Grid>\n            {(pausing || paused) && (\n                <Grid item>\n                    <Chip\n                        icon={<BugReportIcon />}\n                        label={pausing ? \"pausing\" : \"paused\"}\n                        color={\"secondary\"}\n                    />\n                </Grid>\n            )}\n        </>\n    )\n}\n","import React from \"react\"\nimport IconButtonWithTooltip from \"../ui/IconButtonWithTooltip\"\nimport AddIcon from \"@material-ui/icons/Add\"\nimport { useContext } from \"react\"\nimport AppContext from \"../AppContext\"\n\nexport default function VMStartSimulatorButton() {\n    const { toggleShowDeviceHostsDialog } = useContext(AppContext)\n    return (\n        <IconButtonWithTooltip\n            title=\"start simulator\"\n            onClick={toggleShowDeviceHostsDialog}\n        >\n            <AddIcon />\n        </IconButtonWithTooltip>\n    )\n}\n","import React, { useContext } from \"react\"\nimport SaveIcon from \"@material-ui/icons/Save\"\nimport { Grid, Tooltip } from \"@material-ui/core\"\nimport { IconButton, Link } from \"gatsby-theme-material-ui\"\nimport ImportButton from \"../ImportButton\"\nimport AppContext from \"../AppContext\"\nimport { Xml } from \"blockly\"\nimport VMFile from \"../../../jacdac-ts/src/vm/file\"\nimport BlockContext from \"./BlockContext\"\n\nfunction LoadButton() {\n    const { workspace } = useContext(BlockContext)\n    const { setError } = useContext(AppContext)\n    const disabled = !workspace\n\n    const handleFiles = async (files: File[]) => {\n        const file = files?.[0]\n        if (!file) return\n\n        try {\n            const text = await file.text()\n            const jsfile = JSON.parse(text) as VMFile\n            console.debug(`imported file`, jsfile)\n            const xml = jsfile?.xml\n            if (typeof xml !== \"string\") throw new Error(\"Invalid file format\")\n\n            // try loading xml into a dummy blockly workspace\n            const dom = Xml.textToDom(xml)\n\n            // all good, load in workspace\n            workspace.clear()\n            Xml.domToWorkspace(dom, workspace)\n        } catch (e) {\n            setError(e)\n        }\n    }\n    return (\n        <ImportButton\n            text=\"Open...\"\n            icon={true}\n            disabled={disabled}\n            acceptedFiles={[\"application/json\"]}\n            onFilesUploaded={handleFiles}\n            filesLimit={1}\n        />\n    )\n}\n\nfunction SaveButton() {\n    const { workspaceXml } = useContext(BlockContext)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const json = {\n        xml: workspaceXml,\n    }\n\n    const url = `data:application/json;charset=UTF-8,${encodeURIComponent(\n        JSON.stringify(json)\n    )}`\n\n    return (\n        <Link download=\"jacdac-blocks.json\" href={url}>\n            <Tooltip title={\"Save\"}>\n                <IconButton>\n                    <SaveIcon />\n                </IconButton>\n            </Tooltip>\n        </Link>\n    )\n}\n\nexport default function BlockFileButtons() {\n    return (\n        <>\n            <Grid item>\n                <SaveButton />\n            </Grid>\n            <Grid item>\n                <LoadButton />\n            </Grid>\n        </>\n    )\n}\n","import { Grid } from \"@material-ui/core\"\nimport React from \"react\"\nimport { VMProgramRunner } from \"../../../jacdac-ts/src/vm/runner\"\nimport BlockRoles from \"../blockly/BlockRoles\"\nimport VMRunnerButtons from \"./VMRunnerButtons\"\nimport VMStartSimulatorButton from \"./VMStartSimulatorButton\"\nimport BlockFileButtons from \"../blockly/BlockFileButtons\"\n\nexport default function VMToolbar(props: {\n    runner: VMProgramRunner\n    run: () => Promise<void>\n    cancel: () => Promise<void>\n}) {\n    const { runner, run, cancel } = props\n    return (\n        <Grid\n            container\n            direction=\"row\"\n            spacing={1}\n            alignItems=\"center\"\n            alignContent=\"center\"\n        >\n            <BlockFileButtons />\n            <VMRunnerButtons runner={runner} run={run} cancel={cancel} />\n            <Grid item>\n                <VMStartSimulatorButton />\n            </Grid>\n            <BlockRoles />\n        </Grid>\n    )\n}\n","import { toIdentifier } from \"../../../../jacdac-ts/src/vm/compile\"\nimport { VMCommand } from \"../../../../jacdac-ts/src/vm/ir\"\nimport {\n    BlockReference,\n    CategoryDefinition,\n    CODE_STATEMENT_TYPE,\n    InputDefinition,\n    SeparatorDefinition,\n    ValueInputDefinition,\n} from \"../toolbox\"\nimport { makeVMBase, processErrors } from \"../../vm/VMgenerator\"\nimport BlockDomainSpecificLanguage from \"./dsl\"\n\nconst WAIT_BLOCK = \"jacdac_wait\"\nconst ON_START_BLOCK = \"jacdac_start\"\nconst REPEAT_EVERY_BLOCK = \"jacdac_repeat_every\"\n\nconst colour = \"#4fbac9\"\nconst loopsDsl: BlockDomainSpecificLanguage = {\n    id: \"loops\",\n    createBlocks: () => [\n        {\n            kind: \"block\",\n            type: WAIT_BLOCK,\n            message0: \"wait %1 s\",\n            args0: [\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"time\",\n                    check: \"Number\",\n                },\n            ],\n            inputsInline: true,\n            previousStatement: CODE_STATEMENT_TYPE,\n            nextStatement: CODE_STATEMENT_TYPE,\n            colour,\n            tooltip: \"Wait the desired time\",\n            helpUrl: \"\",\n        },\n        {\n            kind: \"block\",\n            type: ON_START_BLOCK,\n            message0: `on start`,\n            args0: [],\n            colour,\n            inputsInline: true,\n            tooltip: `Runs code when the device starts`,\n            helpUrl: \"\",\n            nextStatement: CODE_STATEMENT_TYPE,\n        },\n        {\n            kind: \"block\",\n            type: REPEAT_EVERY_BLOCK,\n            message0: `repeat every %1s`,\n            args0: [\n                <InputDefinition>{\n                    type: \"input_value\",\n                    name: \"interval\",\n                    check: \"Number\",\n                },\n            ],\n            colour,\n            inputsInline: true,\n            tooltip: `Repeats code at a given interval in seconds`,\n            helpUrl: \"\",\n            nextStatement: CODE_STATEMENT_TYPE,\n        },\n    ],\n\n    createCategory: () => [\n        <SeparatorDefinition>{\n            kind: \"sep\",\n        },\n        <CategoryDefinition>{\n            kind: \"category\",\n            name: \"Events\",\n            colour,\n            contents: [\n                <BlockReference>{\n                    kind: \"block\",\n                    type: REPEAT_EVERY_BLOCK,\n                    values: {\n                        interval: { kind: \"block\", type: \"jacdac_time_picker\" },\n                    },\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: ON_START_BLOCK,\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: WAIT_BLOCK,\n                    values: {\n                        time: { kind: \"block\", type: \"jacdac_time_picker\" },\n                    },\n                },\n            ].filter(b => !!b),\n        },\n    ],\n    compileEventToVM: ({ block, blockToExpression }) => {\n        const { type } = block\n        if (type === ON_START_BLOCK) {\n            return {\n                expression: (\n                    makeVMBase(block, {\n                        type: \"CallExpression\",\n                        arguments: [],\n                        callee: toIdentifier(\"start\"),\n                    }) as VMCommand\n                ).command,\n                errors: processErrors(block, []),\n            }\n        } else if (type === REPEAT_EVERY_BLOCK) {\n            const { inputs } = block\n            const { expr: time, errors } = blockToExpression(\n                undefined,\n                inputs[0].child\n            )\n            return {\n                expression: (\n                    makeVMBase(block, {\n                        type: \"CallExpression\",\n                        arguments: [time],\n                        callee: toIdentifier(\"wait\"),\n                    }) as VMCommand\n                ).command,\n                errors: processErrors(block, errors),\n            }\n        }\n        return undefined\n    },\n    compileCommandToVM: ({ event, block, blockToExpression }) => {\n        const { type } = block\n        if (type === WAIT_BLOCK) {\n            const { inputs } = block\n            {\n                const { expr: time, errors } = blockToExpression(\n                    event,\n                    inputs[0].child\n                )\n                return {\n                    cmd: makeVMBase(block, {\n                        type: \"CallExpression\",\n                        arguments: [time],\n                        callee: toIdentifier(\"wait\"),\n                    }),\n                    errors: processErrors(block, errors),\n                }\n            }\n        }\n        return undefined\n    },\n}\nexport default loopsDsl\n","import { ExpressionWithErrors } from \"../../vm/VMgenerator\"\nimport BlockDomainSpecificLanguage from \"./dsl\"\n\nconst ops = {\n    AND: \"&&\",\n    OR: \"||\",\n    EQ: \"===\",\n    NEQ: \"!==\",\n    LT: \"<\",\n    GT: \">\",\n    LTE: \"<=\",\n    GTE: \">=\",\n    NEG: \"-\",\n}\n\nconst logicDsl: BlockDomainSpecificLanguage = {\n    id: \"logic\",\n    types: [\n        \"variable_if\",\n        \"logic_compare\",\n        \"logic_operation\",\n        \"logic_negate\",\n        \"logic_boolean\",\n    ],\n    createCategory: () => [\n        {\n            kind: \"category\",\n            name: \"Logic\",\n            colour: \"%{BKY_LOGIC_HUE}\",\n            contents: [\n                {\n                    kind: \"block\",\n                    type: \"dynamic_if\",\n                },\n                {\n                    kind: \"block\",\n                    type: \"logic_compare\",\n                    values: {\n                        A: { kind: \"block\", type: \"math_number\" },\n                        B: { kind: \"block\", type: \"math_number\" },\n                    },\n                },\n                {\n                    kind: \"block\",\n                    type: \"logic_operation\",\n                    values: {\n                        A: { kind: \"block\", type: \"logic_boolean\" },\n                        B: { kind: \"block\", type: \"logic_boolean\" },\n                    },\n                },\n                {\n                    kind: \"block\",\n                    type: \"logic_negate\",\n                    values: {\n                        BOOL: { kind: \"block\", type: \"logic_boolean\" },\n                    },\n                },\n                {\n                    kind: \"block\",\n                    type: \"logic_boolean\",\n                },\n            ],\n        },\n    ],\n    compileExpressionToVM: ({\n        event,\n        block,\n        blockToExpressionInner,\n    }): ExpressionWithErrors => {\n        const { type, inputs } = block\n        switch (type) {\n            case \"logic_operation\": {\n                const left = blockToExpressionInner(event, inputs[0].child)\n                const right = blockToExpressionInner(event, inputs[1].child)\n                const op = inputs[1].fields[\"op\"].value as string\n                return {\n                    expr: <jsep.LogicalExpression>{\n                        type: \"LogicalExpression\",\n                        operator: ops[op] || op,\n                        left,\n                        right,\n                    },\n                    errors: [],\n                }\n            }\n            case \"logic_negate\": {\n                const argument = blockToExpressionInner(event, inputs[0].child)\n                return {\n                    expr: <jsep.UnaryExpression>{\n                        type: \"UnaryExpression\",\n                        operator: \"!\",\n                        argument,\n                        prefix: false, // TODO:?\n                    },\n                    errors: [],\n                }\n            }\n            case \"logic_compare\": {\n                const left = blockToExpressionInner(event, inputs[0].child)\n                const right = blockToExpressionInner(event, inputs[1].child)\n                const op = inputs[1].fields[\"op\"].value as string\n                return {\n                    expr: <jsep.BinaryExpression>{\n                        type: \"BinaryExpression\",\n                        operator: ops[op] || op,\n                        left,\n                        right,\n                    },\n                    errors: [],\n                }\n            }\n        }\n        return undefined\n    },\n}\nexport default logicDsl\n","import { ExpressionWithErrors } from \"../../vm/VMgenerator\"\nimport {\n    BlockDefinition,\n    CategoryDefinition,\n    OptionsInputDefinition,\n    ValueInputDefinition,\n} from \"../toolbox\"\nimport BlockDomainSpecificLanguage from \"./dsl\"\n\nconst ops = {\n    NEG: \"-\",\n    ADD: \"+\",\n    MULTIPLY: \"*\",\n    DIVIDE: \"/\",\n    MINUS: \"-\",\n}\n\nconst mathDSL: BlockDomainSpecificLanguage = {\n    id: \"jacdacmath\",\n    createBlocks: () => [\n        {\n            kind: \"block\",\n            type: \"jacdac_math_arithmetic\",\n            message0: \"%1 %2 %3\",\n            args0: [\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"A\",\n                    check: \"Number\",\n                },\n                <OptionsInputDefinition>{\n                    type: \"field_dropdown\",\n                    name: \"OP\",\n                    options: [\n                        [\"%{BKY_MATH_ADDITION_SYMBOL}\", \"ADD\"],\n                        [\"%{BKY_MATH_SUBTRACTION_SYMBOL}\", \"MINUS\"],\n                        [\"%{BKY_MATH_MULTIPLICATION_SYMBOL}\", \"MULTIPLY\"],\n                        [\"%{BKY_MATH_DIVISION_SYMBOL}\", \"DIVIDE\"],\n                    ],\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"B\",\n                    check: \"Number\",\n                },\n            ],\n            inputsInline: true,\n            output: \"Number\",\n            style: \"math_blocks\",\n            helpUrl: \"%{BKY_MATH_ARITHMETIC_HELPURL}\",\n            extensions: [\"math_op_tooltip\"],\n        },\n        {\n            kind: \"block\",\n            type: \"jacdac_math_single\",\n            message0: \"%1 %2\",\n            args0: [\n                <OptionsInputDefinition>{\n                    type: \"field_dropdown\",\n                    name: \"OP\",\n                    options: [\n                        [\"-\", \"NEG\"],\n                        [\"%{BKY_MATH_SINGLE_OP_ABSOLUTE}\", \"ABS\"],\n                    ],\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"NUM\",\n                    check: \"Number\",\n                },\n            ],\n            output: \"Number\",\n            style: \"math_blocks\",\n            helpUrl: \"%{BKY_MATH_SINGLE_HELPURL}\",\n            extensions: [\"math_op_tooltip\"],\n        },\n        {\n            kind: \"block\",\n            type: \"jacdac_math_random\",\n            message0: \"random\",\n            args0: [],\n            output: \"Number\",\n            style: \"math_blocks\",\n            vm: function () {\n                return Math.random()\n            },\n        },\n        <BlockDefinition>{\n            kind: \"block\",\n            type: \"jacdac_math_clamp\",\n            message0: \"clamp %1 in [%2, %3]\",\n            args0: [\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"value\",\n                    check: \"Number\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"minInclusive\",\n                    check: \"Number\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"maxInclusive\",\n                    check: \"Number\",\n                },\n            ],\n            output: \"Number\",\n            style: \"math_blocks\",\n            vm: function (\n                value: number,\n                minInclusive: number,\n                maxInclusive: number\n            ) {\n                return value < minInclusive\n                    ? minInclusive\n                    : value > maxInclusive\n                    ? maxInclusive\n                    : value\n            },\n        },\n        {\n            kind: \"block\",\n            type: \"jacdac_math_map\",\n            message0: \"map %1 from [%2, %3] to [%4, %5]\",\n            args0: [\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"value\",\n                    check: \"Number\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"fromMin\",\n                    check: \"Number\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"fromMax\",\n                    check: \"Number\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"toMin\",\n                    check: \"Number\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"toMax\",\n                    check: \"Number\",\n                },\n            ],\n            output: \"Number\",\n            style: \"math_blocks\",\n        },\n    ],\n    createCategory: () => [\n        <CategoryDefinition>{\n            kind: \"category\",\n            name: \"Math\",\n            colour: \"%{BKY_MATH_HUE}\",\n            contents: [\n                {\n                    kind: \"block\",\n                    type: \"jacdac_math_arithmetic\",\n                    values: {\n                        A: { kind: \"block\", type: \"math_number\" },\n                        B: { kind: \"block\", type: \"math_number\" },\n                    },\n                },\n                {\n                    kind: \"block\",\n                    type: \"jacdac_math_single\",\n                    values: {\n                        NUM: {\n                            kind: \"block\",\n                            type: \"math_number\",\n                        },\n                    },\n                },\n                { kind: \"block\", type: \"jacdac_math_random\" },\n                { kind: \"block\", type: \"jacdac_math_map\" },\n                { kind: \"block\", type: \"math_number\" },\n            ],\n        },\n    ],\n    compileExpressionToVM: ({\n        event,\n        block,\n        blockToExpressionInner,\n    }): ExpressionWithErrors => {\n        const { type, inputs } = block\n        switch (type) {\n            case \"math_single\": // built-in blockly\n            case \"jacdac_math_single\": {\n                const argument = blockToExpressionInner(event, inputs[0].child)\n                const op = inputs[0].fields[\"op\"].value as string\n                return {\n                    expr: <jsep.UnaryExpression>{\n                        type: \"UnaryExpression\",\n                        operator: ops[op] || op,\n                        argument,\n                        prefix: false, // TODO:?\n                    },\n                    errors: [],\n                }\n            }\n            case \"math_arithmetic\": // built-in blockly\n            case \"jacdac_math_arithmetic\": {\n                const left = blockToExpressionInner(event, inputs[0].child)\n                const right = blockToExpressionInner(event, inputs[1].child)\n                const op = inputs[1].fields[\"op\"].value as string\n                return {\n                    expr: <jsep.BinaryExpression>{\n                        type: \"BinaryExpression\",\n                        operator: ops[op] || op,\n                        left,\n                        right,\n                    },\n                    errors: [],\n                }\n            }\n        }\n        return undefined\n    },\n}\n\nexport default mathDSL\n","import {\n    BlockDefinition,\n    BlockReference,\n    BOOLEAN_TYPE,\n    DummyInputDefinition,\n    JSON_TYPE,\n    LabelDefinition,\n    PRIMITIVE_TYPES,\n    StatementInputDefinition,\n    TextInputDefinition,\n    ValueInputDefinition,\n} from \"../toolbox\"\nimport BlockDomainSpecificLanguage, {\n    CompileExpressionToVMOptions,\n} from \"./dsl\"\n\nconst colour = \"#654321\"\nconst JSON_FIELD_TYPE = \"JSONField\"\nconst JSON_OBJECT_BLOCK = \"json_object\"\nconst JSON_FIELD_SET_BLOCK = \"json_field_set\"\nconst JSON_FIELD_GET_TEMPLATE = \"jsonFieldGet\"\nconst JSON_FIELD_VALUE_TYPE = [...PRIMITIVE_TYPES, JSON_TYPE]\nconst JSON_FIELD_HAS_BLOCK = \"json_field_has\"\n\nconst jsonDSL: BlockDomainSpecificLanguage = {\n    id: \"json\",\n    createBlocks: () => [\n        <BlockDefinition>{\n            kind: \"block\",\n            type: JSON_OBJECT_BLOCK,\n            message0: \"{ %1 %2 }\",\n            args0: [\n                <DummyInputDefinition>{\n                    type: \"input_dummy\",\n                },\n                <StatementInputDefinition>{\n                    type: \"input_statement\",\n                    name: \"fields\",\n                    check: JSON_FIELD_TYPE,\n                },\n            ],\n            output: JSON_TYPE,\n            colour,\n        },\n        <BlockDefinition>{\n            kind: \"block\",\n            type: JSON_FIELD_SET_BLOCK,\n            message0: \"%1: %2\",\n            args0: [\n                <TextInputDefinition>{\n                    type: \"field_input\",\n                    name: \"name\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"value\",\n                    check: JSON_FIELD_VALUE_TYPE,\n                },\n            ],\n            previousStatement: JSON_FIELD_TYPE,\n            nextStatement: JSON_FIELD_TYPE,\n            colour,\n        },\n        ...PRIMITIVE_TYPES.map(\n            output =>\n                <BlockDefinition>{\n                    kind: \"block\",\n                    type: `json_field_get_as_${output.toLowerCase()}`,\n                    message0: `%1 [ %2 ] as ${output.toLowerCase()}`,\n                    args0: [\n                        <ValueInputDefinition>{\n                            type: \"input_value\",\n                            name: \"value\",\n                            check: JSON_TYPE,\n                        },\n                        <TextInputDefinition>{\n                            type: \"field_input\",\n                            name: \"name\",\n                        },\n                    ],\n                    output,\n                    colour,\n                    template: JSON_FIELD_GET_TEMPLATE,\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    vm: (value: any, name: string) => value?.[name],\n                }\n        ),\n        {\n            kind: \"block\",\n            type: JSON_FIELD_HAS_BLOCK,\n            message0: `has %1 [ %2 ]`,\n            args0: [\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"value\",\n                    check: JSON_TYPE,\n                },\n                <TextInputDefinition>{\n                    type: \"field_input\",\n                    name: \"name\",\n                },\n            ],\n            output: BOOLEAN_TYPE,\n            colour,\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            vm: (value: any, name: string) => !!value?.[name],\n        },\n    ],\n    createCategory: () => [\n        {\n            kind: \"category\",\n            name: \"JSON\",\n            colour,\n            contents: [\n                <LabelDefinition>{\n                    kind: \"label\",\n                    text: \"Create\",\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: JSON_OBJECT_BLOCK,\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: JSON_FIELD_SET_BLOCK,\n                    values: {\n                        value: {\n                            kind: \"block\",\n                            type: \"math_number\",\n                        },\n                    },\n                },\n                <LabelDefinition>{\n                    kind: \"label\",\n                    text: \"Read\",\n                },\n                ...PRIMITIVE_TYPES.map(output => ({\n                    kind: \"block\",\n                    type: `json_field_get_as_${output.toLowerCase()}`,\n                    values: {\n                        value: <BlockReference>{\n                            kind: \"block\",\n                            type: \"variables_get\",\n                            check: JSON_TYPE,\n                        },\n                    },\n                })),\n                {\n                    kind: \"block\",\n                    type: JSON_FIELD_HAS_BLOCK,\n                },\n            ],\n        },\n    ],\n\n    compileExpressionToVM(options: CompileExpressionToVMOptions) {\n        const { event, block, definition, blockToExpressionInner } = options\n        const { type } = block\n        const { template } = definition\n        if (type === JSON_OBJECT_BLOCK) {\n            // TODO\n        } else if (type === JSON_FIELD_SET_BLOCK) {\n            // TODO\n        } else if (template === JSON_FIELD_GET_TEMPLATE) {\n            // TODO: genearte JSON\n            console.log(\"json expr\", {\n                event,\n                block,\n                definition,\n                blockToExpressionInner,\n            })\n            return undefined\n        }\n        // don't know\n        return undefined\n    },\n}\n\nexport default jsonDSL\n","import { Grid, NoSsr } from \"@material-ui/core\"\nimport React, { useContext, useEffect, useMemo, useState } from \"react\"\nimport Flags from \"../../../jacdac-ts/src/jdom/flags\"\nimport useVMRunner from \"./useVMRunner\"\nimport VMDiagnostics from \"./VMDiagnostics\"\nimport VMToolbar from \"./VMToolbar\"\nimport { VMProgram } from \"../../../jacdac-ts/src/vm/ir\"\nimport BlockContext, { BlockProvider } from \"../blockly/BlockContext\"\nimport BlockDiagnostics from \"../blockly/BlockDiagnostics\"\nimport servicesDSL from \"../blockly/dsl/servicesdsl\"\nimport toolsDSL from \"../blockly/dsl/toolsdsl\"\nimport loopsDsl from \"../blockly/dsl/loopsdsl\"\nimport logicDsl from \"../blockly/dsl/logicdsl\"\nimport mathDSL from \"../blockly/dsl/mathdsl\"\nimport variablesDsl from \"../blockly/dsl/variablesdsl\"\nimport shadowDsl from \"../blockly/dsl/shadowdsl\"\nimport fieldsDsl from \"../blockly/dsl/fieldsdsl\"\nimport workspaceJSONToVMProgram from \"./VMgenerator\"\nimport { BlocklyWorkspaceWithServices } from \"../blockly/WorkspaceContext\"\nimport BlockEditor from \"../blockly/BlockEditor\"\nimport { arrayConcatMany } from \"../../../jacdac-ts/src/jdom/utils\"\nimport jsonDSL from \"../blockly/dsl/jsondsl\"\n\nconst VM_SOURCE_STORAGE_KEY = \"tools:vmeditor\"\nfunction VMEditorWithContext() {\n    const { dsls, workspace, workspaceJSON, roleManager, setWarnings } =\n        useContext(BlockContext)\n    const [program, setProgram] = useState<VMProgram>()\n    const autoStart = false\n    const { runner, run, cancel } = useVMRunner(roleManager, program, autoStart)\n\n    useEffect(() => {\n        try {\n            const newProgram = workspaceJSONToVMProgram(workspaceJSON, dsls)\n            if (JSON.stringify(newProgram) !== JSON.stringify(program))\n                setProgram(newProgram)\n        } catch (e) {\n            console.error(e)\n            setProgram(undefined)\n        }\n    }, [dsls, workspaceJSON])\n    useEffect(\n        () => program && roleManager?.setRoles(program.roles),\n        [roleManager, program]\n    )\n    useEffect(\n        () =>\n            setWarnings(arrayConcatMany(program?.handlers.map(h => h.errors))),\n        [program]\n    )\n\n    useEffect(() => {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const ws = workspace as any as BlocklyWorkspaceWithServices\n        const services = ws?.jacdacServices\n        if (services) {\n            services.runner = runner\n        }\n    }, [workspace, runner])\n\n    return (\n        <Grid container direction=\"column\" spacing={1}>\n            <Grid item xs={12}>\n                <VMToolbar runner={runner} run={run} cancel={cancel} />\n            </Grid>\n            <Grid item xs={12}>\n                <BlockEditor />\n            </Grid>\n            {Flags.diagnostics && (\n                <>\n                    <VMDiagnostics program={program} />\n                    <BlockDiagnostics />\n                </>\n            )}\n        </Grid>\n    )\n}\n\nexport default function VMEditor() {\n    const dsls = useMemo(() => {\n        return [\n            servicesDSL,\n            loopsDsl,\n            logicDsl,\n            mathDSL,\n            jsonDSL,\n            variablesDsl,\n            toolsDSL,\n            shadowDsl,\n            fieldsDsl,\n        ]\n    }, [])\n\n    return (\n        <NoSsr>\n            <BlockProvider storageKey={VM_SOURCE_STORAGE_KEY} dsls={dsls}>\n                <VMEditorWithContext />\n            </BlockProvider>\n        </NoSsr>\n    )\n}\n","import React from \"react\"\nimport VMEditor from \"../../components/vm/VMEditor\"\n\nexport default function Page() {\n    return <VMEditor />\n}\n"],"sourceRoot":""}